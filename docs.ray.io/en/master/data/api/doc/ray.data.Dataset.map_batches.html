
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ray.data.Dataset.map_batches &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/js/docsearch.js"></script>
    <script src="../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../_static/js/top-navigation.js"></script>
    <script src="../../../_static/js/tags.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/data/api/doc/ray.data.Dataset.map_batches.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ray.data.Dataset.materialize" href="ray.data.Dataset.materialize.html" />
    <link rel="prev" title="ray.data.Dataset.map" href="ray.data.Dataset.map.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "data/api/doc/ray.data.Dataset.map_batches", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../ray-references/api.html">
   References
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../../ray-air/api/api.html">
     Ray AIR API
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../api.html">
     Ray Data API
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../input_output.html">
       Input/Output
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="../dataset.html">
       Dataset API
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4 current active">
        <a class="reference internal" href="ray.data.Dataset.html">
         ray.data.Dataset
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.map.html">
         ray.data.Dataset.map
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="ray.data.Dataset.map_batches.html#">
         ray.data.Dataset.map_batches
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.flat_map.html">
         ray.data.Dataset.flat_map
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.filter.html">
         ray.data.Dataset.filter
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.add_column.html">
         ray.data.Dataset.add_column
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.drop_columns.html">
         ray.data.Dataset.drop_columns
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.select_columns.html">
         ray.data.Dataset.select_columns
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.random_sample.html">
         ray.data.Dataset.random_sample
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.limit.html">
         ray.data.Dataset.limit
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.sort.html">
         ray.data.Dataset.sort
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.random_shuffle.html">
         ray.data.Dataset.random_shuffle
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.randomize_block_order.html">
         ray.data.Dataset.randomize_block_order
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.repartition.html">
         ray.data.Dataset.repartition
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.split.html">
         ray.data.Dataset.split
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.split_at_indices.html">
         ray.data.Dataset.split_at_indices
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.split_proportionately.html">
         ray.data.Dataset.split_proportionately
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.streaming_split.html">
         ray.data.Dataset.streaming_split
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.train_test_split.html">
         ray.data.Dataset.train_test_split
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.union.html">
         ray.data.Dataset.union
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.zip.html">
         ray.data.Dataset.zip
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.groupby.html">
         ray.data.Dataset.groupby
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.aggregate.html">
         ray.data.Dataset.aggregate
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.sum.html">
         ray.data.Dataset.sum
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.min.html">
         ray.data.Dataset.min
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.max.html">
         ray.data.Dataset.max
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.mean.html">
         ray.data.Dataset.mean
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.std.html">
         ray.data.Dataset.std
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.show.html">
         ray.data.Dataset.show
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.take.html">
         ray.data.Dataset.take
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.take_batch.html">
         ray.data.Dataset.take_batch
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.take_all.html">
         ray.data.Dataset.take_all
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.iterator.html">
         ray.data.Dataset.iterator
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.iter_rows.html">
         ray.data.Dataset.iter_rows
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.iter_batches.html">
         ray.data.Dataset.iter_batches
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.iter_torch_batches.html">
         ray.data.Dataset.iter_torch_batches
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.iter_tf_batches.html">
         ray.data.Dataset.iter_tf_batches
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_parquet.html">
         ray.data.Dataset.write_parquet
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_json.html">
         ray.data.Dataset.write_json
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_csv.html">
         ray.data.Dataset.write_csv
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_numpy.html">
         ray.data.Dataset.write_numpy
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_tfrecords.html">
         ray.data.Dataset.write_tfrecords
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_webdataset.html">
         ray.data.Dataset.write_webdataset
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_mongo.html">
         ray.data.Dataset.write_mongo
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.write_datasource.html">
         ray.data.Dataset.write_datasource
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_torch.html">
         ray.data.Dataset.to_torch
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_tf.html">
         ray.data.Dataset.to_tf
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_dask.html">
         ray.data.Dataset.to_dask
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_mars.html">
         ray.data.Dataset.to_mars
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_modin.html">
         ray.data.Dataset.to_modin
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_spark.html">
         ray.data.Dataset.to_spark
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_pandas.html">
         ray.data.Dataset.to_pandas
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_pandas_refs.html">
         ray.data.Dataset.to_pandas_refs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_numpy_refs.html">
         ray.data.Dataset.to_numpy_refs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_arrow_refs.html">
         ray.data.Dataset.to_arrow_refs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.to_random_access_dataset.html">
         ray.data.Dataset.to_random_access_dataset
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.count.html">
         ray.data.Dataset.count
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.columns.html">
         ray.data.Dataset.columns
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.schema.html">
         ray.data.Dataset.schema
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.num_blocks.html">
         ray.data.Dataset.num_blocks
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.size_bytes.html">
         ray.data.Dataset.size_bytes
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.input_files.html">
         ray.data.Dataset.input_files
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.stats.html">
         ray.data.Dataset.stats
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.get_internal_block_refs.html">
         ray.data.Dataset.get_internal_block_refs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.materialize.html">
         ray.data.Dataset.materialize
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.ActorPoolStrategy.html">
         ray.data.ActorPoolStrategy
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.has_serializable_lineage.html">
         ray.data.Dataset.has_serializable_lineage
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.serialize_lineage.html">
         ray.data.Dataset.serialize_lineage
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray.data.Dataset.deserialize_lineage.html">
         ray.data.Dataset.deserialize_lineage
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_iterator.html">
       DataIterator API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../execution_options.html">
       ExecutionOptions API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../grouped_data.html">
       GroupedData API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../data_context.html">
       DataContext API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="https://docs.ray.io/en/master/data/api/data_representations.html">
       Data Representations (internal)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../random_access_dataset.html">
       RandomAccessDataset (experimental)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../utility.html">
       Utility
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../from_other_data_libs.html">
       API Guide for Users from Other Data Libraries
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../train/api/api.html">
     Ray Train API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tune/api/api.html">
     Ray Tune API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../serve/api/index.html">
     Ray Serve API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../rllib/package_ref/index.html">
     Ray RLlib API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../workflows/api/api.html">
     Ray Workflows API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../cluster/package-overview.html">
     Ray Cluster Management API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../ray-core/api/index.html">
     Ray Core API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../cluster/usage-stats.html">
     Usage Stats Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../ray-references/glossary.html">
     Ray Glossary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fdata/api/doc/ray.data.Dataset.map_batches.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/data/api/doc/ray.data.Dataset.map_batches.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/data/api/doc/ray.data.Dataset.map_batches.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>ray.data.Dataset.map_batches</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="ray-data-dataset-map-batches">
<h1>ray.data.Dataset.map_batches<a class="headerlink" href="ray.data.Dataset.map_batches.html#ray-data-dataset-map-batches" title="Permalink to this headline">#</a></h1>
<dl class="py method">
<dt class="sig sig-object py" id="ray.data.Dataset.map_batches">
<span class="sig-prename descclassname"><span class="pre">Dataset.</span></span><span class="sig-name descname"><span class="pre">map_batches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pyarrow.Table</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pyarrow.Table</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pyarrow.Table</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pyarrow.Table</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">_CallableClassProtocol</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">typing_extensions.Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">default</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">ray.data._internal.compute.ComputeStrategy</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_copy_batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn_constructor_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn_constructor_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_cpus</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_gpus</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">ray_remote_args</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="ray.data.Dataset.html#ray.data.Dataset" title="ray.data.Dataset"><span class="pre">Dataset</span></a></span></span><a class="reference internal" href="../../../_modules/ray/data/dataset.html#Dataset.map_batches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="ray.data.Dataset.map_batches.html#ray.data.Dataset.map_batches" title="Permalink to this definition">#</a></dt>
<dd><p>Apply the given function to batches of data.</p>
<p>This applies the <code class="docutils literal notranslate"><span class="pre">fn</span></code> in parallel with map tasks, with each task handling
a batch of data (typically Dict[str, np.ndarray] or pd.DataFrame).</p>
<p>To learn more, see the <a class="reference internal" href="../../transforming-data.html#id3"><span class="std std-ref">Transforming batches user guide</span></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fn</span></code> does not mutate its input, set <code class="docutils literal notranslate"><span class="pre">zero_copy_batch=True</span></code> to elide a
batch copy, which can improve performance and decrease memory utilization.
<code class="docutils literal notranslate"><span class="pre">fn</span></code> will then receive zero-copy read-only batches.
If <code class="docutils literal notranslate"><span class="pre">fn</span></code> mutates its input, you will need to ensure that the batch provided
to <code class="docutils literal notranslate"><span class="pre">fn</span></code> is writable by setting <code class="docutils literal notranslate"><span class="pre">zero_copy_batch=False</span></code> (default). This
will create an extra, mutable copy of each batch before handing it to
<code class="docutils literal notranslate"><span class="pre">fn</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The size of the batches provided to <code class="docutils literal notranslate"><span class="pre">fn</span></code> may be smaller than the provided
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code> if <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> doesnâ€™t evenly divide the block(s) sent to
a given map task. When <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> is specified, each map task will be
sent a single block if the block is equal to or larger than <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>,
and will be sent a bundle of blocks up to (but not exceeding)
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code> if blocks are smaller than <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>.</p>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ray</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">from_items</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Luna&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Rory&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Scout&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">},</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span>  
<span class="go">MaterializedDataset(</span>
<span class="go">    num_blocks=3,</span>
<span class="go">    num_rows=3,</span>
<span class="go">    schema={name: string, age: int64}</span>
<span class="go">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">fn</span></code> returns the same batch type as the input, but your <code class="docutils literal notranslate"><span class="pre">fn</span></code> can
also return a different batch type (e.g., pd.DataFrame). Read more about
<a class="reference internal" href="../../transforming-data.html#id3"><span class="std std-ref">Transforming batches</span></a>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">map_fn</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;age_in_dog_years&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">batch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map_batches</span><span class="p">(</span><span class="n">map_fn</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span>
<span class="go">MapBatches(map_fn)</span>
<span class="go">+- Dataset(num_blocks=3, num_rows=3, schema={name: string, age: int64})</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../../ray-more-libs/actors.html#actor-guide"><span class="std std-ref">Actors</span></a> can improve the performance of some workloads.
For example, you can use <a class="reference internal" href="../../../ray-more-libs/actors.html#actor-guide"><span class="std std-ref">actors</span></a> to load a model once
per worker instead of once per inference.</p>
<p>To transform batches with <a class="reference internal" href="../../../ray-more-libs/actors.html#actor-guide"><span class="std std-ref">actors</span></a>, pass a callable type
to <code class="docutils literal notranslate"><span class="pre">fn</span></code> and specify an <a class="reference internal" href="ray.data.ActorPoolStrategy.html#ray.data.ActorPoolStrategy" title="ray.data.ActorPoolStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">ActorPoolStrategy</span></code></a>.</p>
<p>In the example below, <code class="docutils literal notranslate"><span class="pre">CachedModel</span></code> is called on an autoscaling pool of
two to eight <a class="reference internal" href="../../../ray-more-libs/actors.html#actor-guide"><span class="std std-ref">actors</span></a>, each allocated one GPU by Ray.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">init_large_model</span> <span class="o">=</span> <span class="o">...</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CachedModel</span><span class="p">:</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>       <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">init_large_model</span><span class="p">()</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="gp">... </span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="o">.</span><span class="n">map_batches</span><span class="p">(</span> 
<span class="gp">... </span>    <span class="n">CachedModel</span><span class="p">,</span> 
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> 
<span class="gp">... </span>    <span class="n">compute</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ActorPoolStrategy</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> 
<span class="gp">... </span>    <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span> 
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fn</span></code> can also be a generator, yielding multiple batches in a single
invocation. This is useful when returning large objects. Instead of
returning a very large output batch, <code class="docutils literal notranslate"><span class="pre">fn</span></code> can instead yield the
output batch in chunks.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">map_fn_with_large_output</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="p">{</span><span class="s2">&quot;large_output&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">from_items</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map_batches</span><span class="p">(</span><span class="n">map_fn_with_large_output</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span>
<span class="go">MapBatches(map_fn_with_large_output)</span>
<span class="go">+- Dataset(num_blocks=1, num_rows=1, schema={item: int64})</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> â€“ The function or generator to apply to each record batch, or a class type
that can be instantiated to create such a callable. Callable classes are
only supported for the actor compute strategy. Note <code class="docutils literal notranslate"><span class="pre">fn</span></code> must be
pickle-able.</p></li>
<li><p><strong>batch_size</strong> â€“ The desired number of rows in each batch, or None to use entire
blocks as batches (blocks may contain different number of rows).
The actual size of the batch provided to <code class="docutils literal notranslate"><span class="pre">fn</span></code> may be smaller than
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code> if <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> doesnâ€™t evenly divide the block(s) sent
to a given map task. Default batch_size is 4096 with â€œdefaultâ€.</p></li>
<li><p><strong>compute</strong> â€“ The compute strategy, either â€œtasksâ€ (default) to use Ray
tasks, <code class="docutils literal notranslate"><span class="pre">ray.data.ActorPoolStrategy(size=n)</span></code> to use a fixed-size actor
pool, or <code class="docutils literal notranslate"><span class="pre">ray.data.ActorPoolStrategy(min_size=m,</span> <span class="pre">max_size=n)</span></code> for an
autoscaling actor pool.</p></li>
<li><p><strong>batch_format</strong> â€“ Specify <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code> to use the default block format
(NumPy), <code class="docutils literal notranslate"><span class="pre">&quot;pandas&quot;</span></code> to select <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>, â€œpyarrowâ€ to
select <code class="docutils literal notranslate"><span class="pre">pyarrow.Table</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;numpy&quot;</span></code> to select
<code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">numpy.ndarray]</span></code>, or None to return the underlying block
exactly as is with no additional formatting.</p></li>
<li><p><strong>zero_copy_batch</strong> â€“ Whether <code class="docutils literal notranslate"><span class="pre">fn</span></code> should be provided zero-copy, read-only
batches. If this is <code class="docutils literal notranslate"><span class="pre">True</span></code> and no copy is required for the
<code class="docutils literal notranslate"><span class="pre">batch_format</span></code> conversion, the batch will be a zero-copy, read-only
view on data in Rayâ€™s object store, which can decrease memory
utilization and improve performance. If this is <code class="docutils literal notranslate"><span class="pre">False</span></code>, the batch
will be writable, which will require an extra copy to guarantee.
If <code class="docutils literal notranslate"><span class="pre">fn</span></code> mutates its input, this will need to be <code class="docutils literal notranslate"><span class="pre">False</span></code> in order to
avoid â€œassignment destination is read-onlyâ€ or â€œbuffer source array is
read-onlyâ€ errors. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>fn_args</strong> â€“ Positional arguments to pass to <code class="docutils literal notranslate"><span class="pre">fn</span></code> after the first argument.
These arguments are top-level arguments to the underlying Ray task.</p></li>
<li><p><strong>fn_kwargs</strong> â€“ Keyword arguments to pass to <code class="docutils literal notranslate"><span class="pre">fn</span></code>. These arguments are
top-level arguments to the underlying Ray task.</p></li>
<li><p><strong>fn_constructor_args</strong> â€“ Positional arguments to pass to <code class="docutils literal notranslate"><span class="pre">fn</span></code>â€™s constructor.
You can only provide this if <code class="docutils literal notranslate"><span class="pre">fn</span></code> is a callable class. These arguments
are top-level arguments in the underlying Ray actor construction task.</p></li>
<li><p><strong>fn_constructor_kwargs</strong> â€“ Keyword arguments to pass to <code class="docutils literal notranslate"><span class="pre">fn</span></code>â€™s constructor.
This can only be provided if <code class="docutils literal notranslate"><span class="pre">fn</span></code> is a callable class. These arguments
are top-level arguments in the underlying Ray actor construction task.</p></li>
<li><p><strong>num_cpus</strong> â€“ The number of CPUs to reserve for each parallel map worker.</p></li>
<li><p><strong>num_gpus</strong> â€“ The number of GPUs to reserve for each parallel map worker. For
example, specify <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_gpus=1</span></code> to request 1 GPU for each parallel map worker.</p></li>
<li><p><strong>ray_remote_args</strong> â€“ Additional resource requirements to request from
ray for each map worker.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl>
<dt><a class="reference internal" href="ray.data.Dataset.iter_batches.html#ray.data.Dataset.iter_batches" title="ray.data.Dataset.iter_batches"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iter_batches()</span></code></a></dt><dd><p>Call this function to iterate over batches of data.</p>
</dd>
<dt><a class="reference internal" href="ray.data.Dataset.flat_map.html#ray.data.Dataset.flat_map" title="ray.data.Dataset.flat_map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flat_map()</span></code></a>:</dt><dd><p>Call this method to create new records from existing ones. Unlike
<a class="reference internal" href="ray.data.Dataset.map.html#ray.data.Dataset.map" title="ray.data.Dataset.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map()</span></code></a>, a function passed to <a class="reference internal" href="ray.data.Dataset.flat_map.html#ray.data.Dataset.flat_map" title="ray.data.Dataset.flat_map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flat_map()</span></code></a>
can return multiple records.</p>
<p><a class="reference internal" href="ray.data.Dataset.flat_map.html#ray.data.Dataset.flat_map" title="ray.data.Dataset.flat_map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flat_map()</span></code></a> isnâ€™t recommended because itâ€™s slow; call
<a class="reference internal" href="ray.data.Dataset.map_batches.html#ray.data.Dataset.map_batches" title="ray.data.Dataset.map_batches"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map_batches()</span></code></a> instead.</p>
</dd>
<dt><a class="reference internal" href="ray.data.Dataset.map.html#ray.data.Dataset.map" title="ray.data.Dataset.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map()</span></code></a></dt><dd><p>Call this method to transform one record at time.</p>
<p>This method isnâ€™t recommended because itâ€™s slow; call
<a class="reference internal" href="ray.data.Dataset.map_batches.html#ray.data.Dataset.map_batches" title="ray.data.Dataset.map_batches"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map_batches()</span></code></a> instead.</p>
</dd>
</dl>
</div>
</dd></dl>

</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="ray.data.Dataset.map.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">ray.data.Dataset.map</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="ray.data.Dataset.materialize.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ray.data.Dataset.materialize</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>