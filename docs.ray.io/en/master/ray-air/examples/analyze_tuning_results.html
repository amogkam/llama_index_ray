
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Hyperparameter tuning with XGBoostTrainer &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script src="../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/ray-air/examples/analyze_tuning_results.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Training a model with distributed LightGBM" href="lightgbm_example.html" />
    <link rel="prev" title="Training a model with distributed XGBoost" href="xgboost_example.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "ray-air/examples/analyze_tuning_results", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".ipynb", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../getting-started.html">
   Ray AI Runtime (AIR)
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guides.html">
     User Guides
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Examples
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="opt_deepspeed_batch_inference.html">
       Batch Inference with OPT 30B and Ray Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="torch_image_example.html">
       Training a Torch Image Classifier
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="torch_detection.html">
       Fine-tuning a Torch object detection model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="convert_existing_pytorch_code_to_ray_air.html">
       Convert existing PyTorch code to Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="convert_existing_tf_code_to_ray_air.html">
       Convert existing Tensorflow/Keras code to Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tfx_tabular_train_to_serve.html">
       Tabular data training and serving with Keras and Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="huggingface_text_classification.html">
       Fine-tune a ü§ó Transformers model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sklearn_example.html">
       Training a model with Sklearn
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="xgboost_example.html">
       Training a model with distributed XGBoost
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="analyze_tuning_results.html#">
       Hyperparameter tuning with XGBoostTrainer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="lightgbm_example.html">
       Training a model with distributed LightGBM
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="torch_incremental_learning.html">
       Incremental Learning with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="rl_serving_example.html">
       Serving reinforcement learning policy models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="rl_online_example.html">
       Online reinforcement learning with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="rl_offline_example.html">
       Offline reinforcement learning with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="upload_to_comet_ml.html">
       Logging results and uploading models to Comet ML
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="upload_to_wandb.html">
       Logging results and uploading models to Weights &amp; Biases
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="feast_example.html">
       Integrate Ray AIR with Feast feature store
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="automl_with_ray_air.html">
       AutoML for time series forecasting with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="batch_tuning.html">
       Batch training &amp; tuning on Ray Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="batch_forecasting.html">
       Parallel demand forecasting at scale using Ray Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="stablediffusion_batch_prediction.html">
       Stable Diffusion Batch Prediction with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="gptj_deepspeed_fine_tuning.html">
       GPT-J-6B Fine-Tuning with Ray AIR and DeepSpeed
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="gptj_batch_prediction.html">
       GPT-J-6B Batch Prediction with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="gptj_serving.html">
       GPT-J-6B Serving with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dreambooth_finetuning.html">
       Fine-tuning DreamBooth with Ray AIR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dolly_lightning_fsdp_finetuning.html">
       Fine-tune
       <code class="docutils literal notranslate">
        <span class="pre">
         dolly-v2-7b
        </span>
       </code>
       with Ray AIR LightningTrainer and FSDP
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/api.html">
     Ray AIR API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../benchmarks.html">
     Benchmarks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fray-air/examples/analyze_tuning_results.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/ray-air/examples/analyze_tuning_results.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/ray-air/examples/analyze_tuning_results.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Hyperparameter tuning with XGBoostTrainer</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="hyperparameter-tuning-with-xgboosttrainer">
<h1>Hyperparameter tuning with XGBoostTrainer<a class="headerlink" href="analyze_tuning_results.html#hyperparameter-tuning-with-xgboosttrainer" title="Permalink to this headline">#</a></h1>
<p>In this example, we will go through how you can use Ray AIR to run a distributed hyperparameter experiment to find optimal hyperparameters for an XGBoost model.</p>
<p>What we‚Äôll cover:</p>
<ul class="simple">
<li><p>How to load data from an Sklearn example dataset</p></li>
<li><p>How to initialize an XGBoost trainer</p></li>
<li><p>How to define a search space for regular XGBoost parameters and for data preprocessors</p></li>
<li><p>How to fetch the best obtained result from the tuning run</p></li>
<li><p>How to fetch a dataframe to do further analysis on the results</p></li>
</ul>
<p>We‚Äôll use the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.fetch_covtype.html#sklearn-data-fetch-covtype">Covertype dataset</a> provided from sklearn to train a multiclass classification task using XGBoost.</p>
<p>In this dataset, we try to predict the forst cover type (e.g. ‚Äúlodgehole pine‚Äù) from cartographic variables, like the distance to the closest road, or the hillshade at different times of the day. The features are binary, discrete and continuous and thus well suited for a decision-tree based classification task.</p>
<p>You can find more information about the dataset <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Covertype">on the dataset homepage</a>.</p>
<p>We will train XGBoost models on this dataset. Because model training performance can be influenced by hyperparameter choices, we will generate several different configurations and train them in parallel. Notably each of these trials will itself start a distributed training job to speed up training. All of this happens automatically within Ray AIR.</p>
<p>First, let‚Äôs make sure we have all dependencies installed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install -q <span class="s2">&quot;ray[air]&quot;</span> scikit-learn
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: You are using pip version 21.3.1; however, version 22.0.4 is available.</span>
<span class=" -Color -Color-Yellow">You should consider upgrading via the &#39;/Users/kai/.pyenv/versions/3.7.7/bin/python3.7 -m pip install --upgrade pip&#39; command.</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can start with some imports.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_covtype</span>

<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">tune</span>
<span class="kn">from</span> <span class="nn">ray.air</span> <span class="kn">import</span> <span class="n">RunConfig</span><span class="p">,</span> <span class="n">ScalingConfig</span>
<span class="kn">from</span> <span class="nn">ray.train.xgboost</span> <span class="kn">import</span> <span class="n">XGBoostTrainer</span>
<span class="kn">from</span> <span class="nn">ray.tune.tune_config</span> <span class="kn">import</span> <span class="n">TuneConfig</span>
<span class="kn">from</span> <span class="nn">ray.tune.tuner</span> <span class="kn">import</span> <span class="n">Tuner</span>
</pre></div>
</div>
</div>
</div>
<p>We‚Äôll define a utility function to create a Dataset from the Sklearn dataset. We expect the target column to be in the dataframe, so we‚Äôll add it to the dataframe manually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_training_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ray</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
    <span class="n">data_raw</span> <span class="o">=</span> <span class="n">fetch_covtype</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_raw</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">data_raw</span><span class="p">[</span><span class="s2">&quot;feature_names&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ray</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>


<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">get_training_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-05-13 12:31:51,444	INFO services.py:1484 -- View the Ray dashboard at <span class=" -Color -Color-Bold -Color-Bold-Green">http://127.0.0.1:8265</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs take a look at the schema here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset(num_blocks=1, num_rows=581012, schema={Elevation: float64, Aspect: float64, Slope: float64, Horizontal_Distance_To_Hydrology: float64, Vertical_Distance_To_Hydrology: float64, Horizontal_Distance_To_Roadways: float64, Hillshade_9am: float64, Hillshade_Noon: float64, Hillshade_3pm: float64, Horizontal_Distance_To_Fire_Points: float64, Wilderness_Area_0: float64, Wilderness_Area_1: float64, Wilderness_Area_2: float64, Wilderness_Area_3: float64, Soil_Type_0: float64, Soil_Type_1: float64, Soil_Type_2: float64, Soil_Type_3: float64, Soil_Type_4: float64, Soil_Type_5: float64, Soil_Type_6: float64, Soil_Type_7: float64, Soil_Type_8: float64, Soil_Type_9: float64, Soil_Type_10: float64, Soil_Type_11: float64, Soil_Type_12: float64, Soil_Type_13: float64, Soil_Type_14: float64, Soil_Type_15: float64, Soil_Type_16: float64, Soil_Type_17: float64, Soil_Type_18: float64, Soil_Type_19: float64, Soil_Type_20: float64, Soil_Type_21: float64, Soil_Type_22: float64, Soil_Type_23: float64, Soil_Type_24: float64, Soil_Type_25: float64, Soil_Type_26: float64, Soil_Type_27: float64, Soil_Type_28: float64, Soil_Type_29: float64, Soil_Type_30: float64, Soil_Type_31: float64, Soil_Type_32: float64, Soil_Type_33: float64, Soil_Type_34: float64, Soil_Type_35: float64, Soil_Type_36: float64, Soil_Type_37: float64, Soil_Type_38: float64, Soil_Type_39: float64, target: int32})
</pre></div>
</div>
</div>
</div>
<p>Since we‚Äôll be training a multiclass prediction model, we have to pass some information to XGBoost. For instance, XGBoost expects us to provide the number of classes, and multiclass-enabled evaluation metrices.</p>
<p>For a good overview of commonly used hyperparameters, see <a class="reference external" href="https://docs.ray.io/en/latest/tune/examples/tune-xgboost.html#xgboost-hyperparameters">our tutorial in the docs</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># XGBoost specific params</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;tree_method&quot;</span><span class="p">:</span> <span class="s2">&quot;approx&quot;</span><span class="p">,</span>
    <span class="s2">&quot;objective&quot;</span><span class="p">:</span> <span class="s2">&quot;multi:softmax&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eval_metric&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mlogloss&quot;</span><span class="p">,</span> <span class="s2">&quot;merror&quot;</span><span class="p">],</span>
    <span class="s2">&quot;num_class&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s2">&quot;min_child_weight&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>With these parameters in place, we‚Äôll create a Ray AIR <code class="docutils literal notranslate"><span class="pre">XGBoostTrainer</span></code>.</p>
<p>Note that we pass in a <code class="docutils literal notranslate"><span class="pre">scaling_config</span></code> to configure the distributed training behavior of each individual XGBoost training job. We want to distribute training across 2 workers. We also keep some CPU resources free for Ray Data operations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">label_column</span></code> specifies which columns in the dataset contains the target values. <code class="docutils literal notranslate"><span class="pre">params</span></code> are the XGBoost training params defined above - we can tune these later! The <code class="docutils literal notranslate"><span class="pre">datasets</span></code> dict contains the dataset we would like to train on. Lastly, we pass the number of boosting rounds to XGBoost.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trainer</span> <span class="o">=</span> <span class="n">XGBoostTrainer</span><span class="p">(</span>
    <span class="n">scaling_config</span><span class="o">=</span><span class="n">ScalingConfig</span><span class="p">(</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">_max_cpu_fraction_per_node</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span>
    <span class="n">label_column</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
    <span class="n">datasets</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">train_dataset</span><span class="p">},</span>
    <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now create the Tuner with a search space to override some of the default parameters in the XGBoost trainer.</p>
<p>Here, we just want to the XGBoost <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> and <code class="docutils literal notranslate"><span class="pre">min_child_weights</span></code> parameters. Note that we specifically specified <code class="docutils literal notranslate"><span class="pre">min_child_weight=2</span></code> in the default XGBoost trainer - this value will be overwritten during tuning.</p>
<p>We configure Tune to minimize the <code class="docutils literal notranslate"><span class="pre">train-mlogloss</span></code> metric. In random search, this doesn‚Äôt affect the evaluated configurations, but it will affect our default results fetching for analysis later.</p>
<p>By the way, the name <code class="docutils literal notranslate"><span class="pre">train-mlogloss</span></code> is provided by the XGBoost library - <code class="docutils literal notranslate"><span class="pre">train</span></code> is the name of the dataset and <code class="docutils literal notranslate"><span class="pre">mlogloss</span></code> is the metric we passed in the XGBoost <code class="docutils literal notranslate"><span class="pre">params</span></code> above. Trainables can report any number of results (in this case we report 2), but most search algorithms only act on one of them - here we chose the <code class="docutils literal notranslate"><span class="pre">mlogloss</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">Tuner</span><span class="p">(</span>
    <span class="n">trainer</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">RunConfig</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">param_space</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> 
            <span class="s2">&quot;min_child_weight&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="n">tune_config</span><span class="o">=</span><span class="n">TuneConfig</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;train-mlogloss&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs run the tuning. This will take a few minutes to complete.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">== Status ==<br>Current time: 2022-05-13 12:35:33 (running for 00:03:37.49)<br>Memory usage on this node: 10.0/16.0 GiB<br>Using FIFO scheduling algorithm.<br>Resources requested: 0/16 CPUs, 0/0 GPUs, 0.0/6.73 GiB heap, 0.0/2.0 GiB objects<br>Current best trial: 4ab2f_00007 with train-mlogloss=0.560217 and parameters={'params': {'max_depth': 7, 'min_child_weight': 4}}<br>Result logdir: /Users/kai/ray_results/XGBoostTrainer_2022-05-13_12-31-55<br>Number of trials: 8/8 (8 TERMINATED)<br><br></div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62456)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62456)</span> 2022-05-13 12:32:02,793	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62464)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62463)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62466)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62463)</span> 2022-05-13 12:32:05,102	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62466)</span> 2022-05-13 12:32:05,204	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62464)</span> 2022-05-13 12:32:05,338	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> 2022-05-13 12:32:07,164	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62456)</span> 2022-05-13 12:32:10,549	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62495)</span> [12:32:10] task [xgboost.ray]:6975277392 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62494)</span> [12:32:10] task [xgboost.ray]:4560390352 got new rank 0
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(raylet)</span> Spilled 2173 MiB, 22 objects, write throughput 402 MiB/s. Set RAY_verbose_spill_logs=0 to disable this message.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62463)</span> 2022-05-13 12:32:17,848	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62523)</span> [12:32:18] task [xgboost.ray]:4441524624 got new rank 0
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62524)</span> [12:32:18] task [xgboost.ray]:6890641808 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> 2022-05-13 12:32:21,253	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62466)</span> 2022-05-13 12:32:21,529	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62563)</span> [12:32:21] task [xgboost.ray]:4667801680 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62562)</span> [12:32:21] task [xgboost.ray]:6856360848 got new rank 0
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62530)</span> [12:32:21] task [xgboost.ray]:6971527824 got new rank 0
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62532)</span> [12:32:21] task [xgboost.ray]:4538321232 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62464)</span> 2022-05-13 12:32:21,937	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62544)</span> [12:32:21] task [xgboost.ray]:7005661840 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62543)</span> [12:32:21] task [xgboost.ray]:4516088080 got new rank 0
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(raylet)</span> Spilled 4098 MiB, 83 objects, write throughput 347 MiB/s.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62456)</span> 2022-05-13 12:32:41,289	INFO main.py:1109 -- Training in progress (31 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62463)</span> 2022-05-13 12:32:48,617	INFO main.py:1109 -- Training in progress (31 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> 2022-05-13 12:32:52,110	INFO main.py:1109 -- Training in progress (31 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62466)</span> 2022-05-13 12:32:52,448	INFO main.py:1109 -- Training in progress (31 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62464)</span> 2022-05-13 12:32:52,692	INFO main.py:1109 -- Training in progress (31 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62456)</span> 2022-05-13 12:33:11,960	INFO main.py:1109 -- Training in progress (61 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62463)</span> 2022-05-13 12:33:19,076	INFO main.py:1109 -- Training in progress (61 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62464)</span> 2022-05-13 12:33:23,409	INFO main.py:1109 -- Training in progress (61 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> 2022-05-13 12:33:23,420	INFO main.py:1109 -- Training in progress (62 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62466)</span> 2022-05-13 12:33:23,541	INFO main.py:1109 -- Training in progress (62 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62463)</span> 2022-05-13 12:33:23,693	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 78.74 seconds (65.79 pure XGBoost training time).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62464)</span> 2022-05-13 12:33:24,802	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 79.62 seconds (62.85 pure XGBoost training time).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62648)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62651)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62648)</span> 2022-05-13 12:33:38,788	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62651)</span> 2022-05-13 12:33:38,766	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62456)</span> 2022-05-13 12:33:42,168	INFO main.py:1109 -- Training in progress (92 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62456)</span> 2022-05-13 12:33:46,177	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 103.54 seconds (95.60 pure XGBoost training time).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62651)</span> 2022-05-13 12:33:51,825	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62670)</span> [12:33:51] task [xgboost.ray]:4623186960 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62669)</span> [12:33:51] task [xgboost.ray]:4707639376 got new rank 0
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62648)</span> 2022-05-13 12:33:52,036	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62672)</span> [12:33:52] task [xgboost.ray]:4530073552 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62671)</span> [12:33:52] task [xgboost.ray]:6824757200 got new rank 0
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62466)</span> 2022-05-13 12:33:54,229	INFO main.py:1109 -- Training in progress (92 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> 2022-05-13 12:33:54,355	INFO main.py:1109 -- Training in progress (93 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62730)</span> UserWarning: Dataset &#39;train&#39; has 1 blocks, which is less than the `num_workers` 2. This dataset will be automatically repartitioned to 2 blocks.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62730)</span> 2022-05-13 12:34:04,708	INFO main.py:980 -- [RayXGBoost] Created 2 new actors (2 total actors). Waiting until actors are ready for training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62466)</span> 2022-05-13 12:34:11,126	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 126.08 seconds (109.48 pure XGBoost training time).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62730)</span> 2022-05-13 12:34:15,175	INFO main.py:1025 -- [RayXGBoost] Starting XGBoost training.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62753)</span> [12:34:15] task [xgboost.ray]:4468564048 got new rank 1
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(_RemoteRayXGBoostActor pid=62752)</span> [12:34:15] task [xgboost.ray]:6799468304 got new rank 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62648)</span> 2022-05-13 12:34:22,167	INFO main.py:1109 -- Training in progress (30 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62651)</span> 2022-05-13 12:34:22,147	INFO main.py:1109 -- Training in progress (30 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> 2022-05-13 12:34:24,646	INFO main.py:1109 -- Training in progress (123 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62465)</span> 2022-05-13 12:34:24,745	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 137.75 seconds (123.36 pure XGBoost training time).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62651)</span> 2022-05-13 12:34:40,173	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 61.63 seconds (48.34 pure XGBoost training time).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62730)</span> 2022-05-13 12:34:45,745	INFO main.py:1109 -- Training in progress (31 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62648)</span> 2022-05-13 12:34:52,543	INFO main.py:1109 -- Training in progress (60 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62648)</span> 2022-05-13 12:35:14,888	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 96.35 seconds (82.83 pure XGBoost training time).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62730)</span> 2022-05-13 12:35:16,197	INFO main.py:1109 -- Training in progress (61 seconds since last restart).
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(GBDTTrainable pid=62730)</span> 2022-05-13 12:35:33,441	INFO main.py:1519 -- [RayXGBoost] Finished XGBoost training on training data with total N=581,012 in 88.89 seconds (78.26 pure XGBoost training time).
2022-05-13 12:35:33,610	INFO tune.py:753 -- Total run time: 218.52 seconds (217.48 seconds for the tuning loop).
</pre></div>
</div>
</div>
</div>
<p>Now that we obtained the results, we can analyze them. For instance, we can fetch the best observed result according to the configured <code class="docutils literal notranslate"><span class="pre">metric</span></code> and <code class="docutils literal notranslate"><span class="pre">mode</span></code> and print it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will fetch the best result according to the `metric` and `mode` specified</span>
<span class="c1"># in the `TuneConfig` above:</span>

<span class="n">best_result</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_best_result</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best result error rate&quot;</span><span class="p">,</span> <span class="n">best_result</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;train-merror&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best result error rate 0.196929
</pre></div>
</div>
</div>
</div>
<p>For more sophisticated analysis, we can get a pandas dataframe with all trial results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;train-mlogloss&#39;, &#39;train-merror&#39;, &#39;time_this_iter_s&#39;,
       &#39;should_checkpoint&#39;, &#39;done&#39;, &#39;timesteps_total&#39;, &#39;episodes_total&#39;,
       &#39;training_iteration&#39;, &#39;trial_id&#39;, &#39;experiment_id&#39;, &#39;date&#39;, &#39;timestamp&#39;,
       &#39;time_total_s&#39;, &#39;pid&#39;, &#39;hostname&#39;, &#39;node_ip&#39;, &#39;time_since_restore&#39;,
       &#39;timesteps_since_restore&#39;, &#39;iterations_since_restore&#39;, &#39;warmup_time&#39;,
       &#39;config/params/max_depth&#39;, &#39;config/params/min_child_weight&#39;, &#39;logdir&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>As an example, let‚Äôs group the results per <code class="docutils literal notranslate"><span class="pre">min_child_weight</span></code> parameter and fetch the minimal obtained values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;config/params/min_child_weight&quot;</span><span class="p">)</span>
<span class="n">mins</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<span class="k">for</span> <span class="n">min_child_weight</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mins</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min child weight&quot;</span><span class="p">,</span> <span class="n">min_child_weight</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;train-merror&quot;</span><span class="p">],</span> <span class="s2">&quot;logloss&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;train-mlogloss&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Min child weight 1 error 0.262468 logloss 0.69843
Min child weight 2 error 0.311035 logloss 0.79498
Min child weight 3 error 0.240916 logloss 0.651457
Min child weight 4 error 0.196929 logloss 0.560217
Min child weight 6 error 0.219665 logloss 0.608005
Min child weight 7 error 0.311035 logloss 0.794983
Min child weight 8 error 0.311035 logloss 0.794983
</pre></div>
</div>
</div>
</div>
<p>As you can see in our example run, the min child weight of <code class="docutils literal notranslate"><span class="pre">2</span></code> showed the best prediction accuracy with <code class="docutils literal notranslate"><span class="pre">0.196929</span></code>. That‚Äôs the same as <code class="docutils literal notranslate"><span class="pre">results.get_best_result()</span></code> gave us!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">results.get_dataframe()</span></code> returns the last reported results per trial. If you want to obtain the best <em>ever</em> observed results, you can pass the <code class="docutils literal notranslate"><span class="pre">filter_metric</span></code> and <code class="docutils literal notranslate"><span class="pre">filter_mode</span></code> arguments to <code class="docutils literal notranslate"><span class="pre">results.get_dataframe()</span></code>. In our example, we‚Äôll filter the minimum <em>ever</em> observed <code class="docutils literal notranslate"><span class="pre">train-merror</span></code> for each trial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_min_error</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span><span class="n">filter_metric</span><span class="o">=</span><span class="s2">&quot;train-merror&quot;</span><span class="p">,</span> <span class="n">filter_mode</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>
<span class="n">df_min_error</span><span class="p">[</span><span class="s2">&quot;train-merror&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    0.262468
1    0.310307
2    0.310307
3    0.219665
4    0.240916
5    0.220801
6    0.310307
7    0.196929
Name: train-merror, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The best ever observed <code class="docutils literal notranslate"><span class="pre">train-merror</span></code> is <code class="docutils literal notranslate"><span class="pre">0.196929</span></code>, the same as the minimum error in our grouped results. This is expected, as the classification error in XGBoost usually goes down over time - meaning our last results are usually the best results.</p>
<p>And that‚Äôs how you analyze your hyperparameter tuning results. If you would like to have access to more analytics, please feel free to file a feature request e.g. <a class="reference external" href="https://github.com/ray-project/ray/issues">as a Github issue</a> or on our <a class="reference external" href="https://discuss.ray.io/">Discuss platform</a>!</p>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="xgboost_example.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Training a model with distributed XGBoost</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="lightgbm_example.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Training a model with distributed LightGBM</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>