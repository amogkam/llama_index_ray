
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>A Gentle Introduction to Ray Core by Example &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script src="../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/ray-core/examples/gentle_walkthrough.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Monte Carlo Estimation of π" href="monte_carlo_pi.html" />
    <link rel="prev" title="Ray Tutorials and Examples" href="overview.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "ray-core/examples/gentle_walkthrough", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".ipynb", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../walkthrough.html">
   Ray Core
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide.html">
     User Guides
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="overview.html">
     Examples
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="gentle_walkthrough.html#">
       A Gentle Introduction to Ray Core by Example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="monte_carlo_pi.html">
       Monte Carlo Estimation of π
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_example-a3c.html">
       Asynchronous Advantage Actor Critic (A3C)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_example-lm.html">
       Fault-Tolerant Fairseq Training
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_hyperparameter.html">
       Simple Parallel Model Selection
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_parameter_server.html">
       Parameter Server
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_pong_example.html">
       Learning to Play Pong
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="highly_parallel.html">
       Using Ray for Highly Parallelizable Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="batch_prediction.html">
       Batch Prediction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="batch_training.html">
       Batch Training with Ray Core
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="automl_for_time_series.html">
       Simple AutoML for time series with Ray Core
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="web-crawler.html">
       Speed up your web crawler by parallelizing it with Ray
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="map_reduce.html">
       A Simple MapReduce Example with Ray Core
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/index.html">
     Ray Core API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fray-core/examples/gentle_walkthrough.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/ray-core/examples/gentle_walkthrough.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/ray-core/examples/gentle_walkthrough.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#install-ray">
   Install Ray
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#ray-core">
   Ray Core
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#your-first-ray-api-example">
   Your First Ray API Example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#ray-tasks">
     Ray Tasks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#object-stores">
     Object Stores
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#non-blocking-calls">
     Non-blocking calls
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#task-dependencies">
     Task dependencies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#ray-actors">
     Ray Actors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#want-to-learn-more">
   Want to learn more?
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>A Gentle Introduction to Ray Core by Example</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#install-ray">
   Install Ray
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#ray-core">
   Ray Core
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#your-first-ray-api-example">
   Your First Ray API Example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#ray-tasks">
     Ray Tasks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#object-stores">
     Object Stores
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#non-blocking-calls">
     Non-blocking calls
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#task-dependencies">
     Task dependencies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gentle_walkthrough.html#ray-actors">
     Ray Actors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gentle_walkthrough.html#want-to-learn-more">
   Want to learn more?
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="a-gentle-introduction-to-ray-core-by-example">
<h1>A Gentle Introduction to Ray Core by Example<a class="headerlink" href="gentle_walkthrough.html#a-gentle-introduction-to-ray-core-by-example" title="Permalink to this headline">#</a></h1>
<p>Implement a function in Ray Core to understand how Ray works and its basic concepts.
Python programmers from those with less experience to those who are interested in advanced tasks,
can start working with distributed computing using Python by learning the Ray Core API.</p>
<section id="install-ray">
<h2>Install Ray<a class="headerlink" href="gentle_walkthrough.html#install-ray" title="Permalink to this headline">#</a></h2>
<p>Install Ray with the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> pip install ray
</pre></div>
</div>
</div>
</div>
</section>
<section id="ray-core">
<h2>Ray Core<a class="headerlink" href="gentle_walkthrough.html#ray-core" title="Permalink to this headline">#</a></h2>
<p>Start a local cluster by running the following commands:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Note the following lines in the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="n">INFO</span> <span class="n">services</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1263</span> <span class="o">--</span> <span class="n">View</span> <span class="n">the</span> <span class="n">Ray</span> <span class="n">dashboard</span> <span class="n">at</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8265</span>
<span class="p">{</span><span class="s1">&#39;node_ip_address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.1.41&#39;</span><span class="p">,</span>
<span class="o">...</span>
<span class="s1">&#39;node_id&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>These messages indicate that the Ray cluster is working as expected. In this example output, the address of the Ray dashboard is <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8265</span></code>. Access the Ray dashboard at the address on the first line of your output. The Ray dashboard displays information such as the number of CPU cores available and the total utilization of the current Ray application.
This is a typical output for a laptop:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;CPU&#39;</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">,</span>
<span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="mf">14203886388.0</span><span class="p">,</span>
<span class="s1">&#39;node:127.0.0.1&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="s1">&#39;object_store_memory&#39;</span><span class="p">:</span> <span class="mf">2147483648.0</span><span class="p">}</span>
</pre></div>
</div>
<p>Next, is a brief introduction to the Ray Core API, which we refer to as the Ray API.
The Ray API builds on concepts such as decorators, functions, and classes, that are familiar to Python programmers.
It is a universal programming interface for distributed computing.
The engine handles the complicated work, allowing developers to use Ray with existing Python libraries and systems.</p>
</section>
<section id="your-first-ray-api-example">
<h2>Your First Ray API Example<a class="headerlink" href="gentle_walkthrough.html#your-first-ray-api-example" title="Permalink to this headline">#</a></h2>
<p>The following function retrieves and processes
data from a database. The dummy <code class="docutils literal notranslate"><span class="pre">database</span></code> is a plain Python list containing the
words of the title of the <a class="reference external" href="https://www.amazon.com/Learning-Ray-Flexible-Distributed-Machine/dp/1098117220/">“Learning Ray” book</a>.
The <code class="docutils literal notranslate"><span class="pre">sleep</span></code> function pauses for a certain amount of time to simulate the cost of accessing and processing data from the database.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="n">database</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Learning&quot;</span><span class="p">,</span> <span class="s2">&quot;Ray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Flexible&quot;</span><span class="p">,</span> <span class="s2">&quot;Distributed&quot;</span><span class="p">,</span> <span class="s2">&quot;Python&quot;</span><span class="p">,</span> <span class="s2">&quot;for&quot;</span><span class="p">,</span> <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;Learning&quot;</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">item</span> <span class="o">/</span> <span class="mf">10.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">item</span><span class="p">,</span> <span class="n">database</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>If the item with index 5 takes half a second <code class="docutils literal notranslate"><span class="pre">(5</span> <span class="pre">/</span> <span class="pre">10.)</span></code>, an estimate of the total runtime to retrieve all eight items sequentially is <code class="docutils literal notranslate"><span class="pre">(0+1+2+3+4+5+6+7)/10.</span> <span class="pre">=</span> <span class="pre">2.8</span></code> seconds.
Run the following code to get the actual time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_runtime</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">start_time</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Runtime: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds, data:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">input_data</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">retrieve</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
<span class="n">print_runtime</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Runtime: 2.82 seconds, data:
(0, &#39;Learning&#39;)
(1, &#39;Ray&#39;)
(2, &#39;Flexible&#39;)
(3, &#39;Distributed&#39;)
(4, &#39;Python&#39;)
(5, &#39;for&#39;)
(6, &#39;Machine&#39;)
(7, &#39;Learning&#39;)
</pre></div>
</div>
</div>
</div>
<p>The total time to run the function is 2.82 seconds in this example, but time may be different for your computer.
Note that this basic Python version cannot run the function simultaneously.</p>
<p>You may expect that Python list comprehensions are more efficient. The measured runtime of 2.8 seconds is actually the worst case scenario.
Although this program “sleeps” for most of its runtime, it is slow because of the Global Interpreter Lock (GIL).</p>
<section id="ray-tasks">
<h3>Ray Tasks<a class="headerlink" href="gentle_walkthrough.html#ray-tasks" title="Permalink to this headline">#</a></h3>
<p>This task can benefit from parallelization. If it is perfectly distributed, the runtime should not take much longer than the slowest subtask,
that is, <code class="docutils literal notranslate"><span class="pre">7/10.</span> <span class="pre">=</span> <span class="pre">0.7</span></code> seconds.
To extend this example to run in parallel on Ray, start by using the &#64;ray.remote decorator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span> 


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">retrieve_task</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">retrieve</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With the decorator, the function <code class="docutils literal notranslate"><span class="pre">retrieve_task</span></code> becomes a :ref:<code class="docutils literal notranslate"><span class="pre">ray-remote-functions&lt;Ray</span> <span class="pre">task&gt;</span></code>_.
A Ray task is a function that Ray executes on a different process from where
it was called, and possibly on a different machine.</p>
<p>Ray is convenient to use because you can continue writing Python code,
without having to significantly change your approach or programming style.
Using the :func:<code class="docutils literal notranslate"><span class="pre">ray.remote()&lt;&#64;ray.remote&gt;</span></code> decorator on the retrieve function is the intended use of decorators,
and you did not modify the original code in this example.</p>
<p>To retrieve database entries and measure performance, you do not need to make many changes to the code. Here’s an overview of the process:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">object_references</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">retrieve_task</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">object_references</span><span class="p">)</span>
<span class="n">print_runtime</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-12-20 13:52:34,632	INFO worker.py:1529 -- Started a local Ray instance. View the dashboard at <span class=" -Color -Color-Bold -Color-Bold-Green">127.0.0.1:8265 </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Runtime: 2.82 seconds, data:
(0, &#39;Learning&#39;)
(1, &#39;Ray&#39;)
(2, &#39;Flexible&#39;)
(3, &#39;Distributed&#39;)
(4, &#39;Python&#39;)
(5, &#39;for&#39;)
(6, &#39;Machine&#39;)
(7, &#39;Learning&#39;)
</pre></div>
</div>
</div>
</div>
<p>Running the task in parallel requires two minor code modifications.
To execute your Ray task remotely, you must use a <code class="docutils literal notranslate"><span class="pre">.remote()</span></code> call.
Ray executes remote tasks asynchronously, even on a local cluster.
The items in the <code class="docutils literal notranslate"><span class="pre">object_references</span></code> list in the code snippet do not directly contain the results.
If you check the Python type of the first item using <code class="docutils literal notranslate"><span class="pre">type(object_references[0])</span></code>,
you see that it is actually an <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code>.
These object references correspond to <em>futures</em> for which you need to request the result.
The call :func:<code class="docutils literal notranslate"><span class="pre">ray.get()&lt;ray.get(...)&gt;</span></code> is for requesting the result. Whenever you call remote on a Ray task,
it immediately returns one or more object references.
Consider Ray tasks as the primary way of creating objects.
The following section is an example that links multiple tasks together and allows
Ray to pass and resolve the objects between them.</p>
<p>Let’s review the previous steps.
You started with a Python function, then decorated it with <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote</span></code>, making the function a Ray task.
Instead of directly calling the original function in the code, you called <code class="docutils literal notranslate"><span class="pre">.remote(...)</span></code> on the Ray task.
Finally, you retrieved the results from the Ray cluster using <code class="docutils literal notranslate"><span class="pre">.get(...)</span></code>.
Consider creating a Ray task from one of your own functions as an additional exercise.</p>
<p>Let’s review the performance gain from using Ray tasks.
On most laptops the runtime is around 0.71 seconds,
which is slightly more than the slowest subtask, which is 0.7 seconds.
You can further improve the program by leveraging more of Ray’s API.</p>
</section>
<section id="object-stores">
<h3>Object Stores<a class="headerlink" href="gentle_walkthrough.html#object-stores" title="Permalink to this headline">#</a></h3>
<p>The retrieve definition directly accesses items from the <code class="docutils literal notranslate"><span class="pre">database</span></code>. While this works well on a local Ray cluster, consider how it functions on an actual cluster with multiple computers.
A Ray cluster has a head node with a driver process and multiple worker nodes with worker processes executing tasks.
In this scenario the database is only defined on the driver, but the worker processes need access to it to run the retrieve task.
Ray’s solution for sharing objects between the driver and workers or between workers is to use
the <code class="docutils literal notranslate"><span class="pre">ray.put</span></code> function to place the data into Ray’s distributed object store.
In the <code class="docutils literal notranslate"><span class="pre">retrieve_task</span></code> definition, you can add a <code class="docutils literal notranslate"><span class="pre">db</span></code> argument to pass later as the <code class="docutils literal notranslate"><span class="pre">db_object_ref</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db_object_ref</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">retrieve_task</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">item</span> <span class="o">/</span> <span class="mf">10.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">item</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>By using the object store, you allow Ray to manage data access throughout the entire cluster.
Although the object store involves some overhead, it improves performance for larger datasets.
This step is crucial for a truly distributed environment.
Rerun the example with the <code class="docutils literal notranslate"><span class="pre">retrieve_task</span></code> function to confirm that it executes as you expect.</p>
</section>
<section id="non-blocking-calls">
<h3>Non-blocking calls<a class="headerlink" href="gentle_walkthrough.html#non-blocking-calls" title="Permalink to this headline">#</a></h3>
<p>In the previous section, you used <code class="docutils literal notranslate"><span class="pre">ray.get(object_references)</span></code> to retrieve results.
This call blocks the driver process until all results are available.
This dependency can cause problems if each database item takes several minutes to process.
More efficiency gains are possible if you allow the driver process to perform other tasks while waiting for results,
and to process results as they are completed rather than waiting for all items to finish.
Additionally, if one of the database items cannot be retrieved due to an issue like a deadlock in the database connection,
the driver hangs indefinitely.
To prevent indefinite hangs, set reasonable <code class="docutils literal notranslate"><span class="pre">timeout</span></code> values when using the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function.
For example, if you want to wait less than ten times the time of the slowest data retrieval task,
use the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function to stop the task after that time has passed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">object_references</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">retrieve_task</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">db_object_ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_references</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">finished</span><span class="p">,</span> <span class="n">object_references</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
        <span class="n">object_references</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">7.0</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">finished</span><span class="p">)</span>
    <span class="n">print_runtime</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">all_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">print_runtime</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Runtime: 0.11 seconds, data:
(0, &#39;Learning&#39;)
(1, &#39;Ray&#39;)
Runtime: 0.31 seconds, data:
(2, &#39;Flexible&#39;)
(3, &#39;Distributed&#39;)
Runtime: 0.51 seconds, data:
(4, &#39;Python&#39;)
(5, &#39;for&#39;)
Runtime: 0.71 seconds, data:
(6, &#39;Machine&#39;)
(7, &#39;Learning&#39;)
Runtime: 0.71 seconds, data:
(0, &#39;Learning&#39;)
(1, &#39;Ray&#39;)
(2, &#39;Flexible&#39;)
(3, &#39;Distributed&#39;)
(4, &#39;Python&#39;)
(5, &#39;for&#39;)
(6, &#39;Machine&#39;)
(7, &#39;Learning&#39;)
</pre></div>
</div>
</div>
</div>
<p>Instead of printing the results, you can use the retrieved values
within the <code class="docutils literal notranslate"><span class="pre">while</span></code> loop to initiate new tasks on other workers.</p>
</section>
<section id="task-dependencies">
<h3>Task dependencies<a class="headerlink" href="gentle_walkthrough.html#task-dependencies" title="Permalink to this headline">#</a></h3>
<p>You may want to perform an additional processing task on the retrieved data. For example,
use the results from the first retrieval task to query other related data from the same database (perhaps from a different table).
The code below sets up this follow-up task and executes both the <code class="docutils literal notranslate"><span class="pre">retrieve_task</span></code> and <code class="docutils literal notranslate"><span class="pre">follow_up_task</span></code> in sequence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">follow_up_task</span><span class="p">(</span><span class="n">retrieve_result</span><span class="p">):</span>
    <span class="n">original_item</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">retrieve_result</span>
    <span class="n">follow_up_result</span> <span class="o">=</span> <span class="n">retrieve</span><span class="p">(</span><span class="n">original_item</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retrieve_result</span><span class="p">,</span> <span class="n">follow_up_result</span>


<span class="n">retrieve_refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">retrieve_task</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">db_object_ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="n">follow_up_refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">follow_up_task</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">retrieve_refs</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">follow_up_refs</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((0, &#39;Learning&#39;), (1, &#39;Ray&#39;))
((2, &#39;Flexible&#39;), (3, &#39;Distributed&#39;))
((4, &#39;Python&#39;), (5, &#39;for&#39;))
((6, &#39;Machine&#39;), (7, &#39;Learning&#39;))
</pre></div>
</div>
</div>
</div>
<p>If you’re unfamiliar with asynchronous programming, this example may not be particularly impressive.
However, at second glance it might be surprising that the code runs at all.
The code appears to be a regular Python function with a few list comprehensions.</p>
<p>The function body of <code class="docutils literal notranslate"><span class="pre">follow_up_task</span></code> expects a Python tuple for its input argument <code class="docutils literal notranslate"><span class="pre">retrieve_result</span></code>.
However, when you use the <code class="docutils literal notranslate"><span class="pre">[follow_up_task.remote(ref)</span> <span class="pre">for</span> <span class="pre">ref</span> <span class="pre">in</span> <span class="pre">retrieve_refs]</span></code> command,
you are not passing tuples to the follow-up task.
Instead, you are using the <code class="docutils literal notranslate"><span class="pre">retrieve_refs</span></code> to pass in Ray object references.</p>
<p>Behind the scenes, Ray recognizes that the <code class="docutils literal notranslate"><span class="pre">follow_up_task</span></code> needs actual values,
so it <em>automatically</em> uses the <code class="docutils literal notranslate"><span class="pre">ray.get</span></code> function to resolve these futures.
Additionally, Ray creates a dependency graph for all the tasks and executes them in a way that respects their dependencies.
You don’t have to explicitly tell Ray when to wait for a previous task to be completed––it infers the order of execution.
This feature of the Ray object store is useful because you avoid copying large intermediate values
back to the driver by passing the object references to the next task and letting Ray handle the rest.</p>
<p>The next steps in the process are only scheduled once the tasks specifically designed to retrieve information are completed.
In fact, if <code class="docutils literal notranslate"><span class="pre">retrieve_refs</span></code> was called <code class="docutils literal notranslate"><span class="pre">retrieve_result</span></code>, you might not have noticed this crucial and intentional naming nuance. Ray allows you to concentrate on your work rather than the technicalities of cluster computing.
The dependency graph for the two tasks looks like this:</p>
<p><img alt="Task dependency" src="https://raw.githubusercontent.com/maxpumperla/learning_ray/main/notebooks/images/chapter_02/task_dependency.png" /></p>
</section>
<section id="ray-actors">
<h3>Ray Actors<a class="headerlink" href="gentle_walkthrough.html#ray-actors" title="Permalink to this headline">#</a></h3>
<p>This example covers one more significant aspect of Ray Core.
Up until this step, everything is essentially a function.
You used the <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote</span></code> decorator to make certain functions remote, but aside from that, you only used standard Python.</p>
<p>If you want to keep track of how often the database is being queried, you could count the results of the retrieve tasks.
However, is there a more efficient way to do this? Ideally, you want to track this in a distributed manner that can handle a large amount of data.
Ray provides a solution with actors, which run stateful computations on a cluster and can also communicate with each other.
Similar to how you create Ray tasks using decorated functions, create Ray actors using decorated Python classes.
Therefore, you can create a simple counter using a Ray actor to track the number of database calls.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">class</span> <span class="nc">DataTracker</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span>
</pre></div>
</div>
</div>
</div>
<p>The DataTracker class becomes an actor when you give it the <code class="docutils literal notranslate"><span class="pre">ray.remote</span></code> decorator. This actor is capable of tracking state,
such as a count, and its methods are Ray actor tasks that you can invoke in the same way as functions using <code class="docutils literal notranslate"><span class="pre">.remote()</span></code>.
Modify the retrieve_task to incorporate this actor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">retrieve_tracker_task</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">item</span> <span class="o">/</span> <span class="mf">10.</span><span class="p">)</span>
    <span class="n">tracker</span><span class="o">.</span><span class="n">increment</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">item</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>


<span class="n">tracker</span> <span class="o">=</span> <span class="n">DataTracker</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="n">object_references</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">retrieve_tracker_task</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">db_object_ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">object_references</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tracker</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">remote</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0, &#39;Learning&#39;), (1, &#39;Ray&#39;), (2, &#39;Flexible&#39;), (3, &#39;Distributed&#39;), (4, &#39;Python&#39;), (5, &#39;for&#39;), (6, &#39;Machine&#39;), (7, &#39;Learning&#39;)]
8
</pre></div>
</div>
</div>
</div>
<p>As expected, the outcome of this calculation is 8.
Although you don’t need actors to perform this calculation, this demonstrates a way to maintain state across the cluster, possibly involving multiple tasks.
In fact, you could pass the actor into any related task or even into the constructor of a different actor.
The Ray API is flexible, allowing for limitless possibilities.
It’s rare for distributed Python tools to allow for stateful computations,
which is especially useful for running complex distributed algorithms such as reinforcement learning.</p>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="gentle_walkthrough.html#summary" title="Permalink to this headline">#</a></h2>
<p>In this example, you only used six API methods.
These included <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> to initiate the cluster, <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote</span></code> to transform functions and classes into tasks and actors,
<code class="docutils literal notranslate"><span class="pre">ray.put()</span></code> to transfer values into Ray’s object store, and <code class="docutils literal notranslate"><span class="pre">ray.get()</span></code> to retrieve objects from the cluster.
Additionally, you used <code class="docutils literal notranslate"><span class="pre">.remote()</span></code> on actor methods or tasks to execute code on the cluster, and <code class="docutils literal notranslate"><span class="pre">ray.wait</span></code> to prevent blocking calls.</p>
<p>The Ray API consists of more than these six calls, but these six are powerful, if you’re just starting out.
To summarize more generally, the methods are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ray.init()</span></code>: Initializes your Ray cluster. Pass in an address to connect to an existing cluster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;ray.remote</span></code>: Turns functions into tasks and classes into actors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ray.put()</span></code>: Puts values into Ray’s object store.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ray.get()</span></code>: Gets values from the object store. Returns the values you’ve put there or that were computed by a task or actor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.remote()</span></code>: Runs actor methods or tasks on your Ray cluster and is used to instantiate actors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ray.wait()</span></code>: Returns two lists of object references, one with finished tasks we’re waiting for and one with unfinished tasks.</p></li>
</ul>
</section>
<section id="want-to-learn-more">
<h2>Want to learn more?<a class="headerlink" href="gentle_walkthrough.html#want-to-learn-more" title="Permalink to this headline">#</a></h2>
<p>This example is a simplified version of the Ray Core walkthrough of <a class="reference external" href="https://maxpumperla.com/learning_ray/">our “Learning Ray” book</a>.
If you liked it, check out the <a class="reference internal" href="overview.html"><span class="doc std std-doc">Ray Core Examples Gallery</span></a> or some of the ML workloads in our <a class="reference internal" href="../../ray-overview/use-cases.html"><span class="doc std std-doc">Use Case Gallery</span></a>.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="overview.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Ray Tutorials and Examples</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="monte_carlo_pi.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Monte Carlo Estimation of π</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>