
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Scheduling &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script src="../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/ray-core/scheduling/index.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Resources" href="resources.html" />
    <link rel="prev" title="Environment Dependencies" href="../handling-dependencies.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "ray-core/scheduling/index", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../walkthrough.html">
   Ray Core
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../user-guide.html">
     User Guides
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../tasks.html">
       Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ray-more-libs/actors.html">
       Actors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../objects.html">
       Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../handling-dependencies.html">
       Environment Dependencies
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="current reference internal" href="index.html#">
       Scheduling
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="resources.html">
         Resources
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../tasks/using-ray-with-gpus.html">
         GPU Support
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="placement-group.html">
         Placement Groups
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="memory-management.html">
         Memory Management
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray-oom-prevention.html">
         Out-Of-Memory Prevention
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../fault-tolerance.html">
       Fault Tolerance
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../patterns/index.html">
       Design Patterns &amp; Anti-patterns
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../advanced-topics.html">
       Advanced Topics
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/overview.html">
     Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/index.html">
     Ray Core API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fray-core/scheduling/index.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/ray-core/scheduling/index.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/ray-core/scheduling/index.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#scheduling-strategies">
   Scheduling Strategies
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#default">
     “DEFAULT”
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#spread">
     “SPREAD”
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#placementgroupschedulingstrategy">
     PlacementGroupSchedulingStrategy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#nodeaffinityschedulingstrategy">
     NodeAffinitySchedulingStrategy
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#locality-aware-scheduling">
   Locality-Aware Scheduling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#more-about-ray-scheduling">
   More about Ray Scheduling
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Scheduling</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#scheduling-strategies">
   Scheduling Strategies
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#default">
     “DEFAULT”
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#spread">
     “SPREAD”
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#placementgroupschedulingstrategy">
     PlacementGroupSchedulingStrategy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="index.html#nodeaffinityschedulingstrategy">
     NodeAffinitySchedulingStrategy
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#locality-aware-scheduling">
   Locality-Aware Scheduling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="index.html#more-about-ray-scheduling">
   More about Ray Scheduling
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="scheduling">
<span id="ray-scheduling"></span><h1>Scheduling<a class="headerlink" href="index.html#scheduling" title="Permalink to this headline">#</a></h1>
<p>For each task or actor, Ray will choose a node to run it and the scheduling decision is based on the following factors.</p>
<section id="resources">
<span id="ray-scheduling-resources"></span><h2>Resources<a class="headerlink" href="index.html#resources" title="Permalink to this headline">#</a></h2>
<p>Each task or actor has the <a class="reference internal" href="resources.html#resource-requirements"><span class="std std-ref">specified resource requirements</span></a>.
Given that, a node can be in one of the following states:</p>
<ul class="simple">
<li><p>Feasible: the node has the required resources to run the task or actor.
Depending on the current availability of these resources, there are two sub-states:</p>
<ul>
<li><p>Available: the node has the required resources and they are free now.</p></li>
<li><p>Unavailable: the node has the required resources but they are currently being used by other tasks or actors.</p></li>
</ul>
</li>
<li><p>Infeasible: the node doesn’t have the required resources. For example a CPU-only node is infeasible for a GPU task.</p></li>
</ul>
<p>Resource requirements are <strong>hard</strong> requirements meaning that only feasible nodes are eligible to run the task or actor.
If there are feasible nodes, Ray will either choose an available node or wait until a unavailable node to become available
depending on other factors discussed below.
If all nodes are infeasible, the task or actor cannot be scheduled until feasible nodes are added to the cluster.</p>
</section>
<section id="scheduling-strategies">
<span id="ray-scheduling-strategies"></span><h2>Scheduling Strategies<a class="headerlink" href="index.html#scheduling-strategies" title="Permalink to this headline">#</a></h2>
<p>Tasks or actors support a <a class="reference internal" href="../api/doc/ray.remote.html#ray.remote" title="ray.remote"><code class="xref py py-func docutils literal notranslate"><span class="pre">scheduling_strategy</span></code></a> option to specify the strategy used to decide the best node among feasible nodes.
Currently the supported strategies are the followings.</p>
<section id="default">
<h3>“DEFAULT”<a class="headerlink" href="index.html#default" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">&quot;DEFAULT&quot;</span></code> is the default strategy used by Ray.
Ray schedules tasks or actors onto a group of the top k nodes.
Specifically, the nodes are sorted to first favor those that already have tasks or actors scheduled (for locality),
then to favor those that have low resource utilization (for load balancing).
Within the top k group, nodes are chosen randomly to further improve load-balancing and mitigate delays from cold-start in large clusters.</p>
<p>Implementation-wise, Ray calculates a score for each node in a cluster based on the utilization of its logical resources.
If the utilization is below a threshold (controlled by the OS environment variable <code class="docutils literal notranslate"><span class="pre">RAY_scheduler_spread_threshold</span></code>, default is 0.5), the score is 0,
otherwise it is the resource utilization itself (score 1 means the node is fully utilized).
Ray selects the best node for scheduling by randomly picking from the top k nodes with the lowest scores.
The value of <code class="docutils literal notranslate"><span class="pre">k</span></code> is the max of (number of nodes in the cluster * <code class="docutils literal notranslate"><span class="pre">RAY_scheduler_top_k_fraction</span></code> environment variable) and <code class="docutils literal notranslate"><span class="pre">RAY_scheduler_top_k_absolute</span></code> environment variable.
By default, it’s 20% of the total number of nodes.</p>
<p>Currently Ray handles actors that don’t require any resources (i.e., <code class="docutils literal notranslate"><span class="pre">num_cpus=0</span></code> with no other resources) specially by randomly choosing a node in the cluster without considering resource utilization.
Since nodes are randomly chosen, actors that don’t require any resources are effectively SPREAD across the cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Actor</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="c1"># If unspecified, &quot;DEFAULT&quot; scheduling strategy is used.</span>
<span class="n">func</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<span class="n">actor</span> <span class="o">=</span> <span class="n">Actor</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<span class="c1"># Explicitly set scheduling strategy to &quot;DEFAULT&quot;.</span>
<span class="n">func</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">scheduling_strategy</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<span class="n">actor</span> <span class="o">=</span> <span class="n">Actor</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">scheduling_strategy</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Zero-CPU (and no other resources) actors are randomly assigned to nodes.</span>
<span class="n">actor</span> <span class="o">=</span> <span class="n">Actor</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="spread">
<h3>“SPREAD”<a class="headerlink" href="index.html#spread" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">&quot;SPREAD&quot;</span></code> strategy will try to spread the tasks or actors among available nodes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">scheduling_strategy</span><span class="o">=</span><span class="s2">&quot;SPREAD&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">spread_func</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">2</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SpreadActor</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="c1"># Spread tasks across the cluster.</span>
<span class="p">[</span><span class="n">spread_func</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="c1"># Spread actors across the cluster.</span>
<span class="n">actors</span> <span class="o">=</span> <span class="p">[</span><span class="n">SpreadActor</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">scheduling_strategy</span><span class="o">=</span><span class="s2">&quot;SPREAD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="placementgroupschedulingstrategy">
<h3>PlacementGroupSchedulingStrategy<a class="headerlink" href="index.html#placementgroupschedulingstrategy" title="Permalink to this headline">#</a></h3>
<p><a class="reference internal" href="../api/doc/ray.util.scheduling_strategies.PlacementGroupSchedulingStrategy.html#ray.util.scheduling_strategies.PlacementGroupSchedulingStrategy" title="ray.util.scheduling_strategies.PlacementGroupSchedulingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">PlacementGroupSchedulingStrategy</span></code></a> will schedule the task or actor to where the placement group is located.
This is useful for actor gang scheduling. See <a class="reference internal" href="placement-group.html#ray-placement-group-doc-ref"><span class="std std-ref">Placement Group</span></a> for more details.</p>
</section>
<section id="nodeaffinityschedulingstrategy">
<h3>NodeAffinitySchedulingStrategy<a class="headerlink" href="index.html#nodeaffinityschedulingstrategy" title="Permalink to this headline">#</a></h3>
<p><a class="reference internal" href="../api/doc/ray.util.scheduling_strategies.NodeAffinitySchedulingStrategy.html#ray.util.scheduling_strategies.NodeAffinitySchedulingStrategy" title="ray.util.scheduling_strategies.NodeAffinitySchedulingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">NodeAffinitySchedulingStrategy</span></code></a> is a low-level strategy that allows a task or actor to be scheduled onto a particular node specified by its node id.
The <code class="docutils literal notranslate"><span class="pre">soft</span></code> flag specifies whether the task or actor is allowed to run somewhere else if the specified node doesn’t exist (e.g. if the node dies)
or is infeasible because it does not have the resources required to run the task or actor.
In these cases, if <code class="docutils literal notranslate"><span class="pre">soft</span></code> is True, the task or actor will be scheduled onto a different feasible node.
Otherwise, the task or actor will fail with <a class="reference internal" href="../api/doc/ray.exceptions.TaskUnschedulableError.html#ray.exceptions.TaskUnschedulableError" title="ray.exceptions.TaskUnschedulableError"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskUnschedulableError</span></code></a> or <a class="reference internal" href="../api/doc/ray.exceptions.ActorUnschedulableError.html#ray.exceptions.ActorUnschedulableError" title="ray.exceptions.ActorUnschedulableError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ActorUnschedulableError</span></code></a>.
As long as the specified node is alive and feasible, the task or actor will only run there
regardless of the <code class="docutils literal notranslate"><span class="pre">soft</span></code> flag. This means if the node currently has no available resources, the task or actor will wait until resources
become available.
This strategy should <em>only</em> be used if other high level scheduling strategies (e.g. <a class="reference internal" href="placement-group.html#ray-placement-group-doc-ref"><span class="std std-ref">placement group</span></a>) cannot give the
desired task or actor placements. It has the following known limitations:</p>
<ul class="simple">
<li><p>It’s a low-level strategy which prevents optimizations by a smart scheduler.</p></li>
<li><p>It cannot fully utilize an autoscaling cluster since node ids must be known when the tasks or actors are created.</p></li>
<li><p>It can be difficult to make the best static placement decision
especially in a multi-tenant cluster: for example, an application won’t know what else is being scheduled onto the same nodes.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">node_affinity_func</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">ray</span><span class="o">.</span><span class="n">get_runtime_context</span><span class="p">()</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NodeAffinityActor</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="c1"># Only run the task on the local node.</span>
<span class="n">node_affinity_func</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">scheduling_strategies</span><span class="o">.</span><span class="n">NodeAffinitySchedulingStrategy</span><span class="p">(</span>
        <span class="n">node_id</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">get_runtime_context</span><span class="p">()</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">(),</span>
        <span class="n">soft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Run the two node_affinity_func tasks on the same node if possible.</span>
<span class="n">node_affinity_func</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">scheduling_strategies</span><span class="o">.</span><span class="n">NodeAffinitySchedulingStrategy</span><span class="p">(</span>
        <span class="n">node_id</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_affinity_func</span><span class="o">.</span><span class="n">remote</span><span class="p">()),</span>
        <span class="n">soft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Only run the actor on the local node.</span>
<span class="n">actor</span> <span class="o">=</span> <span class="n">NodeAffinityActor</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">scheduling_strategies</span><span class="o">.</span><span class="n">NodeAffinitySchedulingStrategy</span><span class="p">(</span>
        <span class="n">node_id</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">get_runtime_context</span><span class="p">()</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">(),</span>
        <span class="n">soft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="locality-aware-scheduling">
<span id="ray-scheduling-locality"></span><h2>Locality-Aware Scheduling<a class="headerlink" href="index.html#locality-aware-scheduling" title="Permalink to this headline">#</a></h2>
<p>By default, Ray prefers available nodes that have large task arguments local
to avoid transferring data over the network. If there are multiple large task arguments,
the node with most object bytes local is preferred.
This takes precedence over the <code class="docutils literal notranslate"><span class="pre">&quot;DEFAULT&quot;</span></code> scheduling strategy,
which means Ray will try to run the task on the locality preferred node regardless of the node resource utilization.
However, if the locality preferred node is not available, Ray may run the task somewhere else.
When other scheduling strategies are specified,
they have higher precedence and data locality is no longer considered.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Locality-aware scheduling is only for tasks not actors.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">large_object_func</span><span class="p">():</span>
    <span class="c1"># Large object is stored in the local object store</span>
    <span class="c1"># and available in the distributed memory,</span>
    <span class="c1"># instead of returning inline directly to the caller.</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">small_object_func</span><span class="p">():</span>
    <span class="c1"># Small object is returned inline directly to the caller,</span>
    <span class="c1"># instead of storing in the distributed memory.</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">consume_func</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="n">large_object</span> <span class="o">=</span> <span class="n">large_object_func</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<span class="n">small_object</span> <span class="o">=</span> <span class="n">small_object_func</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Ray will try to run consume_func on the same node</span>
<span class="c1"># where large_object_func runs.</span>
<span class="n">consume_func</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">large_object</span><span class="p">)</span>

<span class="c1"># Ray will try to spread consume_func across the entire cluster</span>
<span class="c1"># instead of only running on the node where large_object_func runs.</span>
<span class="p">[</span>
    <span class="n">consume_func</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">scheduling_strategy</span><span class="o">=</span><span class="s2">&quot;SPREAD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">large_object</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Ray won&#39;t consider locality for scheduling consume_func</span>
<span class="c1"># since the argument is small and will be sent to the worker node inline directly.</span>
<span class="n">consume_func</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">small_object</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="more-about-ray-scheduling">
<h2>More about Ray Scheduling<a class="headerlink" href="index.html#more-about-ray-scheduling" title="Permalink to this headline">#</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/using-ray-with-gpus.html">GPU Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="placement-group.html">Placement Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory-management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="ray-oom-prevention.html">Out-Of-Memory Prevention</a></li>
</ul>
</div>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../handling-dependencies.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Environment Dependencies</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="resources.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Resources</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>