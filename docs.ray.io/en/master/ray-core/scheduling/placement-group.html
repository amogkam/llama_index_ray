
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Placement Groups &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script src="../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/ray-core/scheduling/placement-group.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Memory Management" href="memory-management.html" />
    <link rel="prev" title="GPU Support" href="../tasks/using-ray-with-gpus.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "ray-core/scheduling/placement-group", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../walkthrough.html">
   Ray Core
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../user-guide.html">
     User Guides
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../tasks.html">
       Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ray-more-libs/actors.html">
       Actors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../objects.html">
       Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../handling-dependencies.html">
       Environment Dependencies
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="index.html">
       Scheduling
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4">
        <a class="reference internal" href="resources.html">
         Resources
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../tasks/using-ray-with-gpus.html">
         GPU Support
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="placement-group.html#">
         Placement Groups
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="memory-management.html">
         Memory Management
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ray-oom-prevention.html">
         Out-Of-Memory Prevention
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../fault-tolerance.html">
       Fault Tolerance
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../patterns/index.html">
       Design Patterns &amp; Anti-patterns
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../advanced-topics.html">
       Advanced Topics
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/overview.html">
     Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/index.html">
     Ray Core API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fray-core/scheduling/placement-group.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/ray-core/scheduling/placement-group.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/ray-core/scheduling/placement-group.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#key-concepts">
   Key Concepts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#bundles">
     Bundles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#placement-group">
     Placement Group
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#create-a-placement-group-reserve-resources">
   Create a Placement Group (Reserve Resources)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#schedule-tasks-and-actors-to-placement-groups-use-reserved-resources">
   Schedule Tasks and Actors to Placement Groups (Use Reserved Resources)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#placement-strategy">
   Placement Strategy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#remove-placement-groups-free-reserved-resources">
   Remove Placement Groups (Free Reserved Resources)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#observe-and-debug-placement-groups">
   Observe and Debug Placement Groups
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#inspect-placement-group-scheduling-state">
     Inspect Placement Group Scheduling State
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-child-tasks-and-actors">
   [Advanced] Child Tasks and Actors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-named-placement-group">
   [Advanced] Named Placement Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-detached-placement-group">
   [Advanced] Detached Placement Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-fault-tolerance">
   [Advanced] Fault Tolerance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#rescheduling-bundles-on-a-dead-node">
     Rescheduling Bundles on a Dead Node
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#provide-resources-for-partially-lost-bundles">
     Provide Resources for Partially Lost Bundles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#fault-tolerance-of-actors-and-tasks-that-use-the-bundle">
     Fault Tolerance of Actors and Tasks that Use the Bundle
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#api-reference">
   API Reference
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Placement Groups</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#key-concepts">
   Key Concepts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#bundles">
     Bundles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#placement-group">
     Placement Group
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#create-a-placement-group-reserve-resources">
   Create a Placement Group (Reserve Resources)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#schedule-tasks-and-actors-to-placement-groups-use-reserved-resources">
   Schedule Tasks and Actors to Placement Groups (Use Reserved Resources)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#placement-strategy">
   Placement Strategy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#remove-placement-groups-free-reserved-resources">
   Remove Placement Groups (Free Reserved Resources)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#observe-and-debug-placement-groups">
   Observe and Debug Placement Groups
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#inspect-placement-group-scheduling-state">
     Inspect Placement Group Scheduling State
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-child-tasks-and-actors">
   [Advanced] Child Tasks and Actors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-named-placement-group">
   [Advanced] Named Placement Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-detached-placement-group">
   [Advanced] Detached Placement Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#advanced-fault-tolerance">
   [Advanced] Fault Tolerance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#rescheduling-bundles-on-a-dead-node">
     Rescheduling Bundles on a Dead Node
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#provide-resources-for-partially-lost-bundles">
     Provide Resources for Partially Lost Bundles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="placement-group.html#fault-tolerance-of-actors-and-tasks-that-use-the-bundle">
     Fault Tolerance of Actors and Tasks that Use the Bundle
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="placement-group.html#api-reference">
   API Reference
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="placement-groups">
<h1>Placement Groups<a class="headerlink" href="placement-group.html#placement-groups" title="Permalink to this headline">#</a></h1>
<p id="ray-placement-group-doc-ref">Placement groups allow users to atomically reserve groups of resources across multiple nodes (i.e., gang scheduling).
They can be then used to schedule Ray tasks and actors packed as close as possible for locality (PACK), or spread apart
(SPREAD). Placement groups are generally used for gang-scheduling actors, but also support tasks.</p>
<p>Here are some real-world use cases:</p>
<ul class="simple">
<li><p><strong>Distributed Machine Learning Training</strong>: Distributed Training (e.g., <a class="reference internal" href="../../train/train.html#train-docs"><span class="std std-ref">Ray Train</span></a> and <a class="reference internal" href="../../tune.html#tune-main"><span class="std std-ref">Ray Tune</span></a>) uses the placement group APIs to enable gang scheduling. In these settings, all resources for a trial must be available at the same time. Gang scheduling is a critical technique to enable all-or-nothing scheduling for deep learning training.</p></li>
<li><p><strong>Fault tolerance in distributed training</strong>: Placement groups can be used to configure fault tolerance. In Ray Tune, it can be beneficial to pack related resources from a single trial together, so that a node failure impacts a low number of trials. In libraries that support elastic training (e.g., XGBoost-Ray), spreading the resources across multiple nodes can help to ensure that training continues even when a node dies.</p></li>
</ul>
<section id="key-concepts">
<h2>Key Concepts<a class="headerlink" href="placement-group.html#key-concepts" title="Permalink to this headline">#</a></h2>
<section id="bundles">
<h3>Bundles<a class="headerlink" href="placement-group.html#bundles" title="Permalink to this headline">#</a></h3>
<p>A <strong>bundle</strong> is a collection of “resources”. It could be a single resource, <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1}</span></code>, or a group of resources, <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">4}</span></code>.
A bundle is a unit of reservation for placement groups. “Scheduling a bundle” means we find a node that fits the bundle and reserve the resources specified by the bundle.
A bundle must be able to fit on a single node on the Ray cluster. For example, if you only have an 8 CPU node, and if you have a bundle that requires <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">9}</span></code>, this bundle cannot be scheduled.</p>
</section>
<section id="placement-group">
<h3>Placement Group<a class="headerlink" href="placement-group.html#placement-group" title="Permalink to this headline">#</a></h3>
<p>A <strong>placement group</strong> reserves the resources from the cluster. The reserved resources can only be used by tasks or actors that use the <a class="reference internal" href="placement-group.html#ray-placement-group-schedule-tasks-actors-ref"><span class="std std-ref">PlacementGroupSchedulingStrategy</span></a>.</p>
<ul class="simple">
<li><p>Placement groups are represented by a list of bundles. For example, <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1}</span> <span class="pre">*</span> <span class="pre">4</span></code> means you’d like to reserve 4 bundles of 1 CPU (i.e., it reserves 4 CPUs).</p></li>
<li><p>Bundles are then placed according to the <a class="reference internal" href="placement-group.html#pgroup-strategy"><span class="std std-ref">placement strategies</span></a> across nodes on the cluster.</p></li>
<li><p>After the placement group is created, tasks or actors can be then scheduled according to the placement group and even on individual bundles.</p></li>
</ul>
</section>
</section>
<section id="create-a-placement-group-reserve-resources">
<h2>Create a Placement Group (Reserve Resources)<a class="headerlink" href="placement-group.html#create-a-placement-group-reserve-resources" title="Permalink to this headline">#</a></h2>
<p>You can create a placement group using <code class="xref py py-func docutils literal notranslate"><span class="pre">ray.util.placement_group()</span></code>.
Placement groups take in a list of bundles and a <a class="reference internal" href="placement-group.html#pgroup-strategy"><span class="std std-ref">placement strategy</span></a>.
Note that each bundle must be able to fit on a single node on the Ray cluster.
For example, if you only have a 8 CPU node, and if you have a bundle that requires <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">9}</span></code>,
this bundle cannot be scheduled.</p>
<p>Bundles are specified by a list of dictionaries, e.g., <code class="docutils literal notranslate"><span class="pre">[{&quot;CPU&quot;:</span> <span class="pre">1},</span> <span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">1}]</span></code>).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CPU</span></code> corresponds to <code class="docutils literal notranslate"><span class="pre">num_cpus</span></code> as used in <a class="reference internal" href="../api/doc/ray.remote.html#ray.remote" title="ray.remote"><code class="xref py py-func docutils literal notranslate"><span class="pre">ray.remote</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GPU</span></code> corresponds to <code class="docutils literal notranslate"><span class="pre">num_gpus</span></code> as used in <a class="reference internal" href="../api/doc/ray.remote.html#ray.remote" title="ray.remote"><code class="xref py py-func docutils literal notranslate"><span class="pre">ray.remote</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory</span></code> corresponds to <code class="docutils literal notranslate"><span class="pre">memory</span></code> as used in <a class="reference internal" href="../api/doc/ray.remote.html#ray.remote" title="ray.remote"><code class="xref py py-func docutils literal notranslate"><span class="pre">ray.remote</span></code></a></p></li>
<li><p>Other resources corresponds to <code class="docutils literal notranslate"><span class="pre">resources</span></code> as used in <a class="reference internal" href="../api/doc/ray.remote.html#ray.remote" title="ray.remote"><code class="xref py py-func docutils literal notranslate"><span class="pre">ray.remote</span></code></a> (E.g., <code class="docutils literal notranslate"><span class="pre">ray.init(resources={&quot;disk&quot;:</span> <span class="pre">1})</span></code> can have a bundle of <code class="docutils literal notranslate"><span class="pre">{&quot;disk&quot;:</span> <span class="pre">1}</span></code>).</p></li>
</ul>
<p>Placement group scheduling is asynchronous. The <a class="reference internal" href="../api/doc/ray.util.placement_group.html#ray.util.placement_group" title="ray.util.placement_group"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ray.util.placement_group</span></code></a> returns immediately.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Import placement group APIs.</span>
<span class="kn">from</span> <span class="nn">ray.util.placement_group</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">placement_group</span><span class="p">,</span>
    <span class="n">placement_group_table</span><span class="p">,</span>
    <span class="n">remove_placement_group</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.util.scheduling_strategies</span> <span class="kn">import</span> <span class="n">PlacementGroupSchedulingStrategy</span>

<span class="c1"># Initialize Ray.</span>
<span class="kn">import</span> <span class="nn">ray</span>

<span class="c1"># Create a single node Ray cluster with 2 CPUs and 2 GPUs.</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Reserve a placement group of 1 bundle that reserves 1 CPU and 1 GPU.</span>
<span class="n">pg</span> <span class="o">=</span> <span class="n">placement_group</span><span class="p">([{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}])</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
Java</label><div class="sd-tab-content docutils">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Initialize Ray.</span><span class="w"></span>
<span class="n">Ray</span><span class="p">.</span><span class="na">init</span><span class="p">();</span><span class="w"></span>

<span class="c1">// Construct a list of bundles.</span><span class="w"></span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmutableMap</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;CPU&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bundles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmutableList</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">bundle</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Make a creation option with bundles and strategy.</span><span class="w"></span>
<span class="n">PlacementGroupCreationOptions</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">  </span><span class="k">new</span><span class="w"> </span><span class="n">PlacementGroupCreationOptions</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">setBundles</span><span class="p">(</span><span class="n">bundles</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">setStrategy</span><span class="p">(</span><span class="n">PlacementStrategy</span><span class="p">.</span><span class="na">STRICT_SPREAD</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w"></span>

<span class="n">PlacementGroup</span><span class="w"> </span><span class="n">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlacementGroups</span><span class="p">.</span><span class="na">createPlacementGroup</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-2" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
C++</label><div class="sd-tab-content docutils">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Initialize Ray.</span>
<span class="n">ray</span><span class="o">::</span><span class="n">Init</span><span class="p">();</span><span class="w"></span>

<span class="c1">// Construct a list of bundles.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bundles</span><span class="p">{{{</span><span class="s">&quot;CPU&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">}}};</span><span class="w"></span>

<span class="c1">// Make a creation option with bundles and strategy.</span>
<span class="n">ray</span><span class="o">::</span><span class="n">internal</span><span class="o">::</span><span class="n">PlacementGroupCreationOptions</span><span class="w"> </span><span class="n">options</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;my_pg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bundles</span><span class="p">,</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">internal</span><span class="o">::</span><span class="n">PlacementStrategy</span><span class="o">::</span><span class="n">PACK</span><span class="p">};</span><span class="w"></span>

<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="n">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">CreatePlacementGroup</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>You can block your program until the placement group is ready using one of two APIs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/doc/ray.util.placement_group.PlacementGroup.ready.html#ray.util.placement_group.PlacementGroup.ready" title="ray.util.placement_group.PlacementGroup.ready"><code class="xref py py-func docutils literal notranslate"><span class="pre">ready</span></code></a>, which is compatible with <code class="docutils literal notranslate"><span class="pre">ray.get</span></code></p></li>
<li><p><a class="reference internal" href="../api/doc/ray.util.placement_group.PlacementGroup.wait.html#ray.util.placement_group.PlacementGroup.wait" title="ray.util.placement_group.PlacementGroup.wait"><code class="xref py py-func docutils literal notranslate"><span class="pre">wait</span></code></a>, which blocks the program until the placement group is ready)</p></li>
</ul>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Wait until placement group is created.</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">ready</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># You can also use ray.wait.</span>
<span class="n">ready</span><span class="p">,</span> <span class="n">unready</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">wait</span><span class="p">([</span><span class="n">pg</span><span class="o">.</span><span class="n">ready</span><span class="p">()],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># You can look at placement group states using this API.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">placement_group_table</span><span class="p">(</span><span class="n">pg</span><span class="p">))</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-4" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-4">
Java</label><div class="sd-tab-content docutils">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Wait for the placement group to be ready within the specified time(unit is seconds).</span><span class="w"></span>
<span class="kt">boolean</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pg</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span><span class="w"></span>
<span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">ready</span><span class="p">);</span><span class="w"></span>

<span class="c1">// You can look at placement group states using this API.</span><span class="w"></span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">PlacementGroup</span><span class="o">&gt;</span><span class="w"> </span><span class="n">allPlacementGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlacementGroups</span><span class="p">.</span><span class="na">getAllPlacementGroups</span><span class="p">();</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="n">group</span><span class="p">:</span><span class="w"> </span><span class="n">allPlacementGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">group</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-5">
C++</label><div class="sd-tab-content docutils">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Wait for the placement group to be ready within the specified time(unit is seconds).</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pg</span><span class="p">.</span><span class="n">Wait</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">ready</span><span class="p">);</span><span class="w"></span>

<span class="c1">// You can look at placement group states using this API.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="o">&gt;</span><span class="w"> </span><span class="n">all_placement_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">GetAllPlacementGroups</span><span class="p">();</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="o">&amp;</span><span class="n">group</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">all_placement_group</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">group</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Let’s verify the placement group is successfully created.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This API is only available when you download Ray via `pip install &quot;ray[default]&quot;`</span>
ray list placement-groups
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">========</span> List: <span class="m">2023</span>-04-07 <span class="m">01</span>:15:05.682519 <span class="o">========</span>
Stats:
------------------------------
Total: <span class="m">1</span>

Table:
------------------------------
    PLACEMENT_GROUP_ID                    NAME      CREATOR_JOB_ID  STATE
<span class="m">0</span>  3cd6174711f47c14132155039c0501000000                  <span class="m">01000000</span>  CREATED
</pre></div>
</div>
<p>The placement group is successfully created. Out of the <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">2,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">2}</span></code> resources, the placement group reserves <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">1}</span></code>.
The reserved resources can only be used when you schedule tasks or actors with a placement group.
The diagram below demonstrates the “1 CPU and 1 GPU” bundle that the placement group reserved.</p>
<img alt="../../_images/pg_image_1.png" class="align-center" src="../../_images/pg_image_1.png" />
<p>Placement groups are atomically created; if a bundle cannot fit in any of the current nodes,
the entire placement group is not ready and no resources are reserved.
To illustrate, let’s create another placement group that requires <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:1},</span> <span class="pre">{&quot;GPU&quot;:</span> <span class="pre">2}</span></code> (2 bundles).</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-6">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cannot create this placement group because we</span>
<span class="c1"># cannot create a {&quot;GPU&quot;: 2} bundle.</span>
<span class="n">pending_pg</span> <span class="o">=</span> <span class="n">placement_group</span><span class="p">([{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}])</span>
<span class="c1"># This raises the timeout exception!</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pending_pg</span><span class="o">.</span><span class="n">ready</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Cannot create a placement group because &quot;</span>
        <span class="s2">&quot;{&#39;GPU&#39;: 2} bundle cannot be created.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can verify the new placement group is pending creation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This API is only available when you download Ray via `pip install &quot;ray[default]&quot;`</span>
ray list placement-groups
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">========</span> List: <span class="m">2023</span>-04-07 <span class="m">01</span>:16:23.733410 <span class="o">========</span>
Stats:
------------------------------
Total: <span class="m">2</span>

Table:
------------------------------
    PLACEMENT_GROUP_ID                    NAME      CREATOR_JOB_ID  STATE
<span class="m">0</span>  3cd6174711f47c14132155039c0501000000                  <span class="m">01000000</span>  CREATED
<span class="m">1</span>  e1b043bebc751c3081bddc24834d01000000                  <span class="m">01000000</span>  PENDING &lt;---- the new placement group.
</pre></div>
</div>
<p>You can also verify that the <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">2}</span></code> bundles cannot be allocated, using the <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code> CLI command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ray status
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Resources
---------------------------------------------------------------
Usage:
<span class="m">0</span>.0/2.0 CPU <span class="o">(</span><span class="m">0</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span>
<span class="m">0</span>.0/2.0 GPU <span class="o">(</span><span class="m">0</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span>
0B/3.46GiB memory
0B/1.73GiB object_store_memory

Demands:
<span class="o">{</span><span class="s1">&#39;CPU&#39;</span>: <span class="m">1</span>.0<span class="o">}</span> * <span class="m">1</span>, <span class="o">{</span><span class="s1">&#39;GPU&#39;</span>: <span class="m">2</span>.0<span class="o">}</span> * <span class="m">1</span> <span class="o">(</span>PACK<span class="o">)</span>: <span class="m">1</span>+ pending placement groups &lt;--- <span class="m">1</span> placement group is pending creation.
</pre></div>
</div>
<p>The current cluster has <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">2,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">2}</span></code>. We already created a <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">1}</span></code> bundle, so only <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;GPU&quot;:</span> <span class="pre">1}</span></code> is left in the cluster.
If we create 2 bundles <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1},</span> <span class="pre">{&quot;GPU&quot;:</span> <span class="pre">2}</span></code>, we can create a first bundle successfully, but can’t schedule the second bundle.
Since we cannot create every bundle on the cluster, the placement group is not created, including the <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1}</span></code> bundle.</p>
<img alt="../../_images/pg_image_2.png" class="align-center" src="../../_images/pg_image_2.png" />
<p>When the placement group cannot be scheduled in any way, it is called “infeasible”.
Imagine you schedule <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">4}</span></code> bundle, but you only have a single node with 2 CPUs. There’s no way to create this bundle in your cluster.
The Ray Autoscaler is aware of placement groups, and auto-scales the cluster to ensure pending groups can be placed as needed.</p>
<p>If Ray Autoscaler cannot provide resources to schedule a placement group, Ray does <em>not</em> print a warning about infeasible groups and tasks and actors that use the groups.
You can observe the scheduling state of the placement group from the <a class="reference internal" href="placement-group.html#ray-placement-group-observability-ref"><span class="std std-ref">dashboard or state APIs</span></a>.</p>
</section>
<section id="schedule-tasks-and-actors-to-placement-groups-use-reserved-resources">
<span id="ray-placement-group-schedule-tasks-actors-ref"></span><h2>Schedule Tasks and Actors to Placement Groups (Use Reserved Resources)<a class="headerlink" href="placement-group.html#schedule-tasks-and-actors-to-placement-groups-use-reserved-resources" title="Permalink to this headline">#</a></h2>
<p>In the previous section, we created a placement group that reserved <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;GPU:</span> <span class="pre">1&quot;}</span></code> from a 2 CPU and 2 GPU node.</p>
<p>Now let’s schedule an actor to the placement group.
You can schedule actors or tasks to a placement group using
<a class="reference internal" href="../api/doc/ray.util.scheduling_strategies.PlacementGroupSchedulingStrategy.html#ray.util.scheduling_strategies.PlacementGroupSchedulingStrategy" title="ray.util.scheduling_strategies.PlacementGroupSchedulingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">options(scheduling_strategy=PlacementGroupSchedulingStrategy(...))</span></code></a>.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-7">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Actor</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="c1"># Create an actor to a placement group.</span>
<span class="n">actor</span> <span class="o">=</span> <span class="n">Actor</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">PlacementGroupSchedulingStrategy</span><span class="p">(</span>
        <span class="n">placement_group</span><span class="o">=</span><span class="n">pg</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Verify the actor is scheduled.</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">ready</span><span class="o">.</span><span class="n">remote</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-8" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-8">
Java</label><div class="sd-tab-content docutils">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Counter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">Counter</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">initValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initValue</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">ping</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;pong&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Create GPU actors on a gpu bundle.</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">Ray</span><span class="p">.</span><span class="na">actor</span><span class="p">(</span><span class="n">Counter</span><span class="p">::</span><span class="k">new</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">setPlacementGroup</span><span class="p">(</span><span class="n">pg</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">remote</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-9">
C++</label><div class="sd-tab-content docutils">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Counter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="n">Counter</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">init_value</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">init_value</span><span class="p">){}</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">GetValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;}</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">Ping</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;pong&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Factory function of Counter class.</span>
<span class="k">static</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">*</span><span class="nf">CreateCounter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Counter</span><span class="p">();</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">RAY_REMOTE</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Counter</span><span class="o">::</span><span class="n">Ping</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Counter</span><span class="o">::</span><span class="n">GetValue</span><span class="p">,</span><span class="w"> </span><span class="n">CreateCounter</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Create GPU actors on a gpu bundle.</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ray</span><span class="o">::</span><span class="n">Actor</span><span class="p">(</span><span class="n">CreateCounter</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">SetPlacementGroup</span><span class="p">(</span><span class="n">pg</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">Remote</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you use an actor with a placement group, always specify <code class="docutils literal notranslate"><span class="pre">num_cpus</span></code>.</p>
<p>When you don’t specify (e.g., <code class="docutils literal notranslate"><span class="pre">num_cpus=0</span></code>), a placement group option is ignored,
and the task and actor don’t use the reserved resources.</p>
<p>Note that by default (with no arguments to <code class="docutils literal notranslate"><span class="pre">ray.remote</span></code>),</p>
<ul class="simple">
<li><p>Ray task requires 1 CPU</p></li>
<li><p>Ray actor requires 1 CPU when it is scheduled. But after it is created, it occupies 0 CPU.</p></li>
</ul>
<p>When scheduling an actor without resource requirements and a placement group, the placement group has to be created (since it requires 1 CPU to be scheduled).
However, when the actor is created, it ignores the placement group.</p>
</div>
<p>The actor is scheduled now! One bundle can be used by multiple tasks and actors (i.e., the bundle to task (or actor) is a one-to-many relationship).
In this case, since the actor uses 1 CPU, 1 GPU remains from the bundle.
You can verify this from the CLI command <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code>. You can see the 1 CPU is reserved by the placement group, and 1.0 is used (by the actor we created).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ray status
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Resources
---------------------------------------------------------------
Usage:
<span class="m">1</span>.0/2.0 CPU <span class="o">(</span><span class="m">1</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span> &lt;---
<span class="m">0</span>.0/2.0 GPU <span class="o">(</span><span class="m">0</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span>
0B/4.29GiB memory
0B/2.00GiB object_store_memory

Demands:
<span class="o">(</span>no resource demands<span class="o">)</span>
</pre></div>
</div>
<p>You can also verify the actor is created using <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">list</span> <span class="pre">actors</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This API is only available when you download Ray via `pip install &quot;ray[default]&quot;`</span>
ray list actors --detail
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-   actor_id: b5c990f135a7b32bfbb05e1701000000
    class_name: Actor
    death_cause: null
    is_detached: <span class="nb">false</span>
    job_id: <span class="s1">&#39;01000000&#39;</span>
    name: <span class="s1">&#39;&#39;</span>
    node_id: b552ca3009081c9de857a31e529d248ba051a4d3aeece7135dde8427
    pid: <span class="m">8795</span>
    placement_group_id: d2e660ac256db230dbe516127c4a01000000 &lt;------
    ray_namespace: e5b19111-306c-4cd8-9e4f-4b13d42dff86
    repr_name: <span class="s1">&#39;&#39;</span>
    required_resources:
        CPU_group_d2e660ac256db230dbe516127c4a01000000: <span class="m">1</span>.0
    serialized_runtime_env: <span class="s1">&#39;{}&#39;</span>
    state: ALIVE
</pre></div>
</div>
<p>Since 1 GPU remains, let’s create a new actor that requires 1 GPU.
This time, we also specify the <code class="docutils literal notranslate"><span class="pre">placement_group_bundle_index</span></code>. Each bundle is given an “index” within the placement group.
For example, a placement group of 2 bundles <code class="docutils literal notranslate"><span class="pre">[{&quot;CPU&quot;:</span> <span class="pre">1},</span> <span class="pre">{&quot;GPU&quot;:</span> <span class="pre">1}]</span></code> has index 0 bundle <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">1}</span></code>
and index 1 bundle <code class="docutils literal notranslate"><span class="pre">{&quot;GPU&quot;:</span> <span class="pre">1}</span></code>. Since we only have 1 bundle, we only have index 0. If you don’t specify a bundle, the actor (or task)
is scheduled on a random bundle that has unallocated reserved resources.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-10" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-10">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Actor</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="c1"># Create a GPU actor on the first bundle of index 0.</span>
<span class="n">actor2</span> <span class="o">=</span> <span class="n">Actor</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">PlacementGroupSchedulingStrategy</span><span class="p">(</span>
        <span class="n">placement_group</span><span class="o">=</span><span class="n">pg</span><span class="p">,</span>
        <span class="n">placement_group_bundle_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Verify that the GPU actor is scheduled.</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">actor2</span><span class="o">.</span><span class="n">ready</span><span class="o">.</span><span class="n">remote</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We succeed to schedule the GPU actor! The below image describes 2 actors scheduled into the placement group.</p>
<img alt="../../_images/pg_image_3.png" class="align-center" src="../../_images/pg_image_3.png" />
<p>You can also verify that the reserved resources are all used, with the <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ray status
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Resources
---------------------------------------------------------------
Usage:
<span class="m">1</span>.0/2.0 CPU <span class="o">(</span><span class="m">1</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span>
<span class="m">1</span>.0/2.0 GPU <span class="o">(</span><span class="m">1</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span> &lt;----
0B/4.29GiB memory
0B/2.00GiB object_store_memory
</pre></div>
</div>
</section>
<section id="placement-strategy">
<span id="pgroup-strategy"></span><h2>Placement Strategy<a class="headerlink" href="placement-group.html#placement-strategy" title="Permalink to this headline">#</a></h2>
<p>One of the features the placement group provides is to add placement constraints among bundles.</p>
<p>For example, you’d like to pack your bundles to the same
node or spread out to multiple nodes as much as possible. You can specify the strategy via <code class="docutils literal notranslate"><span class="pre">strategy</span></code> argument.
This way, you can make sure your actors and tasks can be scheduled with certain placement constraints.</p>
<p>The example below creates a placement group with 2 bundles with a PACK strategy;
both bundles have to be created in the same node. Note that it is a soft policy. If the bundles cannot be packed
into a single node, they are spread to other nodes. If you’d like to avoid the problem, you can instead use <code class="xref py py-obj docutils literal notranslate"><span class="pre">STRICT_PACK</span></code>
policies, which fail to create placement groups if placement requirements cannot be satisfied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reserve a placement group of 2 bundles</span>
<span class="c1"># that have to be packed on the same node.</span>
<span class="n">pg</span> <span class="o">=</span> <span class="n">placement_group</span><span class="p">([{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}],</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;PACK&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The image below demonstrates the PACK policy. Three of the <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">2}</span></code> bundles are located in the same node.</p>
<img alt="../../_images/pg_image_4.png" class="align-center" src="../../_images/pg_image_4.png" />
<p>The image below demonstrates the SPREAD policy. Each of three of the <code class="docutils literal notranslate"><span class="pre">{&quot;CPU&quot;:</span> <span class="pre">2}</span></code> bundles are located in three different nodes.</p>
<img alt="../../_images/pg_image_5.png" class="align-center" src="../../_images/pg_image_5.png" />
<p>Ray supports four placement group strategies. The default scheduling policy is <code class="docutils literal notranslate"><span class="pre">PACK</span></code>.</p>
<p><strong>STRICT_PACK</strong></p>
<p>All bundles must be placed into a single node on the cluster. Use this strategy when you want to maximize the locality.</p>
<p><strong>PACK</strong></p>
<p>All provided bundles are packed onto a single node on a best-effort basis.
If strict packing is not feasible (i.e., some bundles do not fit on the node), bundles can be placed onto other nodes.</p>
<p><strong>STRICT_SPREAD</strong></p>
<p>Each bundle must be scheduled in a separate node.</p>
<p><strong>SPREAD</strong></p>
<p>Each bundle is spread onto separate nodes on a best-effort basis.
If strict spreading is not feasible, bundles can be placed on overlapping nodes.</p>
</section>
<section id="remove-placement-groups-free-reserved-resources">
<h2>Remove Placement Groups (Free Reserved Resources)<a class="headerlink" href="placement-group.html#remove-placement-groups-free-reserved-resources" title="Permalink to this headline">#</a></h2>
<p>By default, a placement group’s lifetime is scoped to the driver that creates placement groups
(unless you make it a <a class="reference internal" href="placement-group.html#placement-group-detached"><span class="std std-ref">detached placement group</span></a>). When the placement group is created from
a <a class="reference internal" href="../actors/named-actors.html#actor-lifetimes"><span class="std std-ref">detached actor</span></a>, the lifetime is scoped to the detached actor.
In Ray, the driver is the Python script that calls <code class="docutils literal notranslate"><span class="pre">ray.init</span></code>.</p>
<p>Reserved resources (bundles) from the placement group are automatically freed when the driver or detached actor
that creates placement group exits. To free the reserved resources manually, remove the placement
group using the <a class="reference internal" href="../api/doc/ray.util.remove_placement_group.html#ray.util.remove_placement_group" title="ray.util.remove_placement_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">remove_placement_group</span></code></a> API (which is also an asynchronous API).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you remove the placement group, actors or tasks that still use the reserved resources are
forcefully killed.</p>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-11" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-11">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This API is asynchronous.</span>
<span class="n">remove_placement_group</span><span class="p">(</span><span class="n">pg</span><span class="p">)</span>

<span class="c1"># Wait until placement group is killed.</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Check that the placement group has died.</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">placement_group_table</span><span class="p">(</span><span class="n">pg</span><span class="p">))</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{&#39;bundles&#39;: {0: {&#39;GPU&#39;: 1.0}, 1: {&#39;CPU&#39;: 1.0}},</span>
<span class="sd">&#39;name&#39;: &#39;unnamed_group&#39;,</span>
<span class="sd">&#39;placement_group_id&#39;: &#39;40816b6ad474a6942b0edb45809b39c3&#39;,</span>
<span class="sd">&#39;state&#39;: &#39;REMOVED&#39;,</span>
<span class="sd">&#39;strategy&#39;: &#39;PACK&#39;}</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-12" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-12">
Java</label><div class="sd-tab-content docutils">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PlacementGroups</span><span class="p">.</span><span class="na">removePlacementGroup</span><span class="p">(</span><span class="n">placementGroup</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w"></span>

<span class="n">PlacementGroup</span><span class="w"> </span><span class="n">removedPlacementGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlacementGroups</span><span class="p">.</span><span class="na">getPlacementGroup</span><span class="p">(</span><span class="n">placementGroup</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w"></span>
<span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">removedPlacementGroup</span><span class="p">.</span><span class="na">getState</span><span class="p">(),</span><span class="w"> </span><span class="n">PlacementGroupState</span><span class="p">.</span><span class="na">REMOVED</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-13">
C++</label><div class="sd-tab-content docutils">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">ray</span><span class="o">::</span><span class="n">RemovePlacementGroup</span><span class="p">(</span><span class="n">placement_group</span><span class="p">.</span><span class="n">GetID</span><span class="p">());</span><span class="w"></span>

<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="n">removed_placement_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">GetPlacementGroup</span><span class="p">(</span><span class="n">placement_group</span><span class="p">.</span><span class="n">GetID</span><span class="p">());</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">removed_placement_group</span><span class="p">.</span><span class="n">GetState</span><span class="p">(),</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroupState</span><span class="o">::</span><span class="n">REMOVED</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="observe-and-debug-placement-groups">
<span id="ray-placement-group-observability-ref"></span><h2>Observe and Debug Placement Groups<a class="headerlink" href="placement-group.html#observe-and-debug-placement-groups" title="Permalink to this headline">#</a></h2>
<p>Ray provides several useful tools to inspect the placement group states and resource usage.</p>
<ul class="simple">
<li><p><strong>Ray Status</strong> is a CLI tool for viewing the resource usage and scheduling resource requirements of placement groups.</p></li>
<li><p><strong>Ray Dashboard</strong> is a UI tool for inspecting placement group states.</p></li>
<li><p><strong>Ray State API</strong> is a CLI for inspecting placement group states.</p></li>
</ul>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-14" name="sd-tab-set-6" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-14">
ray status (CLI)</label><div class="sd-tab-content docutils">
<p>The CLI command <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code> provides the autoscaling status of the cluster.
It provides the “resource demands” from unscheduled placement groups as well as the resource reservation status.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Resources
---------------------------------------------------------------
Usage:
<span class="m">1</span>.0/2.0 CPU <span class="o">(</span><span class="m">1</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span>
<span class="m">0</span>.0/2.0 GPU <span class="o">(</span><span class="m">0</span>.0 used of <span class="m">1</span>.0 reserved <span class="k">in</span> placement groups<span class="o">)</span>
0B/4.29GiB memory
0B/2.00GiB object_store_memory
</pre></div>
</div>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-6" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-15">
Dashboard</label><div class="sd-tab-content docutils">
<p>The <a class="reference internal" href="../../ray-observability/getting-started.html#dash-jobs-view"><span class="std std-ref">dashboard job view</span></a> provides the placement group table that displays the scheduling state and metadata of the placement group.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ray dashboard is only available when you install Ray is with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">&quot;ray[default]&quot;</span></code>.</p>
</div>
</div>
<input id="sd-tab-item-16" name="sd-tab-set-6" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-16">
Ray State API</label><div class="sd-tab-content docutils">
<p><a class="reference internal" href="../../ray-observability/user-guides/cli-sdk.html#state-api-overview-ref"><span class="std std-ref">Ray state API</span></a> is a CLI tool for inspecting the state of Ray resources (tasks, actors, placement groups, etc.).</p>
<p><code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">list</span> <span class="pre">placement-groups</span></code> provides the metadata and the scheduling state of the placement group.
<code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">list</span> <span class="pre">placement-groups</span> <span class="pre">--detail</span></code> provides statistics and scheduling state in a greater detail.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>State API is only available when you install Ray is with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">&quot;ray[default]&quot;</span></code></p>
</div>
</div>
</div>
<section id="inspect-placement-group-scheduling-state">
<h3>Inspect Placement Group Scheduling State<a class="headerlink" href="placement-group.html#inspect-placement-group-scheduling-state" title="Permalink to this headline">#</a></h3>
<p>With the above tools, you can see the state of the placement group. The definition of states are specified in the following files:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ray-project/ray/blob/03a9d2166988b16b7cbf51dac0e6e586455b28d8/src/ray/protobuf/gcs.proto#L579">High level state</a></p></li>
<li><p><a class="reference external" href="https://github.com/ray-project/ray/blob/03a9d2166988b16b7cbf51dac0e6e586455b28d8/src/ray/protobuf/gcs.proto#L524">Details</a></p></li>
</ul>
<img alt="../../_images/pg_image_6.png" class="align-center" src="../../_images/pg_image_6.png" />
</section>
</section>
<section id="advanced-child-tasks-and-actors">
<h2>[Advanced] Child Tasks and Actors<a class="headerlink" href="placement-group.html#advanced-child-tasks-and-actors" title="Permalink to this headline">#</a></h2>
<p>By default, child actors and tasks don’t share the same placement group that the parent uses.
To automatically schedule child actors or tasks to the same placement group,
set <code class="docutils literal notranslate"><span class="pre">placement_group_capture_child_tasks</span></code> to True.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-17" name="sd-tab-set-7" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-17">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray.util.placement_group</span> <span class="kn">import</span> <span class="n">placement_group</span>
<span class="kn">from</span> <span class="nn">ray.util.scheduling_strategies</span> <span class="kn">import</span> <span class="n">PlacementGroupSchedulingStrategy</span>

<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Create a placement group.</span>
<span class="n">pg</span> <span class="o">=</span> <span class="n">placement_group</span><span class="p">([{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}])</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">ready</span><span class="p">())</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">child</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">time</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parent</span><span class="p">():</span>
    <span class="c1"># The child task is scheduled to the same placement group as its parent,</span>
    <span class="c1"># although it didn&#39;t specify the PlacementGroupSchedulingStrategy.</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">remote</span><span class="p">())</span>


<span class="c1"># Since the child and parent use 1 CPU each, the placement group</span>
<span class="c1"># bundle {&quot;CPU&quot;: 2} is fully occupied.</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
        <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">PlacementGroupSchedulingStrategy</span><span class="p">(</span>
            <span class="n">placement_group</span><span class="o">=</span><span class="n">pg</span><span class="p">,</span> <span class="n">placement_group_capture_child_tasks</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-18" name="sd-tab-set-7" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-18">
Java</label><div class="sd-tab-content docutils">
<p>It’s not implemented for Java APIs yet.</p>
</div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">placement_group_capture_child_tasks</span></code> is True, but you don’t want to schedule
child tasks and actors to the same placement group, specify <code class="docutils literal notranslate"><span class="pre">PlacementGroupSchedulingStrategy(placement_group=None)</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">parent</span><span class="p">():</span>
    <span class="c1"># In this case, the child task isn&#39;t</span>
    <span class="c1"># scheduled with the parent&#39;s placement group.</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">child</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
            <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">PlacementGroupSchedulingStrategy</span><span class="p">(</span><span class="n">placement_group</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
    <span class="p">)</span>


<span class="c1"># This times out because we cannot schedule the child task.</span>
<span class="c1"># The cluster has {&quot;CPU&quot;: 2}, and both of them are reserved by</span>
<span class="c1"># the placement group with a bundle {&quot;CPU&quot;: 2}. Since the child shouldn&#39;t</span>
<span class="c1"># be scheduled within this placement group, it cannot be scheduled because</span>
<span class="c1"># there&#39;s no available CPU resources.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
            <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">PlacementGroupSchedulingStrategy</span><span class="p">(</span>
                <span class="n">placement_group</span><span class="o">=</span><span class="n">pg</span><span class="p">,</span> <span class="n">placement_group_capture_child_tasks</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">(),</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t create a child task!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-named-placement-group">
<h2>[Advanced] Named Placement Group<a class="headerlink" href="placement-group.html#advanced-named-placement-group" title="Permalink to this headline">#</a></h2>
<p>A placement group can be given a globally unique name.
This allows you to retrieve the placement group from any job in the Ray cluster.
This can be useful if you cannot directly pass the placement group handle to
the actor or task that needs it, or if you are trying to
access a placement group launched by another driver.
Note that the placement group is still destroyed if its lifetime isn’t <code class="xref py py-obj docutils literal notranslate"><span class="pre">detached</span></code>.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-19" name="sd-tab-set-8" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-19">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># first_driver.py</span>
<span class="c1"># Create a placement group with a global name.</span>
<span class="n">pg</span> <span class="o">=</span> <span class="n">placement_group</span><span class="p">([{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_name&quot;</span><span class="p">)</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">ready</span><span class="p">())</span>

<span class="c1"># second_driver.py</span>
<span class="c1"># Retrieve a placement group with a global name.</span>
<span class="n">pg</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_placement_group</span><span class="p">(</span><span class="s2">&quot;global_name&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-20" name="sd-tab-set-8" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-20">
Java</label><div class="sd-tab-content docutils">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a placement group with a unique name.</span><span class="w"></span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmutableMap</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;CPU&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bundles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmutableList</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">bundle</span><span class="p">);</span><span class="w"></span>

<span class="n">PlacementGroupCreationOptions</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">  </span><span class="k">new</span><span class="w"> </span><span class="n">PlacementGroupCreationOptions</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">setBundles</span><span class="p">(</span><span class="n">bundles</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">setStrategy</span><span class="p">(</span><span class="n">PlacementStrategy</span><span class="p">.</span><span class="na">STRICT_SPREAD</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;global_name&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w"></span>

<span class="n">PlacementGroup</span><span class="w"> </span><span class="n">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlacementGroups</span><span class="p">.</span><span class="na">createPlacementGroup</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>
<span class="n">pg</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span><span class="w"></span>

<span class="p">...</span><span class="w"></span>

<span class="c1">// Retrieve the placement group later somewhere.</span><span class="w"></span>
<span class="n">PlacementGroup</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlacementGroups</span><span class="p">.</span><span class="na">getPlacementGroup</span><span class="p">(</span><span class="s">&quot;global_name&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">group</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-21" name="sd-tab-set-8" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-21">
C++</label><div class="sd-tab-content docutils">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a placement group with a globally unique name.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bundles</span><span class="p">{{{</span><span class="s">&quot;CPU&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">}}};</span><span class="w"></span>

<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroupCreationOptions</span><span class="w"> </span><span class="n">options</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">true</span><span class="cm">/*global*/</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;global_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bundles</span><span class="p">,</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">PlacementStrategy</span><span class="o">::</span><span class="n">STRICT_SPREAD</span><span class="p">};</span><span class="w"></span>

<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="n">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">CreatePlacementGroup</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>
<span class="n">pg</span><span class="p">.</span><span class="n">Wait</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span><span class="w"></span>

<span class="p">...</span><span class="w"></span>

<span class="c1">// Retrieve the placement group later somewhere.</span>
<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">GetGlobalPlacementGroup</span><span class="p">(</span><span class="s">&quot;global_name&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">group</span><span class="p">.</span><span class="n">Empty</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
<p>We also support non-global named placement group in C++, which means that the placement group name is only valid within the job and cannot be accessed from another job.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a placement group with a job-scope-unique name.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bundles</span><span class="p">{{{</span><span class="s">&quot;CPU&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">}}};</span><span class="w"></span>

<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroupCreationOptions</span><span class="w"> </span><span class="n">options</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">false</span><span class="cm">/*non-global*/</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;non_global_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bundles</span><span class="p">,</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">PlacementStrategy</span><span class="o">::</span><span class="n">STRICT_SPREAD</span><span class="p">};</span><span class="w"></span>

<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="n">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">CreatePlacementGroup</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>
<span class="n">pg</span><span class="p">.</span><span class="n">Wait</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span><span class="w"></span>

<span class="p">...</span><span class="w"></span>

<span class="c1">// Retrieve the placement group later somewhere in the same job.</span>
<span class="n">ray</span><span class="o">::</span><span class="n">PlacementGroup</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="o">::</span><span class="n">GetPlacementGroup</span><span class="p">(</span><span class="s">&quot;non_global_name&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">group</span><span class="p">.</span><span class="n">Empty</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="advanced-detached-placement-group">
<span id="placement-group-detached"></span><h2>[Advanced] Detached Placement Group<a class="headerlink" href="placement-group.html#advanced-detached-placement-group" title="Permalink to this headline">#</a></h2>
<p>By default, the lifetimes of placement groups belong to the driver and actor.</p>
<ul class="simple">
<li><p>If the placement group is created from a driver, it is destroyed when the driver is terminated.</p></li>
<li><p>If it is created from a detached actor, it is killed when the detached actor is killed.</p></li>
</ul>
<p>To keep the placement group alive regardless of its job or detached actor, specify
<code class="xref py py-obj docutils literal notranslate"><span class="pre">lifetime=&quot;detached&quot;</span></code>. For example:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-22" name="sd-tab-set-9" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-22">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># driver_1.py</span>
<span class="c1"># Create a detached placement group that survives even after</span>
<span class="c1"># the job terminates.</span>
<span class="n">pg</span> <span class="o">=</span> <span class="n">placement_group</span><span class="p">([{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}],</span> <span class="n">lifetime</span><span class="o">=</span><span class="s2">&quot;detached&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_name&quot;</span><span class="p">)</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">ready</span><span class="p">())</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-23" name="sd-tab-set-9" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-23">
Java</label><div class="sd-tab-content docutils">
<p>The lifetime argument is not implemented for Java APIs yet.</p>
</div>
</div>
<p>Let’s terminate the current script and start a new Python script. Call <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">list</span> <span class="pre">placement-groups</span></code>, and you can see the placement group is not removed.</p>
<p>Note that the lifetime option is decoupled from the name. If we only specified
the name without specifying <code class="docutils literal notranslate"><span class="pre">lifetime=&quot;detached&quot;</span></code>, then the placement group can
only be retrieved as long as the original driver is still running.
It is recommended to always specify the name when creating the detached placement group.</p>
</section>
<section id="advanced-fault-tolerance">
<h2>[Advanced] Fault Tolerance<a class="headerlink" href="placement-group.html#advanced-fault-tolerance" title="Permalink to this headline">#</a></h2>
<section id="rescheduling-bundles-on-a-dead-node">
<span id="ray-placement-group-ft-ref"></span><h3>Rescheduling Bundles on a Dead Node<a class="headerlink" href="placement-group.html#rescheduling-bundles-on-a-dead-node" title="Permalink to this headline">#</a></h3>
<p>If nodes that contain some bundles of a placement group die, all the bundles are rescheduled on different nodes by
GCS (i.e., we try reserving resources again). This means that the initial creation of placement group is “atomic”,
but once it is created, there could be partial placement groups.
Rescheduling bundles have higher scheduling priority than other placement group scheduling.</p>
</section>
<section id="provide-resources-for-partially-lost-bundles">
<h3>Provide Resources for Partially Lost Bundles<a class="headerlink" href="placement-group.html#provide-resources-for-partially-lost-bundles" title="Permalink to this headline">#</a></h3>
<p>If there are not enough resources to schedule the partially lost bundles,
the placement group waits, assuming Ray Autoscaler will start a new node to satisfy the resource requirements.
If the additional resources cannot be provided (e.g., you don’t use the Autoscaler or the Autoscaler hits the resource limit),
the placement group remains in the partially created state indefinitely.</p>
</section>
<section id="fault-tolerance-of-actors-and-tasks-that-use-the-bundle">
<h3>Fault Tolerance of Actors and Tasks that Use the Bundle<a class="headerlink" href="placement-group.html#fault-tolerance-of-actors-and-tasks-that-use-the-bundle" title="Permalink to this headline">#</a></h3>
<p>Actors and tasks that use the bundle (reserved resources) are rescheduled based on their <a class="reference internal" href="../fault-tolerance.html#fault-tolerance"><span class="std std-ref">fault tolerant policy</span></a> once the
bundle is recovered.</p>
</section>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="placement-group.html#api-reference" title="Permalink to this headline">#</a></h2>
<p><a class="reference internal" href="../api/scheduling.html#ray-placement-group-ref"><span class="std std-ref">Placement Group API reference</span></a></p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../tasks/using-ray-with-gpus.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">GPU Support</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="memory-management.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Memory Management</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>