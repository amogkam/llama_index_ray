
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Set Up FastAPI and HTTP &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/versionwarning.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../_static/js/docsearch.js"></script>
    <script src="../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../_static/js/termynal.js"></script>
    <script defer="defer" src="../_static/js/custom.js"></script>
    <script defer="defer" src="../_static/js/top-navigation.js"></script>
    <script src="../_static/js/tags.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/serve/http-guide.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Production Guide" href="production-guide/index.html" />
    <link rel="prev" title="Model Multiplexing" href="deploy-many-models/model-multiplexing.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "serve/http-guide", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".md", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Ray Serve
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="getting_started.html">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="model_composition.html">
     Deploy a Composition of Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="deploy-many-models/index.html">
     Deploy Many Models
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="http-guide.html#">
     Set Up FastAPI and HTTP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="production-guide/index.html">
     Production Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monitoring.html">
     Monitor Your Application
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scaling-and-resource-allocation.html">
     Set Up Autoscaling and Resource Allocation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advanced-guides/index.html">
     Advanced Guides
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="architecture.html">
     Architecture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorials/index.html">
     Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/index.html">
     Ray Serve API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fserve/http-guide.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/serve/http-guide.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/serve/http-guide.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#choosing-the-right-http-feature">
   Choosing the right HTTP feature
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#calling-deployments-via-http">
   Calling Deployments via HTTP
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#fastapi-http-deployments">
   FastAPI HTTP Deployments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#streaming-responses">
   Streaming Responses
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#http-adapters">
   HTTP Adapters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#ray-air-predictor">
     Ray AIR
     <code class="docutils literal notranslate">
      <span class="pre">
       Predictor
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#serve-deployment-graph-dagdriver">
     Serve Deployment Graph
     <code class="docutils literal notranslate">
      <span class="pre">
       DAGDriver
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#embedded-in-your-existing-fastapi-application">
     Embedded in your existing
     <code class="docutils literal notranslate">
      <span class="pre">
       FastAPI
      </span>
     </code>
     Application
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#pydantic-models-as-adapters">
     Pydantic models as adapters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#list-of-built-in-adapters">
     List of built-in adapters
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Set Up FastAPI and HTTP</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#choosing-the-right-http-feature">
   Choosing the right HTTP feature
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#calling-deployments-via-http">
   Calling Deployments via HTTP
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#fastapi-http-deployments">
   FastAPI HTTP Deployments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#streaming-responses">
   Streaming Responses
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="http-guide.html#http-adapters">
   HTTP Adapters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#ray-air-predictor">
     Ray AIR
     <code class="docutils literal notranslate">
      <span class="pre">
       Predictor
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#serve-deployment-graph-dagdriver">
     Serve Deployment Graph
     <code class="docutils literal notranslate">
      <span class="pre">
       DAGDriver
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#embedded-in-your-existing-fastapi-application">
     Embedded in your existing
     <code class="docutils literal notranslate">
      <span class="pre">
       FastAPI
      </span>
     </code>
     Application
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#pydantic-models-as-adapters">
     Pydantic models as adapters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="http-guide.html#list-of-built-in-adapters">
     List of built-in adapters
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="set-up-fastapi-and-http">
<span id="serve-set-up-fastapi-http"></span><h1>Set Up FastAPI and HTTP<a class="headerlink" href="http-guide.html#set-up-fastapi-and-http" title="Permalink to this headline">#</a></h1>
<p>This section helps you understand how to:</p>
<ul class="simple">
<li><p>send HTTP requests to Serve deployments</p></li>
<li><p>use Ray Serve to integrate with FastAPI</p></li>
<li><p>use customized HTTP adapters</p></li>
<li><p>choose which feature to use for your use case</p></li>
</ul>
<section id="choosing-the-right-http-feature">
<h2>Choosing the right HTTP feature<a class="headerlink" href="http-guide.html#choosing-the-right-http-feature" title="Permalink to this headline">#</a></h2>
<p>Serve offers a layered approach to expose your model with the right HTTP API.</p>
<p>Considering your use case, you can choose the right level of abstraction:</p>
<ul class="simple">
<li><p>If you are comfortable working with the raw request object, use <a class="reference internal" href="http-guide.html#serve-http"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">starlette.request.Requests</span></code> API</span></a>.</p></li>
<li><p>If you want a fully fledged API server with validation and doc generation, use the <a class="reference internal" href="http-guide.html#serve-fastapi-http"><span class="std std-ref">FastAPI integration</span></a>.</p></li>
<li><p>If you just want a pre-defined HTTP schema, use the <a class="reference internal" href="http-guide.html#serve-http-adapters"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">DAGDriver</span></code> with <code class="docutils literal notranslate"><span class="pre">http_adapter</span></code></span></a>.</p></li>
</ul>
</section>
<section id="calling-deployments-via-http">
<span id="serve-http"></span><h2>Calling Deployments via HTTP<a class="headerlink" href="http-guide.html#calling-deployments-via-http" title="Permalink to this headline">#</a></h2>
<p>When you deploy a Serve application, the <a class="reference internal" href="key-concepts.html#serve-key-concepts-ingress-deployment"><span class="std std-ref">ingress deployment</span></a> (the one passed to <code class="docutils literal notranslate"><span class="pre">serve.run</span></code>) will be exposed over HTTP.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">starlette.requests</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span>
<span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">starlette</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span>


<span class="n">serve</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Counter</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000?a=b&amp;c=d&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Requests to the Serve HTTP server at <code class="docutils literal notranslate"><span class="pre">/</span></code> are routed to the deployment’s <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method with a <a class="reference external" href="https://www.starlette.io/requests/">Starlette Request object</a> as the sole argument. The <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method can return any JSON-serializable object or a <a class="reference external" href="https://www.starlette.io/responses/">Starlette Response object</a> (e.g., to return a custom status code or custom headers).</p>
<p>Often for ML models, you just need the API to accept a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array. You can use Serve’s <code class="docutils literal notranslate"><span class="pre">DAGDriver</span></code> to simplify the request parsing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>
<span class="kn">from</span> <span class="nn">ray.serve.drivers</span> <span class="kn">import</span> <span class="n">DAGDriver</span>
<span class="kn">from</span> <span class="nn">ray.serve.http_adapters</span> <span class="kn">import</span> <span class="n">json_to_ndarray</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


<span class="n">serve</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">DAGDriver</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">bind</span><span class="p">(),</span> <span class="n">http_adapter</span><span class="o">=</span><span class="n">json_to_ndarray</span><span class="p">))</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]})</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="mi">8</span>

</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serve provides a library of HTTP adapters to help you avoid boilerplate code. The <a class="reference internal" href="http-guide.html#serve-http-adapters"><span class="std std-ref">later section</span></a> dives deeper into how these works.</p>
</div>
</section>
<section id="fastapi-http-deployments">
<span id="serve-fastapi-http"></span><h2>FastAPI HTTP Deployments<a class="headerlink" href="http-guide.html#fastapi-http-deployments" title="Permalink to this headline">#</a></h2>
<p>If you want to define more complex HTTP handling logic, Serve integrates with <a class="reference external" href="https://fastapi.tiangolo.com/">FastAPI</a>. This allows you to define a Serve deployment using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">&#64;serve.ingress</span></code> decorator that wraps a FastAPI app with its full range of features. The most basic example of this is shown below, but for more details on all that FastAPI has to offer such as variable routes, automatic type validation, dependency injection (e.g., for database connections), and more, please check out <a class="reference external" href="https://fastapi.tiangolo.com/">their documentation</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span><span class="p">(</span><span class="n">route_prefix</span><span class="o">=</span><span class="s2">&quot;/hello&quot;</span><span class="p">)</span>
<span class="nd">@serve</span><span class="o">.</span><span class="n">ingress</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyFastAPIDeployment</span><span class="p">:</span>
    <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Hello, world!&quot;</span>


<span class="n">serve</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">MyFastAPIDeployment</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/hello&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Hello, world!&quot;</span>
</pre></div>
</div>
<p>Now if you send a request to <code class="docutils literal notranslate"><span class="pre">/hello</span></code>, this will be routed to the <code class="docutils literal notranslate"><span class="pre">root</span></code> method of our deployment. We can also easily leverage FastAPI to define multiple routes with different HTTP methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span><span class="p">(</span><span class="n">route_prefix</span><span class="o">=</span><span class="s2">&quot;/hello&quot;</span><span class="p">)</span>
<span class="nd">@serve</span><span class="o">.</span><span class="n">ingress</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyFastAPIDeployment</span><span class="p">:</span>
    <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Hello, world!&quot;</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{subpath}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello from </span><span class="si">{</span><span class="n">subpath</span><span class="si">}</span><span class="s2">!&quot;</span>


<span class="n">serve</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">MyFastAPIDeployment</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/hello/Serve&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Hello from Serve!&quot;</span>
</pre></div>
</div>
<p>You can also pass in an existing FastAPI app to a deployment to serve it as-is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello from the root!&quot;</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span><span class="p">(</span><span class="n">route_prefix</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="nd">@serve</span><span class="o">.</span><span class="n">ingress</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">FastAPIWrapper</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="n">serve</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">FastAPIWrapper</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Hello from the root!&quot;</span>
</pre></div>
</div>
<p>This is useful for scaling out an existing FastAPI app with no modifications necessary.
Existing middlewares, <strong>automatic OpenAPI documentation generation</strong>, and other advanced FastAPI features should work as-is.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serve currently does not support WebSockets. If you have a use case that requires it, please <a class="reference external" href="https://github.com/ray-project/ray/issues/new/choose">let us know</a>!</p>
</div>
</section>
<section id="streaming-responses">
<span id="serve-http-streaming-response"></span><h2>Streaming Responses<a class="headerlink" href="http-guide.html#streaming-responses" title="Permalink to this headline">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Support for HTTP streaming responses is experimental. To enable this feature, set <code class="docutils literal notranslate"><span class="pre">RAY_SERVE_ENABLE_EXPERIMENTAL_STREAMING=1</span></code> on the cluster before starting Ray. If you encounter any issues, <a class="reference external" href="https://github.com/ray-project/ray/issues/new/choose">file an issue on GitHub</a>.</p>
</div>
<p>Some applications must stream incremental results back to the caller.
This is common for text generation using large language models (LLMs) or video processing applications.
The full forward pass may take multiple seconds, so providing incremental results as they’re available provides a much better user experience.</p>
<p>To use HTTP response streaming, return a <a class="reference external" href="https://www.starlette.io/responses/#streamingresponse">StreamingResponse</a> that wraps a generator from your HTTP handler.
This is supported for basic HTTP ingress deployments using a <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method and when using the <a class="reference internal" href="http-guide.html#serve-fastapi-http"><span class="std std-ref">FastAPI integration</span></a>.</p>
<p>The code below defines a Serve application that incrementally streams numbers up to a provided <code class="docutils literal notranslate"><span class="pre">max</span></code>.
The client-side code is also updated to handle the streaming outputs.
This code uses the <code class="docutils literal notranslate"><span class="pre">stream=True</span></code> option to the <a class="reference external" href="https://requests.readthedocs.io/en/latest/user/advanced/#streaming-requests">requests</a> library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generator</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">StreamingResponse</span>
<span class="kn">from</span> <span class="nn">starlette.requests</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span>
<span class="k">class</span> <span class="nc">StreamingResponder</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">generate_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">):</span>
            <span class="k">yield</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamingResponse</span><span class="p">:</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;25&quot;</span><span class="p">)</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_numbers</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">StreamingResponse</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>


<span class="n">serve</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">StreamingResponder</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000?max=10&quot;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decode_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got result </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">s after start: &#39;</span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Save this code in <code class="docutils literal notranslate"><span class="pre">stream.py</span></code> and run it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">RAY_SERVE_ENABLE_EXPERIMENTAL_STREAMING</span><span class="o">=</span><span class="m">1</span> python stream.py
<span class="o">[</span><span class="m">2023</span>-05-25 <span class="m">10</span>:44:23<span class="o">]</span>  INFO ray._private.worker::Started a <span class="nb">local</span> Ray instance. View the dashboard at http://127.0.0.1:8265
<span class="o">(</span>ServeController <span class="nv">pid</span><span class="o">=</span><span class="m">40401</span><span class="o">)</span> INFO <span class="m">2023</span>-05-25 <span class="m">10</span>:44:25,296 controller <span class="m">40401</span> deployment_state.py:1259 - Deploying new version of deployment default_StreamingResponder.
<span class="o">(</span>HTTPProxyActor <span class="nv">pid</span><span class="o">=</span><span class="m">40403</span><span class="o">)</span> INFO:     Started server process <span class="o">[</span><span class="m">40403</span><span class="o">]</span>
<span class="o">(</span>ServeController <span class="nv">pid</span><span class="o">=</span><span class="m">40401</span><span class="o">)</span> INFO <span class="m">2023</span>-05-25 <span class="m">10</span>:44:25,333 controller <span class="m">40401</span> deployment_state.py:1498 - Adding <span class="m">1</span> replica to deployment default_StreamingResponder.
Got result <span class="m">0</span>.0s after start: <span class="s1">&#39;0&#39;</span>
Got result <span class="m">0</span>.1s after start: <span class="s1">&#39;1&#39;</span>
Got result <span class="m">0</span>.2s after start: <span class="s1">&#39;2&#39;</span>
Got result <span class="m">0</span>.3s after start: <span class="s1">&#39;3&#39;</span>
Got result <span class="m">0</span>.4s after start: <span class="s1">&#39;4&#39;</span>
Got result <span class="m">0</span>.5s after start: <span class="s1">&#39;5&#39;</span>
Got result <span class="m">0</span>.6s after start: <span class="s1">&#39;6&#39;</span>
Got result <span class="m">0</span>.7s after start: <span class="s1">&#39;7&#39;</span>
Got result <span class="m">0</span>.8s after start: <span class="s1">&#39;8&#39;</span>
Got result <span class="m">0</span>.9s after start: <span class="s1">&#39;9&#39;</span>
<span class="o">(</span>ServeReplica:default_StreamingResponder <span class="nv">pid</span><span class="o">=</span><span class="m">41052</span><span class="o">)</span> INFO <span class="m">2023</span>-05-25 <span class="m">10</span>:49:52,230 default_StreamingResponder default_StreamingResponder#qlZFCa yomKnJifNJ / default replica.py:634 - __CALL__ OK <span class="m">1017</span>.6ms
</pre></div>
</div>
</section>
<section id="http-adapters">
<span id="serve-http-adapters"></span><h2>HTTP Adapters<a class="headerlink" href="http-guide.html#http-adapters" title="Permalink to this headline">#</a></h2>
<p>HTTP adapters are functions that convert raw HTTP requests to basic Python types that you know and recognize.</p>
<p>For example, here is an adapter that extracts the JSON content from a request:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">json_resolver</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">starlette</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
<p>The input arguments to an HTTP adapter should be type-annotated. At a minimum, the adapter should accept a <code class="docutils literal notranslate"><span class="pre">starlette.requests.Request</span></code> type (https://www.starlette.io/requests/#request),
but it can also accept any type that’s recognized by <a class="reference external" href="https://fastapi.tiangolo.com/tutorial/dependencies/">FastAPI’s dependency injection framework</a>.</p>
<p>Here is an HTTP adapter that accepts two HTTP query parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_query_args</span><span class="p">(</span><span class="n">field_a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">field_b</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">YourDataClass</span><span class="p">(</span><span class="n">field_a</span><span class="p">,</span> <span class="n">field_b</span><span class="p">)</span>
</pre></div>
</div>
<p>You can specify different type signatures to facilitate the extraction of HTTP fields, including</p>
<ul class="simple">
<li><p><a class="reference external" href="https://fastapi.tiangolo.com/tutorial/query-params/">query parameters</a>,</p></li>
<li><p><a class="reference external" href="https://fastapi.tiangolo.com/tutorial/body/">body parameters</a>,</p></li>
<li><p><a class="reference external" href="https://fastapi.tiangolo.com/tutorial/extra-data-types/">many other data types</a>.</p></li>
</ul>
<p>For more details, you can take a look at the <a class="reference external" href="https://fastapi.tiangolo.com/">FastAPI documentation</a>.</p>
<p>In addition to above adapters, you also use other adapters. Below we examine at least three:</p>
<ul class="simple">
<li><p>Ray AIR <code class="docutils literal notranslate"><span class="pre">Predictor</span></code></p></li>
<li><p>Serve Deployment Graph <code class="docutils literal notranslate"><span class="pre">DAGDriver</span></code></p></li>
<li><p>Embedded in Bring Your Own <code class="docutils literal notranslate"><span class="pre">FastAPI</span></code> Application</p></li>
</ul>
<section id="ray-air-predictor">
<h3>Ray AIR <code class="docutils literal notranslate"><span class="pre">Predictor</span></code><a class="headerlink" href="http-guide.html#ray-air-predictor" title="Permalink to this headline">#</a></h3>
<p>Ray Serve provides a suite of adapters to convert HTTP requests to ML inputs like <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays.
You can use them together with the <a class="reference internal" href="../ray-air/examples/serving_guide.html#air-serving-guide"><span class="std std-ref">Ray AI Runtime (AIR) model wrapper</span></a> feature
to one-click deploy pre-trained models.</p>
<p>As an example, we provide a simple adapter for an <em>n</em>-dimensional array.</p>
<p>When using <a class="reference internal" href="../ray-air/examples/serving_guide.html#air-serving-guide"><span class="std std-ref">model wrappers</span></a>, you can specify your HTTP adapter via the <code class="docutils literal notranslate"><span class="pre">http_adapter</span></code> field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>
<span class="kn">from</span> <span class="nn">ray.serve.http_adapters</span> <span class="kn">import</span> <span class="n">json_to_ndarray</span>
<span class="kn">from</span> <span class="nn">ray.serve</span> <span class="kn">import</span> <span class="n">PredictorDeployment</span>

<span class="n">serve</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">PredictorDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_model&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
    <span class="n">my_ray_air_predictor</span><span class="p">,</span>
    <span class="n">my_ray_air_checkpoint</span><span class="p">,</span>
    <span class="n">http_adapter</span><span class="o">=</span><span class="n">json_to_ndarray</span>
<span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">my_ray_air_predictor</span></code> and <code class="docutils literal notranslate"><span class="pre">my_ray_air_checkpoint</span></code> are two arguments int <code class="docutils literal notranslate"><span class="pre">PredictorDeployment</span></code> constructor. For detailed usage, please checkout <a class="reference internal" href="../ray-air/examples/serving_guide.html#air-serving-guide"><span class="std std-ref">Ray AI Runtime (AIR) model wrapper</span></a></p>
</div>
</section>
<section id="serve-deployment-graph-dagdriver">
<h3>Serve Deployment Graph <code class="docutils literal notranslate"><span class="pre">DAGDriver</span></code><a class="headerlink" href="http-guide.html#serve-deployment-graph-dagdriver" title="Permalink to this headline">#</a></h3>
<p>When using a <a class="reference internal" href="advanced-guides/deployment-graphs.html#serve-deployment-graphs"><span class="std std-ref">Serve deployment graph</span></a>, you can configure
<code class="docutils literal notranslate"><span class="pre">ray.serve.drivers.DAGDriver</span></code> to accept an HTTP adapter via its <code class="docutils literal notranslate"><span class="pre">http_adapter</span></code> field.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">json_request</span></code> adapter parses JSON in the HTTP body:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray.serve.drivers</span> <span class="kn">import</span> <span class="n">DAGDriver</span>
<span class="kn">from</span> <span class="nn">ray.serve.http_adapters</span> <span class="kn">import</span> <span class="n">json_request</span>
<span class="kn">from</span> <span class="nn">ray.dag.input_node</span> <span class="kn">import</span> <span class="n">InputNode</span>

<span class="k">with</span> <span class="n">InputNode</span><span class="p">()</span> <span class="k">as</span> <span class="n">input_node</span><span class="p">:</span>
    <span class="c1"># ...</span>
    <span class="n">dag</span> <span class="o">=</span> <span class="n">DAGDriver</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">other_node</span><span class="p">,</span> <span class="n">http_adapter</span><span class="o">=</span><span class="n">json_request</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="embedded-in-your-existing-fastapi-application">
<h3>Embedded in your existing <code class="docutils literal notranslate"><span class="pre">FastAPI</span></code> Application<a class="headerlink" href="http-guide.html#embedded-in-your-existing-fastapi-application" title="Permalink to this headline">#</a></h3>
<p>You can also bring the adapter to your own FastAPI app using
<a class="reference external" href="https://fastapi.tiangolo.com/tutorial/dependencies/#import-depends">Depends</a>.
The input schema automatically become part of the generated OpenAPI schema with FastAPI.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Depends</span>
<span class="kn">from</span> <span class="nn">ray.serve.http_adapters</span> <span class="kn">import</span> <span class="n">json_to_ndarray</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/endpoint&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">np_array</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">json_to_ndarray</span><span class="p">)):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="pydantic-models-as-adapters">
<h3>Pydantic models as adapters<a class="headerlink" href="http-guide.html#pydantic-models-as-adapters" title="Permalink to this headline">#</a></h3>
<p>Serve also supports <a class="reference external" href="https://pydantic-docs.helpmanual.io/usage/models/">pydantic models</a> as a shorthand for HTTP adapters in model wrappers. Instead of using a function to define your HTTP adapter as in the examples above,
you can directly pass in a pydantic model class to effectively tell Ray Serve to validate the HTTP body with this schema.
Once validated, the model instance will passed to the predictor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># ...</span>

<span class="n">PredictorDeployment</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">http_adapter</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>
<span class="c1"># Or:</span>
<span class="n">DAGDriver</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">other_node</span><span class="p">,</span> <span class="n">http_adapter</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="list-of-built-in-adapters">
<h3>List of built-in adapters<a class="headerlink" href="http-guide.html#list-of-built-in-adapters" title="Permalink to this headline">#</a></h3>
<p>Here is a list of adapters; please feel free to <a class="reference external" href="https://github.com/ray-project/ray/issues/new/choose">contribute more</a>!</p>
<span class="target" id="module-ray.serve.http_adapters"><span id="serve-ndarray-schema"></span></span><dl class="py function">
<dt class="sig sig-object py" id="ray.serve.http_adapters.json_to_ndarray">
<span class="sig-prename descclassname"><span class="pre">ray.serve.http_adapters.</span></span><span class="sig-name descname"><span class="pre">json_to_ndarray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">payload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="http-guide.html#ray.serve.http_adapters.NdArray" title="ray.serve.http_adapters.NdArray"><span class="pre">ray.serve.http_adapters.NdArray</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray</span></span></span><a class="reference internal" href="../_modules/ray/serve/http_adapters.html#json_to_ndarray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.json_to_ndarray" title="Permalink to this definition">#</a></dt>
<dd><p>Accepts an NdArray JSON from an HTTP body and converts it to a numpy array.</p>
<dl class="py class pydantic_model">
<dt class="sig sig-object py" id="ray.serve.http_adapters.NdArray">
<em class="property"><span class="pre">pydantic</span> <span class="pre">model</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ray.serve.http_adapters.</span></span><span class="sig-name descname"><span class="pre">NdArray</span></span><a class="reference internal" href="../_modules/ray/serve/http_adapters.html#NdArray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.NdArray" title="Permalink to this definition">#</a></dt>
<dd><p>Schema for numeric array input.</p>
<p><details  class="autodoc_pydantic_collapsable_json">
<summary>Show JSON schema</summary><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NdArray&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Schema for numeric array input.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;array&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The array content as a nested list. You can pass in 1D to 4D array as nested list, or flatten them. When you flatten the array, you can use the `shape` parameter to perform reshaping.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;anyOf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"></span>
<span class="w">               </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"></span>
<span class="w">                  </span><span class="p">}</span><span class="w"></span>
<span class="w">               </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"></span>
<span class="w">                     </span><span class="p">}</span><span class="w"></span>
<span class="w">                  </span><span class="p">}</span><span class="w"></span>
<span class="w">               </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                           </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                     </span><span class="p">}</span><span class="w"></span>
<span class="w">                  </span><span class="p">}</span><span class="w"></span>
<span class="w">               </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;shape&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Shape&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The shape of the array. If present, the array will be reshaped.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;dtype&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dtype&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The numpy dtype of the array. If present, the array will be cast by `astype`.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">},</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;array&quot;</span><span class="w"></span>
<span class="w">   </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</details></p><dl class="field-list simple">
<dt class="field-odd">Fields</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="http-guide.html#ray.serve.http_adapters.NdArray.array" title="ray.serve.http_adapters.NdArray.array"><code class="xref py py-obj docutils literal notranslate"><span class="pre">array</span> <span class="pre">(Union[List[float],</span> <span class="pre">List[List[float]],</span> <span class="pre">List[List[List[float]]],</span> <span class="pre">List[List[List[List[float]]]]])</span></code></a></p></li>
<li><p><a class="reference internal" href="http-guide.html#ray.serve.http_adapters.NdArray.dtype" title="ray.serve.http_adapters.NdArray.dtype"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dtype</span> <span class="pre">(Optional[str])</span></code></a></p></li>
<li><p><a class="reference internal" href="http-guide.html#ray.serve.http_adapters.NdArray.shape" title="ray.serve.http_adapters.NdArray.shape"><code class="xref py py-obj docutils literal notranslate"><span class="pre">shape</span> <span class="pre">(Optional[List[int]])</span></code></a></p></li>
</ul>
</dd>
</dl>
<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="ray.serve.http_adapters.NdArray.array">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">array</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">[Required]</span></em><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.NdArray.array" title="Permalink to this definition">#</a></dt>
<dd><p>The array content as a nested list. You can pass in 1D to 4D array as nested list, or flatten them. When you flatten the array, you can use the <a class="reference internal" href="http-guide.html#ray.serve.http_adapters.NdArray.shape" title="ray.serve.http_adapters.NdArray.shape"><code class="xref py py-obj docutils literal notranslate"><span class="pre">shape</span></code></a> parameter to perform reshaping.</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="ray.serve.http_adapters.NdArray.dtype">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dtype</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.NdArray.dtype" title="Permalink to this definition">#</a></dt>
<dd><p>The numpy dtype of the array. If present, the array will be cast by <code class="xref py py-obj docutils literal notranslate"><span class="pre">astype</span></code>.</p>
</dd></dl>

<dl class="py attribute pydantic_field">
<dt class="sig sig-object py" id="ray.serve.http_adapters.NdArray.shape">
<em class="property"><span class="pre">field</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">shape</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.NdArray.shape" title="Permalink to this definition">#</a></dt>
<dd><p>The shape of the array. If present, the array will be reshaped.</p>
</dd></dl>

</dd></dl>

<p><strong>PublicAPI (beta):</strong> This API is in beta and may change before becoming stable.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ray.serve.http_adapters.json_to_multi_ndarray">
<span class="sig-prename descclassname"><span class="pre">ray.serve.http_adapters.</span></span><span class="sig-name descname"><span class="pre">json_to_multi_ndarray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">payload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="http-guide.html#ray.serve.http_adapters.NdArray" title="ray.serve.http_adapters.NdArray"><span class="pre">ray.serve.http_adapters.NdArray</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/ray/serve/http_adapters.html#json_to_multi_ndarray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.json_to_multi_ndarray" title="Permalink to this definition">#</a></dt>
<dd><p>Accepts a JSON of shape {str_key: NdArray} and converts it to dict of arrays.</p>
<p><strong>PublicAPI (beta):</strong> This API is in beta and may change before becoming stable.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ray.serve.http_adapters.starlette_request">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ray.serve.http_adapters.</span></span><span class="sig-name descname"><span class="pre">starlette_request</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">starlette.requests.Request</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">starlette.requests.Request</span></span></span><a class="reference internal" href="../_modules/ray/serve/http_adapters.html#starlette_request"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.starlette_request" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the raw request object.</p>
<p><strong>PublicAPI (beta):</strong> This API is in beta and may change before becoming stable.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ray.serve.http_adapters.json_request">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ray.serve.http_adapters.</span></span><span class="sig-name descname"><span class="pre">json_request</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">starlette.requests.Request</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/ray/serve/http_adapters.html#json_request"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.json_request" title="Permalink to this definition">#</a></dt>
<dd><p>Return the JSON object from request body.</p>
<p><strong>PublicAPI (beta):</strong> This API is in beta and may change before becoming stable.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ray.serve.http_adapters.image_to_ndarray">
<span class="sig-prename descclassname"><span class="pre">ray.serve.http_adapters.</span></span><span class="sig-name descname"><span class="pre">image_to_ndarray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">File(Ellipsis)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray</span></span></span><a class="reference internal" href="../_modules/ray/serve/http_adapters.html#image_to_ndarray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.image_to_ndarray" title="Permalink to this definition">#</a></dt>
<dd><p>Accepts a PIL-readable file from an HTTP form and convert it to a numpy array.</p>
<p><strong>PublicAPI (beta):</strong> This API is in beta and may change before becoming stable.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ray.serve.http_adapters.pandas_read_json">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ray.serve.http_adapters.</span></span><span class="sig-name descname"><span class="pre">pandas_read_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_request</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">starlette.requests.Request</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/serve/http_adapters.html#pandas_read_json"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="http-guide.html#ray.serve.http_adapters.pandas_read_json" title="Permalink to this definition">#</a></dt>
<dd><p>Accept JSON body and converts into pandas DataFrame.</p>
<p>This function simply uses <code class="xref py py-obj docutils literal notranslate"><span class="pre">pandas.read_json(body,</span> <span class="pre">**query_params)</span></code> under the hood.</p>
<p><strong>PublicAPI (beta):</strong> This API is in beta and may change before becoming stable.</p>
</dd></dl>

</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="deploy-many-models/model-multiplexing.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Model Multiplexing</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="production-guide/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Production Guide</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>