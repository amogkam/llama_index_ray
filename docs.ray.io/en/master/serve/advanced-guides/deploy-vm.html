
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Deploy on VM &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script src="../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/serve/advanced-guides/deploy-vm.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Architecture" href="../architecture.html" />
    <link rel="prev" title="Migrate from 1.x to 2.x" href="migration.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "serve/advanced-guides/deploy-vm", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".md", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Ray Serve
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../getting_started.html">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../model_composition.html">
     Deploy a Composition of Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy-many-models/index.html">
     Deploy Many Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../http-guide.html">
     Set Up FastAPI and HTTP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../production-guide/index.html">
     Production Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../monitoring.html">
     Monitor Your Application
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scaling-and-resource-allocation.html">
     Set Up Autoscaling and Resource Allocation
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Advanced Guides
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="app-builder-guide.html">
       Pass Arguments to Applications
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="performance.html">
       Performance Tuning
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dyn-req-batch.html">
       Dynamic Request Batching
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="inplace-updates.html">
       In-Place Updates to Serve
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev-workflow.html">
       Development Workflow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="deployment-graphs.html">
       Experimental Deployment Graphs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="direct-ingress.html">
       Experimental gRPC Ingress
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="managing-java-deployments.html">
       Experimental Java API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="migration.html">
       Migrate from 1.x to 2.x
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="deploy-vm.html#">
       Deploy on VM
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../architecture.html">
     Architecture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/index.html">
     Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/index.html">
     Ray Serve API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fserve/advanced-guides/deploy-vm.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/serve/advanced-guides/deploy-vm.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/serve/advanced-guides/deploy-vm.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="deploy-vm.html#adding-a-runtime-environment">
   Adding a runtime environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="deploy-vm.html#using-a-remote-cluster">
   Using a remote cluster
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="deploy-vm.html#inspecting-the-application-with-serve-config-and-serve-status">
   Inspecting the application with
   <code class="docutils literal notranslate">
    <span class="pre">
     serve
    </span>
    <span class="pre">
     config
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     serve
    </span>
    <span class="pre">
     status
    </span>
   </code>
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Deploy on VM</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="deploy-vm.html#adding-a-runtime-environment">
   Adding a runtime environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="deploy-vm.html#using-a-remote-cluster">
   Using a remote cluster
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="deploy-vm.html#inspecting-the-application-with-serve-config-and-serve-status">
   Inspecting the application with
   <code class="docutils literal notranslate">
    <span class="pre">
     serve
    </span>
    <span class="pre">
     config
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     serve
    </span>
    <span class="pre">
     status
    </span>
   </code>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="deploy-on-vm">
<span id="serve-in-production-deploying"></span><h1>Deploy on VM<a class="headerlink" href="deploy-vm.html#deploy-on-vm" title="Permalink to this headline">#</a></h1>
<p>You can deploy your Serve application to production on a Ray cluster using the Ray Serve CLI.
<code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> takes in a config file path and it deploys that file to a Ray cluster over HTTP.
This could either be a local, single-node cluster as in this example or a remote, multi-node cluster started with the <a class="reference internal" href="../../cluster/vms/index.html#cloud-vm-index"><span class="std std-ref">Ray Cluster Launcher</span></a>.</p>
<p>This section should help you:</p>
<ul class="simple">
<li><p>understand how to deploy a Ray Serve config file using the  CLI.</p></li>
<li><p>understand how to update your application using the CLI.</p></li>
<li><p>understand how to deploy to a remote cluster started with the <a class="reference internal" href="../../cluster/vms/index.html#cloud-vm-index"><span class="std std-ref">Ray Cluster Launcher</span></a>.</p></li>
</ul>
<p>Let’s start by deploying the <a class="reference internal" href="../production-guide/config.html#fruit-config-yaml"><span class="std std-ref">config for the <code class="docutils literal notranslate"><span class="pre">FruitStand</span></code> example</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls
<span class="go">fruit.py</span>
<span class="go">fruit_config.yaml</span>

<span class="gp">$ </span>ray start --head
<span class="go">...</span>

<span class="gp">$ </span>serve deploy fruit_config.yaml
<span class="go">2022-06-20 17:26:31,106	SUCC scripts.py:139 --</span>
<span class="go">Sent deploy request successfully!</span>
<span class="go"> * Use `serve status` to check deployments&#39; statuses.</span>
<span class="go"> * Use `serve config` to see the running app&#39;s config.</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">start</span> <span class="pre">--head</span></code> starts a long-lived Ray cluster locally. <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span> <span class="pre">fruit_config.yaml</span></code> deploys the <code class="docutils literal notranslate"><span class="pre">fruit_config.yaml</span></code> file to this local cluster. To stop your Ray cluster, you can run the CLI command <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">stop</span></code>.</p>
<p>The message <code class="docutils literal notranslate"><span class="pre">Sent</span> <span class="pre">deploy</span> <span class="pre">request</span> <span class="pre">successfully!</span></code> means:</p>
<ul class="simple">
<li><p>The Ray cluster has received your config file successfully.</p></li>
<li><p>It will start a new Serve application if one hasn’t already started.</p></li>
<li><p>The Serve application will deploy the deployments from your deployment graph, updated with the configurations from your config file.</p></li>
</ul>
<p>It does <strong>not</strong> mean that your Serve application, including your deployments, has already started running successfully. This happens asynchronously as the Ray cluster attempts to update itself to match the settings from your config file. Check out the <a class="reference internal" href="deploy-vm.html#serve-in-production-inspecting"><span class="std std-ref">next section</span></a> to learn more about how to get the current status.</p>
<section id="adding-a-runtime-environment">
<h2>Adding a runtime environment<a class="headerlink" href="deploy-vm.html#adding-a-runtime-environment" title="Permalink to this headline">#</a></h2>
<p>The import path (e.g., <code class="docutils literal notranslate"><span class="pre">fruit:deployment_graph</span></code>) must be importable by Serve at runtime.
When running locally, this might be in your current working directory.
However, when running on a cluster you also need to make sure the path is importable.
You can achieve this either by building the code into the cluster’s container image (see <a class="reference internal" href="../../cluster/kubernetes/user-guides/config.html#kuberay-config"><span class="std std-ref">Cluster Configuration</span></a> for more details) or by using a <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> with a <a class="reference internal" href="../../ray-core/handling-dependencies.html#remote-uris"><span class="std std-ref">remote URI</span></a> that hosts the code in remote storage.</p>
<p>As an example, we have <a class="reference external" href="https://github.com/ray-project/test_dag/blob/40d61c141b9c37853a7014b8659fc7f23c1d04f6/fruit.py">pushed a copy of the FruitStand deployment graph to GitHub</a>. You can use this config file to deploy the <code class="docutils literal notranslate"><span class="pre">FruitStand</span></code> deployment graph to your own Ray cluster even if you don’t have the code locally:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">import_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fruit:deployment_graph</span><span class="w"></span>

<span class="nt">runtime_env</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://github.com/ray-project/serve_config_examples/archive/HEAD.zip&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a side note, you could also package your deployment graph into a standalone Python package that can be imported using a <a class="reference external" href="https://docs.python.org/3.10/using/cmdline.html#envvar-PYTHONPATH">PYTHONPATH</a> to provide location independence on your local machine. However, it’s still best practice to use a <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code>, to ensure consistency across all machines in your cluster.</p>
</div>
</section>
<section id="using-a-remote-cluster">
<span id="serve-in-production-remote-cluster"></span><h2>Using a remote cluster<a class="headerlink" href="deploy-vm.html#using-a-remote-cluster" title="Permalink to this headline">#</a></h2>
<p>By default, <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> deploys to a cluster running locally. However, you should also use <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> whenever you want to deploy your Serve application to a remote cluster. <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> takes in an optional <code class="docutils literal notranslate"><span class="pre">--address/-a</span></code> argument where you can specify your remote Ray cluster’s dashboard agent address. This address should be of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RAY_CLUSTER_URI</span><span class="p">]:[</span><span class="n">DASHBOARD_AGENT_PORT</span><span class="p">]</span>
</pre></div>
</div>
<p>As an example, the address for the local cluster started by <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">start</span> <span class="pre">--head</span></code> is <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:52365</span></code>. We can explicitly deploy to this address using the command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>serve deploy config_file.yaml -a http://127.0.0.1:52365
</pre></div>
</div>
<p>The Ray dashboard agent’s default port is 52365. You can set it to a different value using the <code class="docutils literal notranslate"><span class="pre">--dashboard-agent-listen-port</span></code> argument when running <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">start</span></code>.”</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the port 52365 (or whichever port you specify with <code class="docutils literal notranslate"><span class="pre">--dashboard-agent-listen-port</span></code>) is unavailable when Ray starts, the dashboard agent’s HTTP server will fail. However, the dashboard agent and Ray will continue to run.
You can check if an agent’s HTTP server is running by sending a curl request: <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://{node_ip}:{dashboard_agent_port}/api/serve/deployments/</span></code>. If the request succeeds, the server is running on that node. If the request fails, the server is not running on that node. To launch the server on that node, terminate the process occupying the dashboard agent’s port, and restart Ray on that node.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>By default, all the Serve CLI commands assume that you’re working with a local cluster. All Serve CLI commands, except <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">run</span></code> use the Ray agent address associated with a local cluster started by <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">start</span> <span class="pre">--head</span></code>. However, if the <code class="docutils literal notranslate"><span class="pre">RAY_AGENT_ADDRESS</span></code> environment variable is set, these Serve CLI commands will default to that value instead.</p>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">run</span></code>, use the Ray head node address associated with a local cluster by default. If the <code class="docutils literal notranslate"><span class="pre">RAY_ADDRESS</span></code> environment variable is set, they will use that value instead.</p>
<p>You can check <code class="docutils literal notranslate"><span class="pre">RAY_AGENT_ADDRESS</span></code>’s value by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span> <span class="nv">$RAY_AGENT_ADDRESS</span>
</pre></div>
</div>
<p>You can set this variable by running the CLI command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">RAY_AGENT_ADDRESS</span><span class="o">=[</span>YOUR VALUE<span class="o">]</span>
</pre></div>
</div>
<p>You can unset this variable by running the CLI command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">unset</span> RAY_AGENT_ADDRESS
</pre></div>
</div>
<p>Check for this variable in your environment to make sure you’re using your desired Ray agent address.</p>
</div>
</section>
<section id="inspecting-the-application-with-serve-config-and-serve-status">
<span id="serve-in-production-inspecting"></span><h2>Inspecting the application with <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">config</span></code> and <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">status</span></code><a class="headerlink" href="deploy-vm.html#inspecting-the-application-with-serve-config-and-serve-status" title="Permalink to this headline">#</a></h2>
<p>The Serve CLI also offers two commands to help you inspect your Serve application in production: <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">config</span></code> and <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">status</span></code>.
If you’re working with a remote cluster, <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">config</span></code> and <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">status</span></code> also offer an <code class="docutils literal notranslate"><span class="pre">--address/-a</span></code> argument to access your cluster. Check out <a class="reference internal" href="deploy-vm.html#serve-in-production-remote-cluster"><span class="std std-ref">the previous section</span></a> for more info on this argument.</p>
<p><code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">config</span></code> gets the latest config file the Ray cluster received. This config file represents the Serve application’s goal state. The Ray cluster will constantly attempt to reach and maintain this state by deploying deployments, recovering failed replicas, and more.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">fruit_config.yaml</span></code> example from <a class="reference internal" href="../production-guide/config.html#fruit-config-yaml"><span class="std std-ref">an earlier section</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ray start --head
<span class="gp">$ </span>serve deploy fruit_config.yaml
<span class="go">...</span>

<span class="gp">$ </span>serve config
<span class="go">import_path: fruit:deployment_graph</span>

<span class="go">runtime_env: {}</span>

<span class="go">deployments:</span>

<span class="go">- name: MangoStand</span>
<span class="go">  num_replicas: 2</span>
<span class="go">  route_prefix: null</span>
<span class="go">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">status</span></code> gets your Serve application’s current status. It’s divided into two parts: the <code class="docutils literal notranslate"><span class="pre">app_status</span></code> and the <code class="docutils literal notranslate"><span class="pre">deployment_statuses</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">app_status</span></code> contains three fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code>: a Serve application has four possible statuses:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;NOT_STARTED&quot;</span></code>: no application has been deployed on this cluster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;DEPLOYING&quot;</span></code>: the application is currently carrying out a <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> request. It is deploying new deployments or updating existing ones.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;RUNNING&quot;</span></code>: the application is at steady-state. It has finished executing any previous <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> requests, and it is attempting to maintain the goal state set by the latest <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;DEPLOY_FAILED&quot;</span></code>: the latest <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> request has failed.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">message</span></code>: provides context on the current status.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deployment_timestamp</span></code>: a unix timestamp of when Serve received the last <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">deploy</span></code> request. This is calculated using the <code class="docutils literal notranslate"><span class="pre">ServeController</span></code>’s local clock.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">deployment_statuses</span></code> contains a list of dictionaries representing each deployment’s status. Each dictionary has three fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the deployment’s name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code>: a Serve deployment has three possible statuses:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;UPDATING&quot;</span></code>: the deployment is updating to meet the goal state set by a previous <code class="docutils literal notranslate"><span class="pre">deploy</span></code> request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;HEALTHY&quot;</span></code>: the deployment is at the latest requests goal state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;UNHEALTHY&quot;</span></code>: the deployment has either failed to update, or it has updated and has become unhealthy afterwards. This may be due to an error in the deployment’s constructor, a crashed replica, or a general system or machine error.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">message</span></code>: provides context on the current status.</p></li>
</ul>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">status</span></code> command to inspect your deployments after they are deployed and throughout their lifetime.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">fruit_config.yaml</span></code> example from <a class="reference internal" href="../production-guide/config.html#fruit-config-yaml"><span class="std std-ref">an earlier section</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ray start --head
<span class="gp">$ </span>serve deploy fruit_config.yaml
<span class="go">...</span>

<span class="gp">$ </span>serve status
<span class="go">app_status:</span>
<span class="go">  status: RUNNING</span>
<span class="go">  message: &#39;&#39;</span>
<span class="go">  deployment_timestamp: 1655771534.835145</span>
<span class="go">deployment_statuses:</span>
<span class="go">- name: MangoStand</span>
<span class="go">  status: HEALTHY</span>
<span class="go">  message: &#39;&#39;</span>
<span class="go">- name: OrangeStand</span>
<span class="go">  status: HEALTHY</span>
<span class="go">  message: &#39;&#39;</span>
<span class="go">- name: PearStand</span>
<span class="go">  status: HEALTHY</span>
<span class="go">  message: &#39;&#39;</span>
<span class="go">- name: FruitMarket</span>
<span class="go">  status: HEALTHY</span>
<span class="go">  message: &#39;&#39;</span>
<span class="go">- name: DAGDriver</span>
<span class="go">  status: HEALTHY</span>
<span class="go">  message: &#39;&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">status</span></code> can also be used with KubeRay (<a class="reference internal" href="../../cluster/kubernetes/index.html#kuberay-index"><span class="std std-ref">Overview</span></a>), a Kubernetes operator for Ray Serve, to help deploy your Serve applications with Kubernetes. There’s also work in progress to provide closer integrations between some of the features from this document, like <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">status</span></code>, with Kubernetes to provide a clearer Serve deployment story.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="migration.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Migrate from 1.x to 2.x</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../architecture.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Architecture</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>