
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Getting Started &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/versionwarning.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../_static/js/docsearch.js"></script>
    <script src="../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../_static/js/termynal.js"></script>
    <script defer="defer" src="../_static/js/custom.js"></script>
    <script defer="defer" src="../_static/js/top-navigation.js"></script>
    <script src="../_static/js/tags.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/serve/getting_started.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Key Concepts" href="key-concepts.html" />
    <link rel="prev" title="Ray Serve: Scalable and Programmable Serving" href="index.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "serve/getting_started", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".md", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Ray Serve
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="getting_started.html#">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="model_composition.html">
     Deploy a Composition of Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="deploy-many-models/index.html">
     Deploy Many Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="http-guide.html">
     Set Up FastAPI and HTTP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="production-guide/index.html">
     Production Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monitoring.html">
     Monitor Your Application
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scaling-and-resource-allocation.html">
     Set Up Autoscaling and Resource Allocation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advanced-guides/index.html">
     Advanced Guides
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="architecture.html">
     Architecture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorials/index.html">
     Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/index.html">
     Ray Serve API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fserve/getting_started.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/serve/getting_started.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/serve/getting_started.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#text-translation-model-before-ray-serve">
   Text Translation Model (before Ray Serve)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#converting-to-a-ray-serve-application">
   Converting to a Ray Serve Application
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#running-a-ray-serve-application">
   Running a Ray Serve Application
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#composing-multiple-models">
   Composing Multiple Models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#next-steps">
   Next Steps
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Getting Started</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#text-translation-model-before-ray-serve">
   Text Translation Model (before Ray Serve)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#converting-to-a-ray-serve-application">
   Converting to a Ray Serve Application
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#running-a-ray-serve-application">
   Running a Ray Serve Application
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#composing-multiple-models">
   Composing Multiple Models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="getting_started.html#next-steps">
   Next Steps
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="getting-started">
<span id="id1"></span><h1>Getting Started<a class="headerlink" href="getting_started.html#getting-started" title="Permalink to this headline">#</a></h1>
<p>This tutorial will walk you through the process of writing and testing a Ray Serve application. It will show you how to</p>
<ul class="simple">
<li><p>convert a machine learning model to a Ray Serve deployment</p></li>
<li><p>test a Ray Serve application locally over HTTP</p></li>
<li><p>compose multiple-model machine learning models together into a single application</p></li>
</ul>
<p>We’ll use two models in this tutorial:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://huggingface.co/docs/transformers/main_classes/pipelines#transformers.TranslationPipeline">HuggingFace’s TranslationPipeline</a> as a text-translation model</p></li>
<li><p><a class="reference external" href="https://huggingface.co/docs/transformers/v4.21.0/en/main_classes/pipelines#transformers.SummarizationPipeline">HuggingFace’s SummarizationPipeline</a> as a text-summarizer model</p></li>
</ul>
<p>You can also follow along using your own models from any Python framework.</p>
<p>After deploying those two models, we’ll test them with HTTP requests.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have suggestions on how to improve this tutorial,
please <a class="reference external" href="https://github.com/ray-project/ray/issues/new/choose">let us know</a>!</p>
</div>
<p>To run this example, you will need to install the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install <span class="s2">&quot;ray[serve]&quot;</span> transformers requests torch
</pre></div>
</div>
<section id="text-translation-model-before-ray-serve">
<h2>Text Translation Model (before Ray Serve)<a class="headerlink" href="getting_started.html#text-translation-model-before-ray-serve" title="Permalink to this headline">#</a></h2>
<p>First, let’s take a look at our text-translation model. Here’s its code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File name: model.py</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>


<span class="k">class</span> <span class="nc">Translator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Load model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;translation_en_to_fr&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;t5-small&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Run inference</span>
        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Post-process output to return only the translation text</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;translation_text&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">translation</span>


<span class="n">translator</span> <span class="o">=</span> <span class="n">Translator</span><span class="p">()</span>

<span class="n">translation</span> <span class="o">=</span> <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>
</pre></div>
</div>
<p>The Python file, called <code class="docutils literal notranslate"><span class="pre">model.py</span></code>, uses the <code class="docutils literal notranslate"><span class="pre">Translator</span></code> class to translate English text to French.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">self.model</span></code> variable inside <code class="docutils literal notranslate"><span class="pre">Translator</span></code>’s <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method
stores a function that uses the <a class="reference external" href="https://huggingface.co/t5-small">t5-small</a>
model to translate text.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">self.model</span></code> is called on English text, it returns translated French text
inside a dictionary formatted as <code class="docutils literal notranslate"><span class="pre">[{&quot;translation_text&quot;:</span> <span class="pre">&quot;...&quot;}]</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Translator</span></code>’s <code class="docutils literal notranslate"><span class="pre">translate</span></code> method extracts the translated text by indexing into the dictionary.</p></li>
</ul>
<p>You can copy-paste this script and run it locally. It translates <code class="docutils literal notranslate"><span class="pre">&quot;Hello</span> <span class="pre">world!&quot;</span></code>
into <code class="docutils literal notranslate"><span class="pre">&quot;Bonjour</span> <span class="pre">Monde!&quot;</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python model.py

<span class="go">Bonjour Monde!</span>
</pre></div>
</div>
<p>Keep in mind that the <code class="docutils literal notranslate"><span class="pre">TranslationPipeline</span></code> is an example ML model for this
tutorial. You can follow along using arbitrary models from any
Python framework. Check out our tutorials on scikit-learn,
PyTorch, and Tensorflow for more info and examples:</p>
<ul class="simple">
<li><p><a class="reference internal" href="tutorials/serve-ml-models.html#serve-ml-models-tutorial"><span class="std std-ref">Serving ML Models (Tensorflow, PyTorch, Scikit-Learn, others)</span></a></p></li>
</ul>
</section>
<section id="converting-to-a-ray-serve-application">
<span id="converting-to-ray-serve-application"></span><h2>Converting to a Ray Serve Application<a class="headerlink" href="getting_started.html#converting-to-a-ray-serve-application" title="Permalink to this headline">#</a></h2>
<p>In this section, we’ll deploy the text translation model using Ray Serve, so
it can be scaled up and queried over HTTP. We’ll start by converting
<code class="docutils literal notranslate"><span class="pre">Translator</span></code> into a Ray Serve deployment.</p>
<p>First, we open a new Python file and import <code class="docutils literal notranslate"><span class="pre">ray</span></code> and <code class="docutils literal notranslate"><span class="pre">ray.serve</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">starlette.requests</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>

</pre></div>
</div>
<p>After these imports, we can include our model code from above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span><span class="p">(</span><span class="n">num_replicas</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_cpus&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="k">class</span> <span class="nc">Translator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Load model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;translation_en_to_fr&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;t5-small&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Run inference</span>
        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Post-process output to return only the translation text</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;translation_text&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">translation</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">english_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http_request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">english_text</span><span class="p">)</span>


</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Translator</span></code> class has two modifications:</p>
<ol class="simple">
<li><p>It has a decorator, <code class="docutils literal notranslate"><span class="pre">&#64;serve.deployment</span></code>.</p></li>
<li><p>It has a new method, <code class="docutils literal notranslate"><span class="pre">__call__</span></code>.</p></li>
</ol>
<p>The decorator converts <code class="docutils literal notranslate"><span class="pre">Translator</span></code> from a Python class into a Ray Serve <code class="docutils literal notranslate"><span class="pre">Deployment</span></code> object.</p>
<p>Each deployment stores a single Python function or class that you write and uses
it to serve requests. You can scale and configure each of your deployments independently using
parameters in the <code class="docutils literal notranslate"><span class="pre">&#64;serve.deployment</span></code> decorator. The example configures a few common parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">num_replicas</span></code>: an integer that determines how many copies of our deployment process run in Ray. Requests are load balanced across these replicas, allowing you to scale your deployments horizontally.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ray_actor_options</span></code>: a dictionary containing configuration options for each replica.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">num_cpus</span></code>: a float representing the logical number of CPUs each replica should reserve. You can make this a fraction to pack multiple replicas together on a machine with fewer CPUs than replicas.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_gpus</span></code>: a float representing the logical number of GPUs each replica should reserve. You can make this a fraction to pack multiple replicas together on a machine with fewer GPUs than replicas.</p></li>
</ul>
</li>
</ul>
<p>All these parameters are optional, so feel free to omit them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span>
<span class="k">class</span> <span class="nc">Translator</span><span class="p">:</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Deployments receive Starlette HTTP <code class="docutils literal notranslate"><span class="pre">request</span></code> objects <a class="footnote-reference brackets" href="getting_started.html#f1" id="id2">1</a>. By default, the deployment class’s <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method is called on this <code class="docutils literal notranslate"><span class="pre">request</span></code> object. The return value is sent back in the HTTP response body.</p>
<p>This is why <code class="docutils literal notranslate"><span class="pre">Translator</span></code> needs a new <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method. The method processes the incoming HTTP request by reading its JSON data and forwarding it to the <code class="docutils literal notranslate"><span class="pre">translate</span></code> method. The translated text is returned and sent back through the HTTP response. You can also use Ray Serve’s FastAPI integration to avoid working with raw HTTP requests. Check out <a class="reference internal" href="http-guide.html#serve-fastapi-http"><span class="std std-ref">FastAPI HTTP Deployments</span></a> for more info about FastAPI with Serve.</p>
<p>Next, we need to <code class="docutils literal notranslate"><span class="pre">bind</span></code> our <code class="docutils literal notranslate"><span class="pre">Translator</span></code> deployment to arguments that will be passed into its constructor. This defines a Ray Serve application that we can run locally or deploy to production (you’ll see later that applications can consist of multiple deployments). Since <code class="docutils literal notranslate"><span class="pre">Translator</span></code>’s constructor doesn’t take in any arguments, we can call the deployment’s <code class="docutils literal notranslate"><span class="pre">bind</span></code> method without passing anything in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">translator_app</span> <span class="o">=</span> <span class="n">Translator</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>
</pre></div>
</div>
<p>With that, we are ready to test the application locally.</p>
</section>
<section id="running-a-ray-serve-application">
<h2>Running a Ray Serve Application<a class="headerlink" href="getting_started.html#running-a-ray-serve-application" title="Permalink to this headline">#</a></h2>
<p>Here’s the full Ray Serve script that we built above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File name: serve_deployment.py</span>
<span class="kn">from</span> <span class="nn">starlette.requests</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>

<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span><span class="p">(</span><span class="n">num_replicas</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_cpus&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="k">class</span> <span class="nc">Translator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Load model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;translation_en_to_fr&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;t5-small&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Run inference</span>
        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Post-process output to return only the translation text</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;translation_text&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">translation</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">english_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http_request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">english_text</span><span class="p">)</span>


<span class="n">translator_app</span> <span class="o">=</span> <span class="n">Translator</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>
</pre></div>
</div>
<p>To test locally, we run the script with the <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">run</span></code> CLI command. This command takes in an import path
to our deployment formatted as <code class="docutils literal notranslate"><span class="pre">module:application</span></code>. Make sure to run the command from a directory containing a local copy of this script saved as <code class="docutils literal notranslate"><span class="pre">serve_quickstart.py</span></code>, so it can import the application:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>serve run serve_quickstart:translator_app
</pre></div>
</div>
<p>This command will run the <code class="docutils literal notranslate"><span class="pre">translator_app</span></code> application and then block, streaming logs to the console. It can be killed with <code class="docutils literal notranslate"><span class="pre">Ctrl-C</span></code>, which will tear down the application.</p>
<p>We can now test our model over HTTP. It can be reached at the following URL by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span>
</pre></div>
</div>
<p>We’ll send a POST request with JSON data containing our English text.
<code class="docutils literal notranslate"><span class="pre">Translator</span></code>’s <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method will unpack this text and forward it to the
<code class="docutils literal notranslate"><span class="pre">translate</span></code> method. Here’s a client script that requests a translation for “Hello world!”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File name: model_client.py</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">english_text</span> <span class="o">=</span> <span class="s2">&quot;Hello world!&quot;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8000/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">english_text</span><span class="p">)</span>
<span class="n">french_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="nb">print</span><span class="p">(</span><span class="n">french_text</span><span class="p">)</span>
</pre></div>
</div>
<p>To test our deployment, first make sure <code class="docutils literal notranslate"><span class="pre">Translator</span></code> is running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ serve run serve_deployment:translator_app
</pre></div>
</div>
<p>While <code class="docutils literal notranslate"><span class="pre">Translator</span></code> is running, we can open a separate terminal window and run the client script. This will get a response over HTTP:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python model_client.py

<span class="go">Bonjour monde!</span>
</pre></div>
</div>
</section>
<section id="composing-multiple-models">
<h2>Composing Multiple Models<a class="headerlink" href="getting_started.html#composing-multiple-models" title="Permalink to this headline">#</a></h2>
<p>Ray Serve allows you to compose multiple deployments into a single Ray Serve application. This makes it easy to combine multiple machine learning models along with business logic to serve a single request.
We can use parameters like <code class="docutils literal notranslate"><span class="pre">autoscaling_config</span></code>, <code class="docutils literal notranslate"><span class="pre">num_replicas</span></code>, <code class="docutils literal notranslate"><span class="pre">num_cpus</span></code>, and <code class="docutils literal notranslate"><span class="pre">num_gpus</span></code> to independently configure and scale each deployment in the application.</p>
<p>For example, let’s deploy a machine learning pipeline with two steps:</p>
<ol class="simple">
<li><p>Summarize English text</p></li>
<li><p>Translate the summary into French</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">Translator</span></code> already performs step 2. We can use <a class="reference external" href="https://huggingface.co/docs/transformers/v4.21.0/en/main_classes/pipelines#transformers.SummarizationPipeline">HuggingFace’s SummarizationPipeline</a> to accomplish step 1. Here’s an example of the <code class="docutils literal notranslate"><span class="pre">SummarizationPipeline</span></code> that runs locally:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File name: summary_model.py</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>


<span class="k">class</span> <span class="nc">Summarizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Load model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;summarization&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;t5-small&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Run inference</span>
        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># Post-process output to return only the summary text</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;summary_text&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">summary</span>


<span class="n">summarizer</span> <span class="o">=</span> <span class="n">Summarizer</span><span class="p">()</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">summarizer</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span>
    <span class="s2">&quot;It was the best of times, it was the worst of times, it was the age &quot;</span>
    <span class="s2">&quot;of wisdom, it was the age of foolishness, it was the epoch of belief&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</pre></div>
</div>
<p>You can copy-paste this script and run it locally. It summarizes the snippet from <em>A Tale of Two Cities</em> to <code class="docutils literal notranslate"><span class="pre">it</span> <span class="pre">was</span> <span class="pre">the</span> <span class="pre">best</span> <span class="pre">of</span> <span class="pre">times,</span> <span class="pre">it</span> <span class="pre">was</span> <span class="pre">worst</span> <span class="pre">of</span> <span class="pre">times</span> <span class="pre">.</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python summary_model.py

<span class="go">it was the best of times, it was worst of times .</span>
</pre></div>
</div>
<p>Here’s an application that chains the two models together. The graph takes English text, summarizes it, and then translates it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File name: graph.py</span>
<span class="kn">from</span> <span class="nn">starlette.requests</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">serve</span>
<span class="kn">from</span> <span class="nn">ray.serve.handle</span> <span class="kn">import</span> <span class="n">RayServeHandle</span>

<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span>
<span class="k">class</span> <span class="nc">Translator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Load model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;translation_en_to_fr&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;t5-small&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Run inference</span>
        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Post-process output to return only the translation text</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;translation_text&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">translation</span>


<span class="nd">@serve</span><span class="o">.</span><span class="n">deployment</span>
<span class="k">class</span> <span class="nc">Summarizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">translator</span><span class="p">:</span> <span class="n">RayServeHandle</span><span class="p">):</span>
        <span class="c1"># Load model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;summarization&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;t5-small&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="n">translator</span>

    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Run inference</span>
        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># Post-process output to return only the summary text</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;summary_text&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">summary</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">english_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http_request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">english_text</span><span class="p">)</span>

        <span class="n">translation_ref</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="k">await</span> <span class="n">translation_ref</span>

        <span class="k">return</span> <span class="n">translation</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Summarizer</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Translator</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
</pre></div>
</div>
<p>This script contains our <code class="docutils literal notranslate"><span class="pre">Summarizer</span></code> class converted to a deployment and our <code class="docutils literal notranslate"><span class="pre">Translator</span></code> class with some modifications. In this script, the <code class="docutils literal notranslate"><span class="pre">Summarizer</span></code> class contains the <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method since requests are sent to it first. It also takes in the <code class="docutils literal notranslate"><span class="pre">Translator</span></code> as one of its constructor arguments, so it can forward summarized texts to the <code class="docutils literal notranslate"><span class="pre">Translator</span></code> deployment. The <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method also contains some new code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">translation_ref</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
<span class="n">translation</span> <span class="o">=</span> <span class="k">await</span> <span class="n">translation_ref</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">self.translator.translate.remote(summary)</span></code> issues an asynchronous call to the <code class="docutils literal notranslate"><span class="pre">Translator</span></code>’s <code class="docutils literal notranslate"><span class="pre">translate</span></code> method. The line immediately returns a reference to the method’s output, then the next line <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">translation_ref</span></code> waits for <code class="docutils literal notranslate"><span class="pre">translate</span></code> to execute and returns the value of that execution.</p>
<p>We define the full application as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">deployment_graph</span> <span class="o">=</span> <span class="n">Summarizer</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Translator</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
</pre></div>
</div>
<p>Here, we bind <code class="docutils literal notranslate"><span class="pre">Translator</span></code> to its (empty) constructor arguments, and then we pass in the bound <code class="docutils literal notranslate"><span class="pre">Translator</span></code> as the constructor argument for the <code class="docutils literal notranslate"><span class="pre">Summarizer</span></code>. We can run this deployment graph using the <code class="docutils literal notranslate"><span class="pre">serve</span> <span class="pre">run</span></code> CLI command. Make sure to run this command from a directory containing a local copy of the <code class="docutils literal notranslate"><span class="pre">serve_quickstart_composed.py</span></code> code:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>serve run serve_quickstart_composed:app
</pre></div>
</div>
<p>We can use this client script to make requests to the graph:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File name: composed_client.py</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">english_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;It was the best of times, it was the worst of times, it was the age &quot;</span>
    <span class="s2">&quot;of wisdom, it was the age of foolishness, it was the epoch of belief&quot;</span>
<span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8000/&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">english_text</span><span class="p">)</span>
<span class="n">french_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="nb">print</span><span class="p">(</span><span class="n">french_text</span><span class="p">)</span>
</pre></div>
</div>
<p>While the application is running, we can open a separate terminal window and query it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python composed_client.py

<span class="go">c&#39;était le meilleur des temps, c&#39;était le pire des temps .</span>
</pre></div>
</div>
<p>Composed Ray Serve applications let you deploy each part of your machine learning pipeline, such as inference and business logic steps, in separate deployments. Each of these deployments can be individually configured and scaled, ensuring you get maximal performance from your resources. See the guide on <a class="reference internal" href="model_composition.html#serve-model-composition"><span class="std std-ref">model composition</span></a> to learn more.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="getting_started.html#next-steps" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Dive into the <a class="reference internal" href="key-concepts.html"><span class="doc">Key Concepts</span></a> to get a deeper understanding of Ray Serve.</p></li>
<li><p>View details about your Serve application in the Ray Dashboard: <a class="reference internal" href="../ray-observability/getting-started.html#dash-serve-view"><span class="std std-ref">Serve view</span></a>.</p></li>
<li><p>Learn more about how to deploy your Ray Serve application to production: <a class="reference internal" href="production-guide/index.html#serve-in-production"><span class="std std-ref">Production Guide</span></a>.</p></li>
<li><p>Check more in-depth tutorials for popular machine learning frameworks: <a class="reference internal" href="tutorials/index.html"><span class="doc">Examples</span></a>.</p></li>
</ul>
<p class="rubric">Footnotes</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="getting_started.html#id2">1</a></span></dt>
<dd><p><a class="reference external" href="https://www.starlette.io/">Starlette</a> is a web server framework used by Ray Serve.</p>
</dd>
</dl>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Ray Serve: Scalable and Programmable Serving</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="key-concepts.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Key Concepts</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>