
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ray.tune.analysis.experiment_analysis &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/js/versionwarning.js"></script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../../_static/js/docsearch.js"></script>
    <script src="../../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../../_static/js/top-navigation.js"></script>
    <script src="../../../../_static/js/tags.js"></script>
    <script src="../../../../_static/tabs.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/_modules/ray/tune/analysis/experiment_analysis.html" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "_modules/ray/tune/analysis/experiment_analysis", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2F_modules/ray/tune/analysis/experiment_analysis.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for ray.tune.analysis.experiment_analysis</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">ray.air._internal.remote_storage</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">download_from_uri</span><span class="p">,</span>
    <span class="n">is_directory</span><span class="p">,</span>
    <span class="n">is_local_path</span><span class="p">,</span>
    <span class="n">list_at_uri</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.air._internal.uri_utils</span> <span class="kn">import</span> <span class="n">_join_path_or_uri</span><span class="p">,</span> <span class="n">URI</span>
<span class="kn">from</span> <span class="nn">ray.air.checkpoint</span> <span class="kn">import</span> <span class="n">Checkpoint</span>
<span class="kn">from</span> <span class="nn">ray.air.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EXPR_PROGRESS_FILE</span><span class="p">,</span>
    <span class="n">EXPR_RESULT_FILE</span><span class="p">,</span>
    <span class="n">EXPR_PARAM_FILE</span><span class="p">,</span>
    <span class="n">TRAINING_ITERATION</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.tune.syncer</span> <span class="kn">import</span> <span class="n">SyncConfig</span>
<span class="kn">from</span> <span class="nn">ray.tune.utils</span> <span class="kn">import</span> <span class="n">flatten_dict</span>
<span class="kn">from</span> <span class="nn">ray.tune.utils.serialization</span> <span class="kn">import</span> <span class="n">TuneFunctionDecoder</span>
<span class="kn">from</span> <span class="nn">ray.tune.utils.util</span> <span class="kn">import</span> <span class="n">is_nan_or_inf</span><span class="p">,</span> <span class="n">is_nan</span>
<span class="kn">from</span> <span class="nn">ray.util</span> <span class="kn">import</span> <span class="n">log_once</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">pd</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span> <span class="nn">ray.tune.error</span> <span class="kn">import</span> <span class="n">TuneError</span>
<span class="kn">from</span> <span class="nn">ray.tune.result</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_METRIC</span><span class="p">,</span>
    <span class="n">CONFIG_PREFIX</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ray.tune.experiment</span> <span class="kn">import</span> <span class="n">Trial</span>
<span class="kn">from</span> <span class="nn">ray.tune.execution.trial_runner</span> <span class="kn">import</span> <span class="n">_find_newest_experiment_checkpoint</span>
<span class="kn">from</span> <span class="nn">ray.tune.trainable.util</span> <span class="kn">import</span> <span class="n">TrainableUtil</span>
<span class="kn">from</span> <span class="nn">ray.tune.utils.util</span> <span class="kn">import</span> <span class="n">unflattened_lookup</span>

<span class="kn">from</span> <span class="nn">ray.util.annotations</span> <span class="kn">import</span> <span class="n">PublicAPI</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">DEFAULT_FILE_TYPE</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span>


<div class="viewcode-block" id="ExperimentAnalysis"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.html#ray.tune.ExperimentAnalysis">[docs]</a><span class="nd">@PublicAPI</span><span class="p">(</span><span class="n">stability</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ExperimentAnalysis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Analyze results from a Tune experiment.</span>

<span class="sd">    To use this class, the experiment must be executed with the JsonLogger.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        experiment_checkpoint_path: Path to a json file or directory</span>
<span class="sd">            representing an experiment state, or a directory containing</span>
<span class="sd">            multiple experiment states (a run&#39;s ``local_dir``).</span>
<span class="sd">            Corresponds to Experiment.local_dir/Experiment.name/</span>
<span class="sd">            experiment_state.json</span>
<span class="sd">        trials: List of trials that can be accessed via</span>
<span class="sd">            `analysis.trials`.</span>
<span class="sd">        default_metric: Default metric for comparing results. Can be</span>
<span class="sd">            overwritten with the ``metric`` parameter in the respective</span>
<span class="sd">            functions.</span>
<span class="sd">        default_mode: Default mode for comparing results. Has to be one</span>
<span class="sd">            of [min, max]. Can be overwritten with the ``mode`` parameter</span>
<span class="sd">            in the respective functions.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from ray import tune</span>
<span class="sd">        &gt;&gt;&gt; tune.run( # doctest: +SKIP</span>
<span class="sd">        ...     my_trainable, name=&quot;my_exp&quot;, local_dir=&quot;~/tune_results&quot;)</span>
<span class="sd">        &gt;&gt;&gt; analysis = ExperimentAnalysis( # doctest: +SKIP</span>
<span class="sd">        ...     experiment_checkpoint_path=&quot;~/tune_results/my_exp/state.json&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">experiment_checkpoint_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">trials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Trial</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">remote_storage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Deprecate: Raise in 2.6, remove in 2.7</span>
        <span class="n">sync_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SyncConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_experiment_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If the user passes in a remote checkpoint path,</span>
        <span class="c1"># Set the remote experiment path to this path, and set</span>
        <span class="c1"># the local experiment path to a temp directory.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_local_path</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_experiment_path</span> <span class="o">=</span> <span class="n">experiment_checkpoint_path</span>

            <span class="c1"># Create a temp directory to store downloaded checkpoint files if</span>
            <span class="c1"># they are pulled from a remote `experiment_checkpoint_path`.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">(</span>
                <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;experiment_analysis_&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Load the experiment checkpoints and their parent paths.</span>
        <span class="c1"># This is important for when experiment folders have been</span>
        <span class="c1"># relocated (e.g. from a ray cluster to local disk or GCS/S3)-</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints_and_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_checkpoints</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints_and_paths</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trials</span> <span class="o">=</span> <span class="n">trials</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trial_dataframes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="o">=</span> <span class="n">default_metric</span>
        <span class="k">if</span> <span class="n">default_mode</span> <span class="ow">and</span> <span class="n">default_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`default_mode` has to be None or one of [min, max]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span> <span class="o">=</span> <span class="n">default_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_filetype</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="c1"># If only a mode was passed, use anonymous metric</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="o">=</span> <span class="n">DEFAULT_METRIC</span>

        <span class="c1"># TODO(ml-team): Remove in 2.7 along with sync_config parameter</span>
        <span class="k">if</span> <span class="n">sync_config</span> <span class="ow">and</span> <span class="n">sync_config</span><span class="o">.</span><span class="n">upload_dir</span><span class="p">:</span>
            <span class="n">remote_storage_path</span> <span class="o">=</span> <span class="n">sync_config</span><span class="o">.</span><span class="n">upload_dir</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints_and_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_experiment_path</span> <span class="ow">and</span> <span class="n">remote_storage_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_experiment_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">URI</span><span class="p">(</span><span class="n">remote_storage_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;pandas not installed. Run `pip install pandas` for &quot;</span>
                <span class="s2">&quot;ExperimentAnalysis utilities.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fetch_trial_dataframes</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_local_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_remote_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_experiment_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">experiment_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Path pointing to the experiment directory on persistent storage.</span>

<span class="sd">        This can point to a remote storage location (e.g. S3) or to a local</span>
<span class="sd">        location (path on the head node).</span>

<span class="sd">        For instance, if your remote storage path is ``s3://bucket/location``,</span>
<span class="sd">        this will point to ``s3://bucket/location/experiment_name``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span>

    <span class="k">def</span> <span class="nf">_convert_local_to_cloud_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert local path into cloud storage path.</span>

<span class="sd">        Example:</span>
<span class="sd">        local_path = &quot;/a/b/c.json&quot;</span>
<span class="sd">        self._remote_experiment_path = &quot;s3://bucket?param=abcd&quot;</span>
<span class="sd">        self._local_experiment_path = &quot;/a/b&quot;</span>

<span class="sd">        -&gt; &quot;s3://bucket/c?param=abcd&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_experiment_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">rel_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_experiment_path</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">URI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_experiment_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">rel_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_checkpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_checkpoint_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># Get the latest checkpoints from the checkpoint_path.</span>
        <span class="n">latest_checkpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_latest_checkpoint</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">latest_checkpoints</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">experiment_checkpoint_path</span><span class="si">}</span><span class="s2">` must either be a path to an &quot;</span>
                <span class="s2">&quot;experiment checkpoint file, or a directory containing an experiment &quot;</span>
                <span class="s2">&quot;checkpoint file.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Collect all checkpoints and their directory paths.</span>
        <span class="c1"># These are used to infer the `local_dir` from the checkpoints</span>
        <span class="c1"># in case the experiment folder had been moved from its original</span>
        <span class="c1"># location (e.g. from a ray cluster to a GCS/S3 bucket or to local disk).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_checkpoints_from_latest</span><span class="p">(</span><span class="n">latest_checkpoints</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_checkpoints_from_latest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latest_checkpoint</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Collect all checkpoints and their directory paths.</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">latest_checkpoint</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">experiment_state</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">TuneFunctionDecoder</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experiment_state</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;checkpoints&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">experiment_state</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TuneError</span><span class="p">(</span><span class="s2">&quot;Experiment state invalid; no checkpoints found.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints_and_paths</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span> <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">experiment_state</span><span class="p">[</span><span class="s2">&quot;checkpoints&quot;</span><span class="p">]</span>
            <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_maybe_download_experiment_checkpoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">experiment_checkpoint_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Downloads the experiment checkpoint from a remote path if needed.</span>

<span class="sd">        Args:</span>
<span class="sd">            experiment_checkpoint_path: The local or remote path to the experiment</span>
<span class="sd">                checkpoint file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The local copy of the experiment checkpoint.</span>
<span class="sd">                If a local path is passed in, this method will return that immediately.</span>
<span class="sd">                If a remote path is passed in, this will try to download that file.</span>
<span class="sd">                Will return None if the download failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_local_path</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span>

        <span class="n">experiment_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">URI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="c1"># s3://bucket/exp_dir/nested/experiment_state.json</span>
        <span class="c1">#   -&gt; bucket/exp_dir/nested/experiment_state.json</span>
        <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">URI</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">experiment_path</span> <span class="ow">in</span> <span class="n">checkpoint_path</span><span class="o">.</span><span class="n">parents</span>
        <span class="c1">#   -&gt; nested/experiment_state.json</span>
        <span class="n">relative_path</span> <span class="o">=</span> <span class="n">checkpoint_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">experiment_path</span><span class="p">)</span>

        <span class="c1"># Download to:</span>
        <span class="c1">#   -&gt; {self._local_path}/nested/experiment_state.json</span>
        <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">download_from_uri</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">,</span> <span class="n">local_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">local_path</span>

    <span class="k">def</span> <span class="nf">_get_latest_checkpoint_from_dir</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">experiment_checkpoint_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Gets the latest experiment checkpoints from a given directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            experiment_checkpoint_path: A local or remote path to a directory</span>
<span class="sd">                containing at least one experiment checkpoint file.</span>
<span class="sd">            top_level: True if this is the first directory level. False if</span>
<span class="sd">                we are searching in a subdirectory. (Max recursion depth of 1.)</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of local paths pointing to the latest experiment checkpoint</span>
<span class="sd">            file for each experiment found within the given directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">latest_checkpoint</span> <span class="o">=</span> <span class="n">_find_newest_experiment_checkpoint</span><span class="p">(</span>
            <span class="n">experiment_checkpoint_path</span>
        <span class="p">)</span>

        <span class="n">latest_checkpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">latest_checkpoint</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_directory</span><span class="p">(</span>
                <span class="n">latest_checkpoint</span>
            <span class="p">),</span> <span class="s2">&quot;This should point to an actual experiment checkpoint file.&quot;</span>
            <span class="n">latest_checkpoints</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_latest_checkpoint</span><span class="p">(</span><span class="n">latest_checkpoint</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">latest_checkpoint</span> <span class="ow">and</span> <span class="n">top_level</span><span class="p">:</span>
            <span class="c1"># If no checkpoint in this folder the sub-directory is searched.</span>
            <span class="c1"># In this case also multiple experiment folders could exist in</span>
            <span class="c1"># the same root. In this case the length of `latest_checkpoint`</span>
            <span class="c1"># will be greater than 1.</span>
            <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">list_at_uri</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">):</span>
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">_join_path_or_uri</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_directory</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                    <span class="n">latest_checkpoints</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_latest_checkpoint_from_dir</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">top_level</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">latest_checkpoints</span>

    <span class="k">def</span> <span class="nf">_get_latest_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_checkpoint_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Gets the latest experiment checkpoints corresponding to a given path.</span>

<span class="sd">        Acceptable path inputs (either local or remote):</span>
<span class="sd">        - A path to an experiment checkpoint file.</span>
<span class="sd">        - A path to an experiment directory, which contains an experiment checkpoint</span>
<span class="sd">          file at the directory&#39;s top-level.</span>
<span class="sd">        - A path to a directory that contains multiple experiment directories,</span>
<span class="sd">          where each subdirectory contains an experiment checkpoint file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of local paths pointing to the latest experiment checkpoint</span>
<span class="sd">            file for each experiment corresponding to the given path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_directory</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_latest_checkpoint_from_dir</span><span class="p">(</span><span class="n">experiment_checkpoint_path</span><span class="p">)</span>

        <span class="n">local_experiment_checkpoint_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_download_experiment_checkpoint</span><span class="p">(</span>
            <span class="n">experiment_checkpoint_path</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">local_experiment_checkpoint_path</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_experiment_checkpoint_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The file `</span><span class="si">{</span><span class="n">experiment_checkpoint_path</span><span class="si">}</span><span class="s2">` does not &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;exist and cannot be loaded for experiment analysis.&quot;</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_experiment_checkpoint_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">local_experiment_checkpoint_path</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Trial</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the best trial of the experiment</span>

<span class="sd">        The best trial is determined by comparing the last trial results</span>
<span class="sd">        using the `metric` and `mode` parameters passed to `tune.run()`.</span>

<span class="sd">        If you didn&#39;t pass these parameters, use</span>
<span class="sd">        `get_best_trial(metric, mode, scope)` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To fetch the `best_trial`, pass a `metric` and `mode` &quot;</span>
                <span class="s2">&quot;parameter to `tune.run()`. Alternatively, use the &quot;</span>
                <span class="s2">&quot;`get_best_trial(metric, mode)` method to set the metric &quot;</span>
                <span class="s2">&quot;and mode explicitly.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_trial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the config of the best trial of the experiment</span>

<span class="sd">        The best trial is determined by comparing the last trial results</span>
<span class="sd">        using the `metric` and `mode` parameters passed to `tune.run()`.</span>

<span class="sd">        If you didn&#39;t pass these parameters, use</span>
<span class="sd">        `get_best_config(metric, mode, scope)` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To fetch the `best_config`, pass a `metric` and `mode` &quot;</span>
                <span class="s2">&quot;parameter to `tune.run()`. Alternatively, use the &quot;</span>
                <span class="s2">&quot;`get_best_config(metric, mode)` method to set the metric &quot;</span>
                <span class="s2">&quot;and mode explicitly.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Checkpoint</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the checkpoint path of the best trial of the experiment</span>

<span class="sd">        The best trial is determined by comparing the last trial results</span>
<span class="sd">        using the `metric` and `mode` parameters passed to `tune.run()`.</span>

<span class="sd">        If you didn&#39;t pass these parameters, use</span>
<span class="sd">        `get_best_checkpoint(trial, metric, mode)` instead.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`Checkpoint &lt;ray.air.Checkpoint&gt;` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To fetch the `best_checkpoint`, pass a `metric` and `mode` &quot;</span>
                <span class="s2">&quot;parameter to `tune.run()`. Alternatively, use the &quot;</span>
                <span class="s2">&quot;`get_best_checkpoint(trial, metric, mode)` method to set the &quot;</span>
                <span class="s2">&quot;metric and mode explicitly.&quot;</span>
            <span class="p">)</span>
        <span class="n">best_trial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_trial</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">best_trial</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No best trial found. Please check if you specified the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;correct default metric (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span><span class="si">}</span><span class="s2">) and mode &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_checkpoint</span><span class="p">(</span>
            <span class="n">best_trial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_logdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the logdir of the best trial of the experiment</span>

<span class="sd">        The best trial is determined by comparing the last trial results</span>
<span class="sd">        using the `metric` and `mode` parameters passed to `tune.run()`.</span>

<span class="sd">        If you didn&#39;t pass these parameters, use</span>
<span class="sd">        `get_best_logdir(metric, mode)` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To fetch the `best_logdir`, pass a `metric` and `mode` &quot;</span>
                <span class="s2">&quot;parameter to `tune.run()`. Alternatively, use the &quot;</span>
                <span class="s2">&quot;`get_best_logdir(metric, mode, scope)` method to set the &quot;</span>
                <span class="s2">&quot;metric and mode explicitly.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_logdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the full result dataframe of the best trial of the experiment</span>

<span class="sd">        The best trial is determined by comparing the last trial results</span>
<span class="sd">        using the `metric` and `mode` parameters passed to `tune.run()`.</span>

<span class="sd">        If you didn&#39;t pass these parameters, use</span>
<span class="sd">        `get_best_logdir(metric, mode)` and use it to look for the dataframe</span>
<span class="sd">        in the `self.trial_dataframes` dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To fetch the `best_result`, pass a `metric` and `mode` &quot;</span>
                <span class="s2">&quot;parameter to `tune.run()`.&quot;</span>
            <span class="p">)</span>
        <span class="n">best_logdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_logdir</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_dataframes</span><span class="p">[</span><span class="n">best_logdir</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the last result of the best trial of the experiment</span>

<span class="sd">        The best trial is determined by comparing the last trial results</span>
<span class="sd">        using the `metric` and `mode` parameters passed to `tune.run()`.</span>

<span class="sd">        If you didn&#39;t pass these parameters, use</span>
<span class="sd">        `get_best_trial(metric, mode, scope).last_result` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To fetch the `best_result`, pass a `metric` and `mode` &quot;</span>
                <span class="s2">&quot;parameter to `tune.run()`. Alternatively, use &quot;</span>
                <span class="s2">&quot;`get_best_trial(metric, mode).last_result` to set &quot;</span>
                <span class="s2">&quot;the metric and mode explicitly and fetch the last result.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">last_result</span>

    <span class="k">def</span> <span class="nf">_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TUNE_RESULT_DELIM&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_result_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the best result of the experiment as a pandas dataframe.</span>

<span class="sd">        The best trial is determined by comparing the last trial results</span>
<span class="sd">        using the `metric` and `mode` parameters passed to `tune.run()`.</span>

<span class="sd">        If you didn&#39;t pass these parameters, use</span>
<span class="sd">        `get_best_trial(metric, mode, scope).last_result` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`best_result_df` requires pandas. Install with &quot;</span>
                <span class="s2">&quot;`pip install pandas`.&quot;</span>
            <span class="p">)</span>

        <span class="n">best_result</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">([</span><span class="n">best_result</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;trial_id&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the last result of the all trials of the experiment&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">trial</span><span class="o">.</span><span class="n">trial_id</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">last_result</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">results_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get all the last results as a pandas dataframe.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`results_df` requires pandas. Install with `pip install pandas`.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">flatten_dict</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">last_result</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span>
            <span class="p">],</span>
            <span class="n">index</span><span class="o">=</span><span class="s2">&quot;trial_id&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trial_dataframes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;List of all dataframes of the trials.</span>

<span class="sd">        Each dataframe is indexed by iterations and contains reported</span>
<span class="sd">        metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trial_dataframes</span>

<div class="viewcode-block" id="ExperimentAnalysis.dataframe"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.dataframe.html#ray.tune.ExperimentAnalysis.dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a pandas.DataFrame object constructed from the trials.</span>

<span class="sd">        This function will look through all observed results of each trial</span>
<span class="sd">        and return the one corresponding to the passed ``metric`` and</span>
<span class="sd">        ``mode``: If ``mode=min``, it returns the result with the lowest</span>
<span class="sd">        *ever* observed ``metric`` for this trial (this is not necessarily</span>
<span class="sd">        the last)! For ``mode=max``, it&#39;s the highest, respectively. If</span>
<span class="sd">        ``metric=None`` or ``mode=None``, the last result will be returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Key for trial info to order on. If None, uses last result.</span>
<span class="sd">            mode: One of [None, &quot;min&quot;, &quot;max&quot;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Constructed from a result dict of each trial.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do not validate metric/mode here or set from default metric/mode!</span>
        <span class="c1"># Otherwise we will get confusing results as the lowest ever observed</span>
        <span class="c1"># result may not be the last result.</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If set, `mode` has to be one of [min, max]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">metric</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If a `mode` is passed to `ExperimentAnalysis.dataframe(),&quot;</span>
                <span class="s2">&quot; you&#39;ll also have to pass a `metric`!&quot;</span>
            <span class="p">)</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_rows</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">all_configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_configs</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">all_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">rows</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
                <span class="n">rows</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">logdir</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rows</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.get_trial_checkpoints_paths"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.get_trial_checkpoints_paths.html#ray.tune.ExperimentAnalysis.get_trial_checkpoints_paths">[docs]</a>    <span class="k">def</span> <span class="nf">get_trial_checkpoints_paths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">Trial</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Number</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Gets paths and metrics of all persistent checkpoints of a trial.</span>

<span class="sd">        Args:</span>
<span class="sd">            trial: The log directory of a trial, or a trial instance.</span>
<span class="sd">            metric: key for trial info to return, e.g. &quot;mean_accuracy&quot;.</span>
<span class="sd">                &quot;training_iteration&quot; is used by default if no value was</span>
<span class="sd">                passed to ``self.default_metric``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of [path, metric] for all persistent checkpoints of the trial.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="n">TRAINING_ITERATION</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">trial_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
            <span class="c1"># Get checkpoints from logdir.</span>
            <span class="n">chkpt_df</span> <span class="o">=</span> <span class="n">TrainableUtil</span><span class="o">.</span><span class="n">get_checkpoints_paths</span><span class="p">(</span><span class="n">trial_dir</span><span class="p">)</span>

            <span class="c1"># Join with trial dataframe to get metrics.</span>
            <span class="n">trial_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_dataframes</span><span class="p">[</span><span class="n">trial_dir</span><span class="p">]</span>
            <span class="n">path_metric_df</span> <span class="o">=</span> <span class="n">chkpt_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">trial_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;training_iteration&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">path_metric_df</span><span class="p">[[</span><span class="s2">&quot;chkpt_path&quot;</span><span class="p">,</span> <span class="n">metric</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">Trial</span><span class="p">):</span>
            <span class="n">checkpoints</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">get_trial_checkpoints</span><span class="p">()</span>
            <span class="c1"># Support metrics given as paths, e.g.</span>
            <span class="c1"># &quot;info/learner/default_policy/policy_loss&quot;.</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">dir_or_data</span><span class="p">,</span> <span class="n">unflattened_lookup</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">metrics</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">checkpoints</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trial should be a string or a Trial instance.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.get_best_checkpoint"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.get_best_checkpoint.html#ray.tune.ExperimentAnalysis.get_best_checkpoint">[docs]</a>    <span class="k">def</span> <span class="nf">get_best_checkpoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="n">Trial</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Checkpoint</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Gets best persistent checkpoint path of provided trial.</span>

<span class="sd">        Any checkpoints with an associated metric value of ``nan`` will be filtered out.</span>

<span class="sd">        Args:</span>
<span class="sd">            trial: The log directory of a trial, or a trial instance.</span>
<span class="sd">            metric: key of trial info to return, e.g. &quot;mean_accuracy&quot;.</span>
<span class="sd">                &quot;training_iteration&quot; is used by default if no value was</span>
<span class="sd">                passed to ``self.default_metric``.</span>
<span class="sd">            mode: One of [min, max]. Defaults to ``self.default_mode``.</span>
<span class="sd">            return_path: If True, only returns the path (and not the</span>
<span class="sd">                ``Checkpoint`` object). If using Ray client, it is not</span>
<span class="sd">                guaranteed that this path is available on the local</span>
<span class="sd">                (client) node. Can also contain a cloud URI.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`Checkpoint &lt;ray.air.Checkpoint&gt;` object or string</span>
<span class="sd">            if ``return_path=True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span> <span class="ow">or</span> <span class="n">TRAINING_ITERATION</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="n">checkpoint_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trial_checkpoints_paths</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>

        <span class="c1"># Filter out nan. Sorting nan values leads to undefined behavior.</span>
        <span class="n">checkpoint_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">checkpoint_paths</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_nan</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpoint_paths</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No checkpoints have been found for trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">best_path_metrics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">checkpoint_paths</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">best_path</span><span class="p">,</span> <span class="n">best_metric</span> <span class="o">=</span> <span class="n">best_path_metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cloud_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_local_to_cloud_path</span><span class="p">(</span><span class="n">best_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cloud_path</span><span class="p">:</span>
            <span class="c1"># Prefer cloud path over local path for downsteam processing</span>
            <span class="k">if</span> <span class="n">return_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cloud_path</span>
            <span class="k">return</span> <span class="n">Checkpoint</span><span class="o">.</span><span class="n">from_uri</span><span class="p">(</span><span class="n">cloud_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">best_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">return_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">best_path</span>
            <span class="k">return</span> <span class="n">Checkpoint</span><span class="o">.</span><span class="n">from_directory</span><span class="p">(</span><span class="n">best_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_once</span><span class="p">(</span><span class="s2">&quot;checkpoint_not_available&quot;</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The requested checkpoint for trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> is not available on &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;this node, most likely because you are using Ray client or &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;disabled checkpoint synchronization. To avoid this, enable &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;checkpoint synchronization to cloud storage by specifying a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`SyncConfig`. The checkpoint may be available on a different &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;node - please check this location on worker nodes: </span><span class="si">{</span><span class="n">best_path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">return_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">best_path</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.get_all_configs"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.get_all_configs.html#ray.tune.ExperimentAnalysis.get_all_configs">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of all configurations.</span>

<span class="sd">        Args:</span>
<span class="sd">            prefix: If True, flattens the config dict</span>
<span class="sd">                and prepends `config/`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Dict]: Dict of all configurations of trials, indexed by</span>
<span class="sd">                their trial dir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fail_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">failed_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trial_paths</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">EXPR_PARAM_FILE</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">param_file</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="p">:</span>
                    <span class="n">download_from_uri</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_local_to_cloud_path</span><span class="p">(</span><span class="n">param_file</span><span class="p">),</span> <span class="n">param_file</span>
                    <span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">EXPR_PARAM_FILE</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="p">({</span><span class="n">CONFIG_PREFIX</span><span class="p">:</span> <span class="n">config</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Exception occurred when loading trial configs. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;See traceback:</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">fail_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">failed_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fail_count</span><span class="p">:</span>
            <span class="n">failed_paths_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">failed_paths</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to read the config for </span><span class="si">{</span><span class="n">fail_count</span><span class="si">}</span><span class="s2"> trials:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">failed_paths_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.get_best_trial"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.get_best_trial.html#ray.tune.ExperimentAnalysis.get_best_trial">[docs]</a>    <span class="k">def</span> <span class="nf">get_best_trial</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
        <span class="n">filter_nan_and_inf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Trial</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the best trial object.</span>

<span class="sd">        Compares all trials&#39; scores on ``metric``.</span>
<span class="sd">        If ``metric`` is not specified, ``self.default_metric`` will be used.</span>
<span class="sd">        If `mode` is not specified, ``self.default_mode`` will be used.</span>
<span class="sd">        These values are usually initialized by passing the ``metric`` and</span>
<span class="sd">        ``mode`` parameters to ``tune.run()``.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Key for trial info to order on. Defaults to</span>
<span class="sd">                ``self.default_metric``.</span>
<span class="sd">            mode: One of [min, max]. Defaults to ``self.default_mode``.</span>
<span class="sd">            scope: One of [all, last, avg, last-5-avg, last-10-avg].</span>
<span class="sd">                If `scope=last`, only look at each trial&#39;s final step for</span>
<span class="sd">                `metric`, and compare across trials based on `mode=[min,max]`.</span>
<span class="sd">                If `scope=avg`, consider the simple average over all steps</span>
<span class="sd">                for `metric` and compare across trials based on</span>
<span class="sd">                `mode=[min,max]`. If `scope=last-5-avg` or `scope=last-10-avg`,</span>
<span class="sd">                consider the simple average over the last 5 or 10 steps for</span>
<span class="sd">                `metric` and compare across trials based on `mode=[min,max]`.</span>
<span class="sd">                If `scope=all`, find each trial&#39;s min/max score for `metric`</span>
<span class="sd">                based on `mode`, and compare trials based on `mode=[min,max]`.</span>
<span class="sd">            filter_nan_and_inf: If True (default), NaN or infinite</span>
<span class="sd">                values are disregarded and these trials are never selected as</span>
<span class="sd">                the best trial.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The best trial for the provided metric. If no trials contain the provided</span>
<span class="sd">                metric, or if the value for the metric is NaN for all trials,</span>
<span class="sd">                then returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scope</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;last-5-avg&quot;</span><span class="p">,</span> <span class="s2">&quot;last-10-avg&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;ExperimentAnalysis: attempting to get best trial for &quot;</span>
                <span class="s1">&#39;metric </span><span class="si">{}</span><span class="s1"> for scope </span><span class="si">{}</span><span class="s1"> not in [&quot;all&quot;, &quot;last&quot;, &quot;avg&quot;, &#39;</span>
                <span class="s1">&#39;&quot;last-5-avg&quot;, &quot;last-10-avg&quot;]. &#39;</span>
                <span class="s2">&quot;If you didn&#39;t pass a `metric` parameter to `tune.run()`, &quot;</span>
                <span class="s2">&quot;you have to pass one when fetching the best trial.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">metric</span><span class="p">,</span> <span class="n">scope</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">best_trial</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_metric_score</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">metric_analysis</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">scope</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;last-5-avg&quot;</span><span class="p">,</span> <span class="s2">&quot;last-10-avg&quot;</span><span class="p">]:</span>
                <span class="n">metric_score</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">metric_analysis</span><span class="p">[</span><span class="n">metric</span><span class="p">][</span><span class="n">scope</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metric_score</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">metric_analysis</span><span class="p">[</span><span class="n">metric</span><span class="p">][</span><span class="n">mode</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">filter_nan_and_inf</span> <span class="ow">and</span> <span class="n">is_nan_or_inf</span><span class="p">(</span><span class="n">metric_score</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">best_metric_score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">best_metric_score</span> <span class="o">=</span> <span class="n">metric_score</span>
                <span class="n">best_trial</span> <span class="o">=</span> <span class="n">trial</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">best_metric_score</span> <span class="o">&lt;</span> <span class="n">metric_score</span><span class="p">):</span>
                <span class="n">best_metric_score</span> <span class="o">=</span> <span class="n">metric_score</span>
                <span class="n">best_trial</span> <span class="o">=</span> <span class="n">trial</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">best_metric_score</span> <span class="o">&gt;</span> <span class="n">metric_score</span><span class="p">):</span>
                <span class="n">best_metric_score</span> <span class="o">=</span> <span class="n">metric_score</span>
                <span class="n">best_trial</span> <span class="o">=</span> <span class="n">trial</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">best_trial</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Could not find best trial. Did you pass the correct `metric` &quot;</span>
                <span class="s2">&quot;parameter?&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">best_trial</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.get_best_config"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.get_best_config.html#ray.tune.ExperimentAnalysis.get_best_config">[docs]</a>    <span class="k">def</span> <span class="nf">get_best_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the best config corresponding to the trial.</span>

<span class="sd">        Compares all trials&#39; scores on `metric`.</span>
<span class="sd">        If ``metric`` is not specified, ``self.default_metric`` will be used.</span>
<span class="sd">        If `mode` is not specified, ``self.default_mode`` will be used.</span>
<span class="sd">        These values are usually initialized by passing the ``metric`` and</span>
<span class="sd">        ``mode`` parameters to ``tune.run()``.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Key for trial info to order on. Defaults to</span>
<span class="sd">                ``self.default_metric``.</span>
<span class="sd">            mode: One of [min, max]. Defaults to ``self.default_mode``.</span>
<span class="sd">            scope: One of [all, last, avg, last-5-avg, last-10-avg].</span>
<span class="sd">                If `scope=last`, only look at each trial&#39;s final step for</span>
<span class="sd">                `metric`, and compare across trials based on `mode=[min,max]`.</span>
<span class="sd">                If `scope=avg`, consider the simple average over all steps</span>
<span class="sd">                for `metric` and compare across trials based on</span>
<span class="sd">                `mode=[min,max]`. If `scope=last-5-avg` or `scope=last-10-avg`,</span>
<span class="sd">                consider the simple average over the last 5 or 10 steps for</span>
<span class="sd">                `metric` and compare across trials based on `mode=[min,max]`.</span>
<span class="sd">                If `scope=all`, find each trial&#39;s min/max score for `metric`</span>
<span class="sd">                based on `mode`, and compare trials based on `mode=[min,max]`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_trial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_trial</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">best_trial</span><span class="o">.</span><span class="n">config</span> <span class="k">if</span> <span class="n">best_trial</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.get_best_logdir"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.get_best_logdir.html#ray.tune.ExperimentAnalysis.get_best_logdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_best_logdir</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the logdir corresponding to the best trial.</span>

<span class="sd">        Compares all trials&#39; scores on `metric`.</span>
<span class="sd">        If ``metric`` is not specified, ``self.default_metric`` will be used.</span>
<span class="sd">        If `mode` is not specified, ``self.default_mode`` will be used.</span>
<span class="sd">        These values are usually initialized by passing the ``metric`` and</span>
<span class="sd">        ``mode`` parameters to ``tune.run()``.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Key for trial info to order on. Defaults to</span>
<span class="sd">                ``self.default_metric``.</span>
<span class="sd">            mode: One of [min, max]. Defaults to ``self.default_mode``.</span>
<span class="sd">            scope: One of [all, last, avg, last-5-avg, last-10-avg].</span>
<span class="sd">                If `scope=last`, only look at each trial&#39;s final step for</span>
<span class="sd">                `metric`, and compare across trials based on `mode=[min,max]`.</span>
<span class="sd">                If `scope=avg`, consider the simple average over all steps</span>
<span class="sd">                for `metric` and compare across trials based on</span>
<span class="sd">                `mode=[min,max]`. If `scope=last-5-avg` or `scope=last-10-avg`,</span>
<span class="sd">                consider the simple average over the last 5 or 10 steps for</span>
<span class="sd">                `metric` and compare across trials based on `mode=[min,max]`.</span>
<span class="sd">                If `scope=all`, find each trial&#39;s min/max score for `metric`</span>
<span class="sd">                based on `mode`, and compare trials based on `mode=[min,max]`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_trial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_trial</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">best_trial</span><span class="o">.</span><span class="n">local_path</span> <span class="k">if</span> <span class="n">best_trial</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.get_last_checkpoint"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.get_last_checkpoint.html#ray.tune.ExperimentAnalysis.get_last_checkpoint">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;training_iteration&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the last persistent checkpoint path of the provided trial,</span>
<span class="sd">        i.e., with the highest &quot;training_iteration&quot;.</span>

<span class="sd">        If no trial is specified, it loads the best trial according to the</span>
<span class="sd">        provided metric and mode (defaults to max. training iteration).</span>

<span class="sd">        Args:</span>
<span class="sd">            trial: The log directory or an instance of a trial.</span>
<span class="sd">                If None, load the latest trial automatically.</span>
<span class="sd">            metric: If no trial is specified, use this metric to identify</span>
<span class="sd">                the best trial and load the last checkpoint from this trial.</span>
<span class="sd">            mode: If no trial is specified, use the metric and this mode</span>
<span class="sd">                to identify the best trial and load the last checkpoint from it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path for last checkpoint of trial</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_logdir</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_checkpoint</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="s2">&quot;training_iteration&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.fetch_trial_dataframes"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.fetch_trial_dataframes.html#ray.tune.ExperimentAnalysis.fetch_trial_dataframes">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_trial_dataframes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Fetches trial dataframes from files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing &quot;trial dir&quot; to Dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fail_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">failed_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">force_dtype</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trial_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>  <span class="c1"># Never convert trial_id to float.</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trial_paths</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_type</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
                    <span class="n">json_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">EXPR_RESULT_FILE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="p">:</span>
                        <span class="n">download_from_uri</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_local_to_cloud_path</span><span class="p">(</span><span class="n">json_file</span><span class="p">),</span> <span class="n">json_file</span>
                        <span class="p">)</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">json_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">if</span> <span class="n">line</span><span class="p">]</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">json_list</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_type</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
                    <span class="n">csv_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">EXPR_PROGRESS_FILE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="p">:</span>
                        <span class="n">download_from_uri</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_local_to_cloud_path</span><span class="p">(</span><span class="n">csv_file</span><span class="p">),</span> <span class="n">csv_file</span>
                        <span class="p">)</span>

                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">force_dtype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_dataframes</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Exception occurred when loading trial results. See traceback:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">fail_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">failed_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fail_count</span><span class="p">:</span>
            <span class="n">failed_paths_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">failed_paths</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to read the results for </span><span class="si">{</span><span class="n">fail_count</span><span class="si">}</span><span class="s2"> trials:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">failed_paths_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_dataframes</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.stats"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.stats.html#ray.tune.ExperimentAnalysis.stats">[docs]</a>    <span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of the statistics of the experiment.</span>

<span class="sd">        If ``experiment_checkpoint_path`` pointed to a directory of</span>
<span class="sd">        experiments, the dict will be in the format of</span>
<span class="sd">        ``{experiment_session_id: stats}``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">experiment_state</span><span class="p">[</span><span class="s2">&quot;runner_data&quot;</span><span class="p">][</span><span class="s2">&quot;_session_str&quot;</span><span class="p">]:</span> <span class="n">experiment_state</span><span class="p">[</span>
                    <span class="s2">&quot;stats&quot;</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">experiment_state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span>
            <span class="p">}</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.set_filetype"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.set_filetype.html#ray.tune.ExperimentAnalysis.set_filetype">[docs]</a>    <span class="k">def</span> <span class="nf">set_filetype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overrides the existing file type.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_type: Read results from json or csv files. Has to be one</span>
<span class="sd">                of [None, json, csv]. Defaults to csv.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_filetype</span><span class="p">(</span><span class="n">file_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_trial_dataframes</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ExperimentAnalysis.runner_data"><a class="viewcode-back" href="../../../../tune/api/doc/ray.tune.ExperimentAnalysis.runner_data.html#ray.tune.ExperimentAnalysis.runner_data">[docs]</a>    <span class="k">def</span> <span class="nf">runner_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of the TrialRunner data.</span>

<span class="sd">        If ``experiment_checkpoint_path`` pointed to a directory of</span>
<span class="sd">        experiments, the dict will be in the format of</span>
<span class="sd">        ``{experiment_session_id: TrialRunner_data}``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;runner_data&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">experiment_state</span><span class="p">[</span><span class="s2">&quot;runner_data&quot;</span><span class="p">][</span><span class="s2">&quot;_session_str&quot;</span><span class="p">]:</span> <span class="n">experiment_state</span><span class="p">[</span>
                    <span class="s2">&quot;runner_data&quot;</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">experiment_state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_states</span>
            <span class="p">}</span></div>

    <span class="k">def</span> <span class="nf">_get_trial_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">:</span>
            <span class="c1"># We do not need to set the relative path here</span>
            <span class="c1"># Maybe assert that t.local_path is in local_base_path?</span>
            <span class="n">_trial_paths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;No trial data passed in during `ExperimentAnalysis` initialization -- &quot;</span>
                <span class="s2">&quot;you are most likely loading the experiment after it has completed.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Loading trial data from the experiment checkpoint file. &quot;</span>
                <span class="s2">&quot;This may result in loading some stale information, &quot;</span>
                <span class="s2">&quot;since checkpointing is periodic.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trials</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">trial_json_state</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints_and_paths</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">trial</span> <span class="o">=</span> <span class="n">Trial</span><span class="o">.</span><span class="n">from_json_state</span><span class="p">(</span><span class="n">trial_json_state</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">trial</span><span class="o">.</span><span class="n">local_experiment_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Could not load trials from experiment checkpoint. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;This means your experiment checkpoint is likely &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;faulty or incomplete, and you won&#39;t have access &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;to all analysis methods. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Observed error:</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">trial_id</span><span class="p">)</span>
            <span class="n">_trial_paths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_trial_paths</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TuneError</span><span class="p">(</span><span class="s2">&quot;No trials found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_trial_paths</span>

    <span class="k">def</span> <span class="nf">_validate_filetype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`file_type` has to be None or one of [json, csv].&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_type</span> <span class="ow">or</span> <span class="n">DEFAULT_FILE_TYPE</span>

    <span class="k">def</span> <span class="nf">_validate_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">metric</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No `metric` has been passed and  `default_metric` has &quot;</span>
                <span class="s2">&quot;not been set. Please specify the `metric` parameter.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">metric</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_metric</span>

    <span class="k">def</span> <span class="nf">_validate_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mode</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No `mode` has been passed and  `default_mode` has &quot;</span>
                <span class="s2">&quot;not been set. Please specify the `mode` parameter.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If set, `mode` has to be one of [min, max]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mode</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_mode</span>

    <span class="k">def</span> <span class="nf">_retrieve_rows</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">mode</span> <span class="ow">or</span> <span class="n">metric</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rows</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># idx is nan</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Warning: Non-numerical value(s) encountered for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">rows</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Ensure that trials are marked as stubs when pickling,</span>
<span class="sd">        so that they can be loaded later without the trainable</span>
<span class="sd">        being registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">make_stub_if_needed</span><span class="p">(</span><span class="n">trial</span><span class="p">:</span> <span class="n">Trial</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Trial</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">stub</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">trial</span>
            <span class="n">trial_copy</span> <span class="o">=</span> <span class="n">Trial</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">trainable_name</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">trial_copy</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">trial_copy</span>

        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;trials&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_stub_if_needed</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;trials&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">state</span></div>
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>