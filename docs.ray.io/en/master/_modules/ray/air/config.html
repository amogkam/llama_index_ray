
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ray.air.config &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/js/docsearch.js"></script>
    <script src="../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../_static/js/top-navigation.js"></script>
    <script src="../../../_static/js/tags.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/_modules/ray/air/config.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "_modules/ray/air/config", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2F_modules/ray/air/config.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for ray.air.config</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">_MISSING_TYPE</span><span class="p">,</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">ray._private.storage</span> <span class="kn">import</span> <span class="n">_get_storage_uri</span>
<span class="kn">from</span> <span class="nn">ray._private.thirdparty.tabulate.tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">from</span> <span class="nn">ray.air.constants</span> <span class="kn">import</span> <span class="n">WILDCARD_KEY</span>
<span class="kn">from</span> <span class="nn">ray.util.annotations</span> <span class="kn">import</span> <span class="n">PublicAPI</span><span class="p">,</span> <span class="n">Deprecated</span>
<span class="kn">from</span> <span class="nn">ray.widgets</span> <span class="kn">import</span> <span class="n">Template</span><span class="p">,</span> <span class="n">make_table_html_repr</span>
<span class="kn">from</span> <span class="nn">ray.data.preprocessor</span> <span class="kn">import</span> <span class="n">Preprocessor</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ray.data</span> <span class="kn">import</span> <span class="n">Dataset</span>
    <span class="kn">from</span> <span class="nn">ray.tune.callback</span> <span class="kn">import</span> <span class="n">Callback</span>
    <span class="kn">from</span> <span class="nn">ray.tune.progress_reporter</span> <span class="kn">import</span> <span class="n">ProgressReporter</span>
    <span class="kn">from</span> <span class="nn">ray.tune.search.sample</span> <span class="kn">import</span> <span class="n">Domain</span>
    <span class="kn">from</span> <span class="nn">ray.tune.stopper</span> <span class="kn">import</span> <span class="n">Stopper</span>
    <span class="kn">from</span> <span class="nn">ray.tune.syncer</span> <span class="kn">import</span> <span class="n">SyncConfig</span>
    <span class="kn">from</span> <span class="nn">ray.tune.experimental.output</span> <span class="kn">import</span> <span class="n">AirVerbosity</span>
    <span class="kn">from</span> <span class="nn">ray.tune.utils.log</span> <span class="kn">import</span> <span class="n">Verbosity</span>
    <span class="kn">from</span> <span class="nn">ray.tune.execution.placement_groups</span> <span class="kn">import</span> <span class="n">PlacementGroupFactory</span>


<span class="c1"># Dict[str, List] is to support `tune.grid_search`:</span>
<span class="c1"># TODO(sumanthratna/matt): Upstream this to Tune.</span>
<span class="n">SampleRange</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Domain&quot;</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]]</span>


<span class="n">MAX</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span>
<span class="n">MIN</span> <span class="o">=</span> <span class="s2">&quot;min&quot;</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_repr_dataclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">default_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A utility function to elegantly represent dataclasses.</span>

<span class="sd">    In contrast to the default dataclass `__repr__`, which shows all parameters, this</span>
<span class="sd">    function only shows parameters with non-default values.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj: The dataclass to represent.</span>
<span class="sd">        default_values: An optional dictionary that maps field names to default values.</span>
<span class="sd">            Use this parameter to specify default values that are generated dynamically</span>
<span class="sd">            (e.g., in `__post_init__` or by a `default_factory`). If a default value</span>
<span class="sd">            isn&#39;t specified in `default_values`, then the default value is inferred from</span>
<span class="sd">            the `dataclass`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A representation of the dataclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">default_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">default_values</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">non_default_values</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Maps field name to value.</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="n">default_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="n">is_required</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">_MISSING_TYPE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_required</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">default_value</span><span class="p">:</span>
            <span class="n">non_default_values</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(&quot;</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">non_default_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>

    <span class="k">return</span> <span class="n">string</span>


<div class="viewcode-block" id="ScalingConfig"><a class="viewcode-back" href="../../../ray-air/api/doc/ray.air.ScalingConfig.html#ray.air.ScalingConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="nd">@PublicAPI</span><span class="p">(</span><span class="n">stability</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ScalingConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Configuration for scaling training.</span>

<span class="sd">    Args:</span>
<span class="sd">        trainer_resources: Resources to allocate for the trainer. If None is provided,</span>
<span class="sd">            will default to 1 CPU.</span>
<span class="sd">        num_workers: The number of workers (Ray actors) to launch.</span>
<span class="sd">            Each worker will reserve 1 CPU by default. The number of CPUs</span>
<span class="sd">            reserved by each worker can be overridden with the</span>
<span class="sd">            ``resources_per_worker`` argument.</span>
<span class="sd">        use_gpu: If True, training will be done on GPUs (1 per worker).</span>
<span class="sd">            Defaults to False. The number of GPUs reserved by each</span>
<span class="sd">            worker can be overridden with the ``resources_per_worker``</span>
<span class="sd">            argument.</span>
<span class="sd">        resources_per_worker: If specified, the resources</span>
<span class="sd">            defined in this Dict will be reserved for each worker. The</span>
<span class="sd">            ``CPU`` and ``GPU`` keys (case-sensitive) can be defined to</span>
<span class="sd">            override the number of CPU/GPUs used by each worker.</span>
<span class="sd">        placement_strategy: The placement strategy to use for the</span>
<span class="sd">            placement group of the Ray actors. See :ref:`Placement Group</span>
<span class="sd">            Strategies &lt;pgroup-strategy&gt;` for the possible options.</span>
<span class="sd">        _max_cpu_fraction_per_node: [Experimental] The max fraction of CPUs per node</span>
<span class="sd">            that Train will use for scheduling training actors. The remaining CPUs</span>
<span class="sd">            can be used for dataset tasks. It is highly recommended that you set this</span>
<span class="sd">            to less than 1.0 (e.g., 0.8) when passing datasets to trainers, to avoid</span>
<span class="sd">            hangs / CPU starvation of dataset tasks. Warning: this feature is</span>
<span class="sd">            experimental and is not recommended for use with autoscaling (scale-up will</span>
<span class="sd">            not trigger properly).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If adding new attributes here, please also update</span>
    <span class="c1"># ray.train.gbdt_trainer._convert_scaling_config_to_ray_params</span>
    <span class="n">trainer_resources</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">SampleRange</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">SampleRange</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">use_gpu</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">SampleRange</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">resources_per_worker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">SampleRange</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">placement_strategy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SampleRange</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PACK&quot;</span>
    <span class="n">_max_cpu_fraction_per_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">SampleRange</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_per_worker</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_worker</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`use_gpu` is False but `GPU` was found in &quot;</span>
                    <span class="s2">&quot;`resources_per_worker`. Either set `use_gpu` to True or &quot;</span>
                    <span class="s2">&quot;remove `GPU` from `resources_per_worker.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_worker</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`use_gpu` is True but `GPU` is set to 0 in &quot;</span>
                    <span class="s2">&quot;`resources_per_worker`. Either set `use_gpu` to False or &quot;</span>
                    <span class="s2">&quot;request a positive number of `GPU` in &quot;</span>
                    <span class="s2">&quot;`resources_per_worker.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_repr_dataclass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_table_html_repr</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="s2">&quot;ScalingConfig&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_placement_group_factory</span><span class="p">()</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">as_placement_group_factory</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_resources_per_worker_not_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_per_worker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
                <span class="c1"># Note that we don&#39;t request any CPUs, which avoids possible</span>
                <span class="c1"># scheduling contention. Generally nodes have many more CPUs than</span>
                <span class="c1"># GPUs, so not requesting a CPU does not lead to oversubscription.</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">resources_per_worker</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_per_worker</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="n">resources_per_worker</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">resources_per_worker</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_trainer_resources_not_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer_resources</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">:</span>
                <span class="c1"># For Google Colab, don&#39;t allocate resources to the base Trainer.</span>
                <span class="c1"># Colab only has 2 CPUs, and because of this resource scarcity,</span>
                <span class="c1"># we have to be careful on where we allocate resources. Since Colab</span>
                <span class="c1"># is not distributed, the concern about many parallel Ray Tune trials</span>
                <span class="c1"># leading to all Trainers being scheduled on the head node if we set</span>
                <span class="c1"># `trainer_resources` to 0 is no longer applicable.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">google.colab</span>  <span class="c1"># noqa: F401</span>

                    <span class="n">trainer_resources</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="n">trainer_resources</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If there are no additional workers, then always reserve 1 CPU for</span>
                <span class="c1"># the Trainer.</span>
                <span class="n">trainer_resources</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="n">trainer_resources</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer_resources</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Map of total resources required for the trainer.&quot;&quot;&quot;</span>
        <span class="n">total_resource_map</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer_resources_not_none</span><span class="p">)</span>
        <span class="n">num_workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources_per_worker_not_none</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">total_resource_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">num_workers</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">total_resource_map</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_cpus_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of CPUs to set per worker.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources_per_worker_not_none</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_gpus_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of GPUs to set per worker.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources_per_worker_not_none</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">additional_resources_per_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resources per worker, not including CPU or GPU resources.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources_per_worker_not_none</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span> <span class="s2">&quot;GPU&quot;</span><span class="p">]</span>
        <span class="p">}</span>

<div class="viewcode-block" id="ScalingConfig.as_placement_group_factory"><a class="viewcode-back" href="../../../ray-air/api/doc/ray.air.ScalingConfig.as_placement_group_factory.html#ray.air.ScalingConfig.as_placement_group_factory">[docs]</a>    <span class="k">def</span> <span class="nf">as_placement_group_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PlacementGroupFactory&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a PlacementGroupFactory to specify resources for Tune.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ray.tune.execution.placement_groups</span> <span class="kn">import</span> <span class="n">PlacementGroupFactory</span>

        <span class="n">trainer_resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trainer_resources_not_none</span>
        <span class="n">trainer_bundle</span> <span class="o">=</span> <span class="p">[</span><span class="n">trainer_resources</span><span class="p">]</span>
        <span class="n">worker_resources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus_per_worker</span><span class="p">,</span>
            <span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus_per_worker</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">worker_resources_extra</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_per_worker</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources_per_worker</span>
        <span class="p">)</span>
        <span class="n">worker_bundles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="o">**</span><span class="n">worker_resources</span><span class="p">,</span> <span class="o">**</span><span class="n">worker_resources_extra</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">bundles</span> <span class="o">=</span> <span class="n">trainer_bundle</span> <span class="o">+</span> <span class="n">worker_bundles</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_cpu_fraction_per_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;_max_cpu_fraction_per_node&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_cpu_fraction_per_node</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">PlacementGroupFactory</span><span class="p">(</span>
            <span class="n">bundles</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">placement_strategy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ScalingConfig.from_placement_group_factory"><a class="viewcode-back" href="../../../ray-air/api/doc/ray.air.ScalingConfig.from_placement_group_factory.html#ray.air.ScalingConfig.from_placement_group_factory">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_placement_group_factory</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">pgf</span><span class="p">:</span> <span class="s2">&quot;PlacementGroupFactory&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ScalingConfig&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a ScalingConfig from a Tune&#39;s PlacementGroupFactory&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pgf</span><span class="o">.</span><span class="n">head_bundle_is_empty</span><span class="p">:</span>
            <span class="n">trainer_resources</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">worker_bundles</span> <span class="o">=</span> <span class="n">pgf</span><span class="o">.</span><span class="n">bundles</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trainer_resources</span> <span class="o">=</span> <span class="n">pgf</span><span class="o">.</span><span class="n">bundles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">worker_bundles</span> <span class="o">=</span> <span class="n">pgf</span><span class="o">.</span><span class="n">bundles</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">placement_strategy</span> <span class="o">=</span> <span class="n">pgf</span><span class="o">.</span><span class="n">strategy</span>
        <span class="n">resources_per_worker</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">num_workers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_cpu_fraction_per_node</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">worker_bundles</span><span class="p">:</span>
            <span class="n">first_bundle</span> <span class="o">=</span> <span class="n">worker_bundles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">bundle</span> <span class="o">==</span> <span class="n">first_bundle</span> <span class="k">for</span> <span class="n">bundle</span> <span class="ow">in</span> <span class="n">worker_bundles</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;All worker bundles (any other than the first one) &quot;</span>
                    <span class="s2">&quot;must be equal to each other.&quot;</span>
                <span class="p">)</span>
            <span class="n">use_gpu</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">first_bundle</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GPU&quot;</span><span class="p">))</span>
            <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">worker_bundles</span><span class="p">)</span>
            <span class="n">resources_per_worker</span> <span class="o">=</span> <span class="n">first_bundle</span>

        <span class="k">if</span> <span class="s2">&quot;_max_cpu_fraction_per_node&quot;</span> <span class="ow">in</span> <span class="n">pgf</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">:</span>
            <span class="n">max_cpu_fraction_per_node</span> <span class="o">=</span> <span class="n">pgf</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s2">&quot;_max_cpu_fraction_per_node&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ScalingConfig</span><span class="p">(</span>
            <span class="n">trainer_resources</span><span class="o">=</span><span class="n">trainer_resources</span><span class="p">,</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
            <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
            <span class="n">resources_per_worker</span><span class="o">=</span><span class="n">resources_per_worker</span><span class="p">,</span>
            <span class="n">placement_strategy</span><span class="o">=</span><span class="n">placement_strategy</span><span class="p">,</span>
            <span class="n">_max_cpu_fraction_per_node</span><span class="o">=</span><span class="n">max_cpu_fraction_per_node</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<span class="nd">@dataclass</span>
<span class="nd">@Deprecated</span><span class="p">(</span>
    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `ray.train.DataConfig` instead of DatasetConfig to &quot;</span>
    <span class="s2">&quot;configure data ingest for training.&quot;</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">DatasetConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Configuration for ingest of a single Dataset.</span>

<span class="sd">    See :ref:`the AIR Dataset configuration guide &lt;air-ingest&gt;` for</span>
<span class="sd">    usage examples.</span>

<span class="sd">    This config defines how the Dataset should be read into the DataParallelTrainer.</span>
<span class="sd">    It configures the preprocessing, splitting, and ingest strategy per-dataset.</span>

<span class="sd">    DataParallelTrainers declare default DatasetConfigs for each dataset passed in the</span>
<span class="sd">    ``datasets`` argument. Users have the opportunity to selectively override these</span>
<span class="sd">    configs by passing the ``dataset_config`` argument. Trainers can also define user</span>
<span class="sd">    customizable values (e.g., XGBoostTrainer doesn&#39;t support streaming ingest).</span>

<span class="sd">    Args:</span>
<span class="sd">        fit: Whether to fit preprocessors on this dataset. This can be set on at most</span>
<span class="sd">            one dataset at a time. True by default for the &quot;train&quot; dataset only.</span>
<span class="sd">        split: Whether the dataset should be split across multiple workers.</span>
<span class="sd">            True by default for the &quot;train&quot; dataset only.</span>
<span class="sd">        required: Whether to raise an error if the Dataset isn&#39;t provided by the user.</span>
<span class="sd">            False by default.</span>
<span class="sd">        transform: Whether to transform the dataset with the fitted preprocessor.</span>
<span class="sd">            This must be enabled at least for the dataset that is fit.</span>
<span class="sd">            True by default.</span>
<span class="sd">        max_object_store_memory_fraction [Experimental]: The maximum fraction</span>
<span class="sd">            of Ray&#39;s shared-memory object store to use for the dataset. The</span>
<span class="sd">            default value is -1, meaning that the preprocessed dataset should</span>
<span class="sd">            be cached, which may cause spilling if its size is larger than the</span>
<span class="sd">            object store&#39;s capacity. Pipelined ingest (all other values, 0 or</span>
<span class="sd">            higher) is experimental. Note that the absolute memory capacity</span>
<span class="sd">            used is based on the object store capacity at invocation time; this</span>
<span class="sd">            does not currently cover autoscaling cases where the size of the</span>
<span class="sd">            cluster may change.</span>
<span class="sd">        global_shuffle: Whether to enable global shuffle (per pipeline window</span>
<span class="sd">            in streaming mode). Note that this is an expensive all-to-all operation,</span>
<span class="sd">            and most likely you want to use local shuffle instead.</span>
<span class="sd">            See https://docs.ray.io/en/master/data/faq.html and</span>
<span class="sd">            https://docs.ray.io/en/master/ray-air/check-ingest.html.</span>
<span class="sd">            False by default.</span>
<span class="sd">        randomize_block_order: Whether to randomize the iteration order over blocks.</span>
<span class="sd">            The main purpose of this is to prevent data fetching hotspots in the</span>
<span class="sd">            cluster when running many parallel workers / trials on the same data.</span>
<span class="sd">            We recommend enabling it always. True by default.</span>
<span class="sd">        per_epoch_preprocessor [Experimental]: A preprocessor to re-apply on</span>
<span class="sd">            each pass of the dataset. The main use case for this is to apply a</span>
<span class="sd">            random transform on a training dataset on each epoch. The</span>
<span class="sd">            per-epoch preprocessor will be applied *after* all other</span>
<span class="sd">            preprocessors and in parallel with the dataset consumer.</span>
<span class="sd">        use_stream_api: Deprecated. Use max_object_store_memory_fraction instead.</span>
<span class="sd">        stream_window_size: Deprecated. Use max_object_store_memory_fraction instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO(ekl) could we unify DataParallelTrainer and Trainer so the same data ingest</span>
    <span class="c1"># strategy applies to all Trainers?</span>

    <span class="n">fit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">split</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">required</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">transform</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">max_object_store_memory_fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">global_shuffle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">randomize_block_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">per_epoch_preprocessor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Preprocessor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Deprecated.</span>
    <span class="n">use_stream_api</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">stream_window_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_repr_dataclass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">make_table_html_repr</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_stream_api</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span>
                <span class="s2">&quot;DatasetConfig.use_stream_api and DatasetConfig.stream_window_size &quot;</span>
                <span class="s2">&quot;have been removed as of Ray 2.3. Instead, use &quot;</span>
                <span class="s2">&quot;DatasetConfig.max_object_store_memory_fraction with a value &quot;</span>
                <span class="s2">&quot;0 or greater &quot;</span>
                <span class="s2">&quot;(https://docs.ray.io/en/latest/ray-air/package-ref.html&quot;</span>
                <span class="s2">&quot;#ray.air.config.DatasetConfig).&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">fill_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of this config with all default values filled in.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DatasetConfig</span><span class="p">(</span>
            <span class="n">fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">split</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">max_object_store_memory_fraction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">global_shuffle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_shuffle</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">randomize_block_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">randomize_block_order</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">randomize_block_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">per_epoch_preprocessor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span>
        <span class="n">a</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Merge two given DatasetConfigs, the second taking precedence.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if validation fails on the merged configs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_wildcard</span> <span class="o">=</span> <span class="n">WILDCARD_KEY</span> <span class="ow">in</span> <span class="n">a</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_merge</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">has_wildcard</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">WILDCARD_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">_merge</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid dataset config `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`. It must be one of `</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validated</span><span class="p">(</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">],</span> <span class="n">datasets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Validate the given config and datasets are usable.</span>

<span class="sd">        Returns dict of validated configs with defaults filled out.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="n">datasets</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">has_wildcard</span> <span class="o">=</span> <span class="n">WILDCARD_KEY</span> <span class="ow">in</span> <span class="n">config</span>
        <span class="n">fittable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">fill_defaults</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">fit</span><span class="p">:</span>
                <span class="n">fittable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Error configuring dataset `</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">`: cannot specify both &quot;</span>
                        <span class="s2">&quot;fit=True and transform=False.&quot;</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The required dataset `</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">` was not found in </span><span class="si">{</span><span class="n">datasets</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error configuring dataset `</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">`: &quot;</span>
                    <span class="s2">&quot;max_object_store_memory_fraction &quot;</span>
                    <span class="s2">&quot;must be None or a float with value -1 or &gt;=0, but got &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">v</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
                <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error configuring dataset `</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">`: &quot;</span>
                    <span class="s2">&quot;max_object_store_memory_fraction &quot;</span>
                    <span class="s2">&quot;must be None or a float with value -1 or &gt;=0, but got &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span><span class="p">,</span> <span class="n">Preprocessor</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;`per_epoch_preprocessor` must be a ray.data.Preprocessor &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;but got </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span><span class="o">.</span><span class="n">fit_status</span><span class="p">()</span>
                    <span class="o">!=</span> <span class="n">Preprocessor</span><span class="o">.</span><span class="n">FitStatus</span><span class="o">.</span><span class="n">NOT_FITTABLE</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;`per_epoch_preprocessor` currently does not support &quot;</span>
                        <span class="s2">&quot;fittable ray.data.Preprocessors.&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fittable</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;More than one dataset was specified to be fit: </span><span class="si">{</span><span class="n">fittable</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_wildcard</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;An unexpected dataset `</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">` was given. The list of expected &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;datasets is `</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DatasetConfig&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Merge the given DatasetConfig into this one.&quot;&quot;&quot;</span>
        <span class="n">new_config</span> <span class="o">=</span> <span class="n">DatasetConfig</span><span class="p">(</span>
            <span class="n">fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">fit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span>
            <span class="n">split</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">split</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">split</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">required</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">required</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">transform</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">max_object_store_memory_fraction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">max_object_store_memory_fraction</span><span class="p">,</span>
            <span class="n">global_shuffle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_shuffle</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">global_shuffle</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">global_shuffle</span><span class="p">,</span>
            <span class="n">randomize_block_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">randomize_block_order</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">randomize_block_order</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">randomize_block_order</span><span class="p">,</span>
            <span class="n">per_epoch_preprocessor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">per_epoch_preprocessor</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_config</span>


<div class="viewcode-block" id="FailureConfig"><a class="viewcode-back" href="../../../ray-air/api/doc/ray.air.FailureConfig.html#ray.air.FailureConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="nd">@PublicAPI</span><span class="p">(</span><span class="n">stability</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">FailureConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Configuration related to failure handling of each training/tuning run.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_failures: Tries to recover a run at least this many times.</span>
<span class="sd">            Will recover from the latest checkpoint if present.</span>
<span class="sd">            Setting to -1 will lead to infinite recovery retries.</span>
<span class="sd">            Setting to 0 will disable retries. Defaults to 0.</span>
<span class="sd">        fail_fast: Whether to fail upon the first error. Only used for</span>
<span class="sd">            Ray Tune - this does not apply</span>
<span class="sd">            to single training runs (e.g. with ``Trainer.fit()``).</span>
<span class="sd">            If fail_fast=&#39;raise&#39; provided, Ray Tune will automatically</span>
<span class="sd">            raise the exception received by the Trainable. fail_fast=&#39;raise&#39;</span>
<span class="sd">            can easily leak resources and should be used with caution (it</span>
<span class="sd">            is best used with `ray.init(local_mode=True)`).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_failures</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fail_fast</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Same check as in tune.run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_fast</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_failures</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_failures must be 0 if fail_fast=True.&quot;</span><span class="p">)</span>

        <span class="c1"># Same check as in TrialRunner</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fail_fast</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_fast</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;RAISE&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;fail_fast must be one of {bool, &#39;raise&#39;}. &quot;</span> <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fail_fast</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_repr_dataclass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;scrollableTable.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="n">tabulate</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Setting&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Max failures&quot;</span><span class="p">,</span> <span class="s2">&quot;Fail fast&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_failures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_fast</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">,</span>
                <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">max_height</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CheckpointConfig"><a class="viewcode-back" href="../../../ray-air/api/doc/ray.air.CheckpointConfig.html#ray.air.CheckpointConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="nd">@PublicAPI</span><span class="p">(</span><span class="n">stability</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CheckpointConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Configurable parameters for defining the checkpointing strategy.</span>

<span class="sd">    Default behavior is to persist all checkpoints to disk. If</span>
<span class="sd">    ``num_to_keep`` is set, the default retention policy is to keep the</span>
<span class="sd">    checkpoints with maximum timestamp, i.e. the most recent checkpoints.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_to_keep: The number of checkpoints to keep</span>
<span class="sd">            on disk for this run. If a checkpoint is persisted to disk after</span>
<span class="sd">            there are already this many checkpoints, then an existing</span>
<span class="sd">            checkpoint will be deleted. If this is ``None`` then checkpoints</span>
<span class="sd">            will not be deleted. Must be &gt;= 1.</span>
<span class="sd">        checkpoint_score_attribute: The attribute that will be used to</span>
<span class="sd">            score checkpoints to determine which checkpoints should be kept</span>
<span class="sd">            on disk when there are greater than ``num_to_keep`` checkpoints.</span>
<span class="sd">            This attribute must be a key from the checkpoint</span>
<span class="sd">            dictionary which has a numerical value. Per default, the last</span>
<span class="sd">            checkpoints will be kept.</span>
<span class="sd">        checkpoint_score_order: Either &quot;max&quot; or &quot;min&quot;.</span>
<span class="sd">            If &quot;max&quot;, then checkpoints with highest values of</span>
<span class="sd">            ``checkpoint_score_attribute`` will be kept.</span>
<span class="sd">            If &quot;min&quot;, then checkpoints with lowest values of</span>
<span class="sd">            ``checkpoint_score_attribute`` will be kept.</span>
<span class="sd">        checkpoint_frequency: Number of iterations between checkpoints. If 0</span>
<span class="sd">            this will disable checkpointing.</span>
<span class="sd">            Please note that most trainers will still save one checkpoint at</span>
<span class="sd">            the end of training.</span>
<span class="sd">            This attribute is only supported</span>
<span class="sd">            by trainers that don&#39;t take in custom training loops.</span>
<span class="sd">        checkpoint_at_end: If True, will save a checkpoint at the end of training.</span>
<span class="sd">            This attribute is only supported by trainers that don&#39;t take in</span>
<span class="sd">            custom training loops. Defaults to True for trainers that support it</span>
<span class="sd">            and False for generic function trainables.</span>
<span class="sd">        _checkpoint_keep_all_ranks: If True, will save checkpoints from all ranked</span>
<span class="sd">            training workers. If False, only checkpoint from rank 0 worker is kept.</span>
<span class="sd">            NOTE: This API is experimental and subject to change between minor</span>
<span class="sd">            releases.</span>
<span class="sd">        _checkpoint_upload_from_workers: If True, distributed workers</span>
<span class="sd">            will upload their checkpoints to cloud directly. This is to avoid the</span>
<span class="sd">            need for transferring large checkpoint files to the training worker</span>
<span class="sd">            group coordinator for persistence. NOTE: This API is experimental and</span>
<span class="sd">            subject to change between minor releases.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_to_keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">checkpoint_score_attribute</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">checkpoint_score_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAX</span>
    <span class="n">checkpoint_frequency</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">checkpoint_at_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_checkpoint_keep_all_ranks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_checkpoint_upload_from_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_to_keep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_to_keep</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Received invalid num_to_keep: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_to_keep</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Must be None or an integer &gt;= 1.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">MAX</span><span class="p">,</span> <span class="n">MIN</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;checkpoint_score_order must be either &quot;</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">MAX</span><span class="si">}</span><span class="s1">&quot; or &quot;</span><span class="si">{</span><span class="n">MIN</span><span class="si">}</span><span class="s1">&quot;.&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_frequency</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;checkpoint_frequency must be &gt;=0, got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_frequency</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_repr_dataclass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_to_keep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_to_keep_repr</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_to_keep_repr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_to_keep</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_attribute</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checkpoint_score_attribute_repr</span> <span class="o">=</span> <span class="s2">&quot;Most recent&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">checkpoint_score_attribute_repr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_attribute</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_at_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checkpoint_at_end_repr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">checkpoint_at_end_repr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_at_end</span>

        <span class="k">return</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;scrollableTable.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="n">tabulate</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Setting&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Number of checkpoints to keep&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Checkpoint score attribute&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Checkpoint score order&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Checkpoint frequency&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Checkpoint at end&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">num_to_keep_repr</span><span class="p">,</span>
                        <span class="n">checkpoint_score_attribute_repr</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_order</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_frequency</span><span class="p">,</span>
                        <span class="n">checkpoint_at_end_repr</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">},</span>
                <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">,</span>
                <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">max_height</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_tune_legacy_checkpoint_score_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Same as ``checkpoint_score_attr`` in ``tune.run``.</span>

<span class="sd">        Only used for Legacy API compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_attribute</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_attribute</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_order</span> <span class="o">==</span> <span class="n">MIN</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;min-&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_score_attribute</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="RunConfig"><a class="viewcode-back" href="../../../ray-air/api/doc/ray.air.RunConfig.html#ray.air.RunConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="nd">@PublicAPI</span><span class="p">(</span><span class="n">stability</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RunConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Runtime configuration for training and tuning runs.</span>

<span class="sd">    Upon resuming from a training or tuning run checkpoint,</span>
<span class="sd">    Ray Train/Tune will automatically apply the RunConfig from</span>
<span class="sd">    the previously checkpointed run.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the trial or experiment. If not provided, will be deduced</span>
<span class="sd">            from the Trainable.</span>
<span class="sd">        storage_path: Path to store results at. Can be a local directory or</span>
<span class="sd">            a destination on cloud storage. If Ray storage is set up,</span>
<span class="sd">            defaults to the storage location. Otherwise, this defaults to</span>
<span class="sd">            the local ``~/ray_results`` directory.</span>
<span class="sd">        stop: Stop conditions to consider. Refer to ray.tune.stopper.Stopper</span>
<span class="sd">            for more info. Stoppers should be serializable.</span>
<span class="sd">        callbacks: Callbacks to invoke.</span>
<span class="sd">            Refer to ray.tune.callback.Callback for more info.</span>
<span class="sd">            Callbacks should be serializable.</span>
<span class="sd">            Currently only stateless callbacks are supported for resumed runs.</span>
<span class="sd">            (any state of the callback will not be checkpointed by Tune</span>
<span class="sd">            and thus will not take effect in resumed runs).</span>
<span class="sd">        failure_config: Failure mode configuration.</span>
<span class="sd">        sync_config: Configuration object for syncing. See tune.SyncConfig.</span>
<span class="sd">        checkpoint_config: Checkpointing configuration.</span>
<span class="sd">        progress_reporter: Progress reporter for reporting</span>
<span class="sd">            intermediate experiment progress. Defaults to CLIReporter if</span>
<span class="sd">            running in command-line, or JupyterNotebookReporter if running in</span>
<span class="sd">            a Jupyter notebook.</span>
<span class="sd">        verbose: 0, 1, or 2. Verbosity mode.</span>
<span class="sd">            0 = silent, 1 = default, 2 = verbose. Defaults to 1.</span>
<span class="sd">            If the ``RAY_AIR_NEW_OUTPUT=1`` environment variable is set,</span>
<span class="sd">            uses the old verbosity settings:</span>
<span class="sd">            0 = silent, 1 = only status updates, 2 = status and brief</span>
<span class="sd">            results, 3 = status and detailed results.</span>
<span class="sd">        log_to_file: Log stdout and stderr to files in</span>
<span class="sd">            trial directories. If this is `False` (default), no files</span>
<span class="sd">            are written. If `true`, outputs are written to `trialdir/stdout`</span>
<span class="sd">            and `trialdir/stderr`, respectively. If this is a single string,</span>
<span class="sd">            this is interpreted as a file relative to the trialdir, to which</span>
<span class="sd">            both streams are written. If this is a Sequence (e.g. a Tuple),</span>
<span class="sd">            it has to have length 2 and the elements indicate the files to</span>
<span class="sd">            which stdout and stderr are written, respectively.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">storage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Callback&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">stop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">,</span> <span class="s2">&quot;Stopper&quot;</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">failure_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FailureConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">sync_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;SyncConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">checkpoint_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CheckpointConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">progress_reporter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ProgressReporter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;AirVerbosity&quot;</span><span class="p">,</span> <span class="s2">&quot;Verbosity&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">log_to_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Deprecated</span>
    <span class="n">local_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ray.tune.syncer</span> <span class="kn">import</span> <span class="n">SyncConfig</span><span class="p">,</span> <span class="n">Syncer</span>
        <span class="kn">from</span> <span class="nn">ray.tune.utils.util</span> <span class="kn">import</span> <span class="n">_resolve_storage_path</span>
        <span class="kn">from</span> <span class="nn">ray.tune.experimental.output</span> <span class="kn">import</span> <span class="n">AirVerbosity</span><span class="p">,</span> <span class="n">get_air_verbosity</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failure_config</span> <span class="o">=</span> <span class="n">FailureConfig</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span> <span class="o">=</span> <span class="n">SyncConfig</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_config</span> <span class="o">=</span> <span class="n">CheckpointConfig</span><span class="p">()</span>

        <span class="c1"># Convert Paths to strings</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">)</span>

        <span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span> <span class="o">=</span> <span class="n">_resolve_storage_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="o">.</span><span class="n">upload_dir</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="o">.</span><span class="n">upload_dir</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">remote_path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="o">.</span><span class="n">upload_dir</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Setting a `SyncConfig.upload_dir` is deprecated and will be removed &quot;</span>
                <span class="s2">&quot;in the future. Pass `RunConfig.storage_path` instead.&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Set upload_dir to None to avoid further downstream resolution.</span>
            <span class="c1"># Copy object first to not alter user input.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="o">.</span><span class="n">upload_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">local_path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Setting a `RunConfig.local_dir` is deprecated and will be removed &quot;</span>
                <span class="s2">&quot;in the future. If you are not using remote storage,&quot;</span>
                <span class="s2">&quot;set the `RunConfig.storage_path` instead. Otherwise, set the&quot;</span>
                <span class="s2">&quot;`RAY_AIR_LOCAL_CACHE_DIR` environment variable to control &quot;</span>
                <span class="s2">&quot;the local cache location.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_path</span><span class="p">:</span>
            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">_get_storage_uri</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">remote_path</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Using configured Ray storage URI as storage path: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">remote_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span> <span class="o">=</span> <span class="n">remote_path</span>
            <span class="k">if</span> <span class="n">local_path</span><span class="p">:</span>
                <span class="c1"># If storage_path is a remote path set by SyncConfig.upload_dir,</span>
                <span class="c1"># this may not have been set in the previous if clause.</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;RAY_AIR_LOCAL_CACHE_DIR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_path</span>
        <span class="k">elif</span> <span class="n">local_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span> <span class="o">=</span> <span class="n">local_path</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="o">.</span><span class="n">syncer</span><span class="p">,</span> <span class="n">Syncer</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">remote_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Must specify a remote `storage_path` to use a custom `syncer`.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default `verbose` value. For new output engine,</span>
            <span class="c1"># this is AirVerbosity.DEFAULT.</span>
            <span class="c1"># For old output engine, this is Verbosity.V3_TRIAL_DETAILS</span>
            <span class="c1"># Todo (krfricke): Currently uses number to pass test_configs::test_repr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">get_air_verbosity</span><span class="p">(</span><span class="n">AirVerbosity</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ray.tune.syncer</span> <span class="kn">import</span> <span class="n">SyncConfig</span>

        <span class="k">return</span> <span class="n">_repr_dataclass</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">default_values</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;failure_config&quot;</span><span class="p">:</span> <span class="n">FailureConfig</span><span class="p">(),</span>
                <span class="s2">&quot;sync_config&quot;</span><span class="p">:</span> <span class="n">SyncConfig</span><span class="p">(),</span>
                <span class="s2">&quot;checkpoint_config&quot;</span><span class="p">:</span> <span class="n">CheckpointConfig</span><span class="p">(),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">reprs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;title_data_mini.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Failure Config&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_config</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;title_data_mini.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Sync Config&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sync_config</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;title_data_mini.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Checkpoint Config&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_config</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Create a divider between each displayed repr</span>
        <span class="n">subconfigs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Template</span><span class="p">(</span><span class="s2">&quot;divider.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">()]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">reprs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">subconfigs</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">reprs</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;scrollableTable.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="n">tabulate</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;Local results directory&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_dir</span><span class="p">,</span>
                    <span class="s2">&quot;Verbosity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
                    <span class="s2">&quot;Log to file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_to_file</span><span class="p">,</span>
                <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Setting&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">],</span>
                <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">max_height</span><span class="o">=</span><span class="s2">&quot;300px&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;title_data.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;RunConfig&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">Template</span><span class="p">(</span><span class="s2">&quot;run_config.html.j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
                <span class="n">subconfigs</span><span class="o">=</span><span class="n">subconfigs</span><span class="p">,</span>
                <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>