
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Visualizing Population Based Training (PBT) Hyperparameter Optimization &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/js/docsearch.js"></script>
    <script src="../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../_static/js/top-navigation.js"></script>
    <script src="../../../_static/js/tags.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/tune/examples/pbt_visualization/pbt_visualization.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Running Distributed Experiments with Ray Tune" href="../../tutorials/tune-distributed.html" />
    <link rel="prev" title="A Guide to Population Based Training with Tune" href="../pbt_guide.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "tune/examples/pbt_visualization/pbt_visualization", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".ipynb", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../tune.html">
   Ray Tune
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../getting-started.html">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../../tutorials/overview.html">
     User Guides
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-run.html">
       Running Basic Experiments
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-output.html">
       Logging and Outputs in Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-resources.html">
       Setting Trial Resources
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-search-spaces.html">
       Using Search Spaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-stopping.html">
       How to Define Stopping Criteria for a Ray Tune Experiment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-trial-checkpoints.html">
       How to Save and Load Trial Checkpoints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-storage.html">
       How to Configure Storage Options for a Distributed Tune Experiment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-fault-tolerance.html">
       How to Enable Fault Tolerance in Ray Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-metrics.html">
       Using Callbacks and Metrics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune_get_data_in_and_out.html">
       Getting Data in and out of Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../tune_analyze_results.html">
       Analyzing Tune Experiment Results
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="../pbt_guide.html">
       A Guide to Population Based Training with Tune
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="pbt_visualization.html#">
         Visualizing and Understanding PBT
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-distributed.html">
       Deploying Tune in the Cloud
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-lifecycle.html">
       Tune Architecture
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/tune-scalability.html">
       Scalability Benchmarks
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../index.html">
     Ray Tune Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../faq.html">
     Ray Tune FAQ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../api/api.html">
     Ray Tune API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Ftune/examples/pbt_visualization/pbt_visualization.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/tune/examples/pbt_visualization/pbt_visualization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/tune/examples/pbt_visualization/pbt_visualization.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#set-up-toy-the-example">
   Set up Toy the Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#defining-the-function-trainable">
   Defining the Function Trainable
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#configure-pbt-and-tuner">
   Configure PBT and Tuner
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="pbt_visualization.html#create-the-pbt-scheduler">
     Create the PBT scheduler
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="pbt_visualization.html#create-the-tuner">
     Create the Tuner
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#run-the-experiment">
   Run the experiment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#visualize-results">
   Visualize results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="pbt_visualization.html#animate-the-training-progress">
     Animate the training progress
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#grid-search-comparison">
   Grid Search Comparison
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#increase-pbt-population-size">
   Increase PBT population size
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#summary">
   Summary
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Visualizing Population Based Training (PBT) Hyperparameter Optimization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#set-up-toy-the-example">
   Set up Toy the Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#defining-the-function-trainable">
   Defining the Function Trainable
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#configure-pbt-and-tuner">
   Configure PBT and Tuner
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="pbt_visualization.html#create-the-pbt-scheduler">
     Create the PBT scheduler
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="pbt_visualization.html#create-the-tuner">
     Create the Tuner
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#run-the-experiment">
   Run the experiment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#visualize-results">
   Visualize results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="pbt_visualization.html#animate-the-training-progress">
     Animate the training progress
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#grid-search-comparison">
   Grid Search Comparison
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#increase-pbt-population-size">
   Increase PBT population size
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="pbt_visualization.html#summary">
   Summary
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="visualizing-population-based-training-pbt-hyperparameter-optimization">
<h1>Visualizing Population Based Training (PBT) Hyperparameter Optimization<a class="headerlink" href="pbt_visualization.html#visualizing-population-based-training-pbt-hyperparameter-optimization" title="Permalink to this headline">#</a></h1>
<p><strong>Assumptions:</strong> The reader has a basic understanding of the <a class="reference external" href="https://www.deepmind.com/blog/population-based-training-of-neural-networks">PBT algorithm</a> and wants to dive deeper and verify the underlying algorithm behavior with <a class="reference internal" href="../../api/schedulers.html#tune-scheduler-pbt"><span class="std std-ref">Rayâ€™s PBT implementation</span></a>. <a class="reference internal" href="../pbt_guide.html#pbt-guide-ref"><span class="std std-ref">This guide</span></a> provides resources for gaining some context.</p>
<p>This tutorial will go through a simple example that will help you develop a better understanding of what PBT is doing under the hood when using it to tune your algorithms. Follow along by launching the notebook with the rocket ðŸš€ icon above.</p>
<p>We will learn how to:</p>
<ol class="simple">
<li><p><strong>Set up checkpointing and loading for PBT</strong> with the function trainable interface</p></li>
<li><p><strong>Configure Tune and PBT scheduler parameters</strong></p></li>
<li><p><strong>Visualize PBT algorithm behavior</strong> to gain some intuition</p></li>
</ol>
<section id="set-up-toy-the-example">
<h2>Set up Toy the Example<a class="headerlink" href="pbt_visualization.html#set-up-toy-the-example" title="Permalink to this headline">#</a></h2>
<p>The toy example optimization problem we will use comes from the <a class="reference external" href="https://arxiv.org/pdf/1711.09846.pdf">PBT paper</a> (see Figure 2 for more details). The goal is to find parameters that maximize an quadratic function, while only having access to an estimator that depends on a set of hyperparameters. A practical example of this is maximizing the (unknown) generalization capabilities of a model across all possible inputs with only access to the empirical loss of your model, which depends on hyperparameters in order to optimize.</p>
<p>Weâ€™ll start with some imports.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install -U <span class="s2">&quot;ray[tune]&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Note: If youâ€™re running on Colab, please copy <a class="reference internal" href="pbt_visualization_utils.html"><span class="doc">this helper file</span></a> into your Colab mount as <code class="docutils literal notranslate"><span class="pre">pbt_visualization_utils.py</span></code> using the file explorer on the left.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">tune</span>
<span class="kn">from</span> <span class="nn">ray.air</span> <span class="kn">import</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">ray.air.checkpoint</span> <span class="kn">import</span> <span class="n">Checkpoint</span>
<span class="kn">from</span> <span class="nn">ray.tune.schedulers</span> <span class="kn">import</span> <span class="n">PopulationBasedTraining</span>
<span class="kn">from</span> <span class="nn">ray.tune.tune_config</span> <span class="kn">import</span> <span class="n">TuneConfig</span>
<span class="kn">from</span> <span class="nn">ray.air.config</span> <span class="kn">import</span> <span class="n">FailureConfig</span><span class="p">,</span> <span class="n">RunConfig</span>
<span class="kn">from</span> <span class="nn">ray.tune.tuner</span> <span class="kn">import</span> <span class="n">Tuner</span>

<span class="kn">from</span> <span class="nn">pbt_visualization_utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_init_theta</span><span class="p">,</span> <span class="n">plot_parameter_history</span><span class="p">,</span>
    <span class="n">plot_Q_history</span><span class="p">,</span> <span class="n">make_animation</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Concretely, we will use the definitions (with very minor modifications) provided in the <a class="reference external" href="https://arxiv.org/pdf/1711.09846.pdf">paper</a> for the function we are trying to optimize, and the estimator we are given.</p>
<p>Here is a list of the concepts we will use for the example, and what they might be analagous to in practice:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Concept within this example</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Practical analogy</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">theta</span> <span class="pre">=</span> <span class="pre">[theta0,</span> <span class="pre">theta1]</span></code></p></td>
<td><p>The model parameters that we will update in our training loop.</p></td>
<td><p>Neural network parameters</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">=</span> <span class="pre">[h0,</span> <span class="pre">h1]</span></code></p></td>
<td><p>The hyperparameters that PBT will optimize.</p></td>
<td><p>Learning rate, batch size, etc.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Q(theta)</span></code></p></td>
<td><p>The quadratic function we are trying to maximize.</p></td>
<td><p>Generalization capability over all inputs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Qhat(theta</span> <span class="pre">|</span> <span class="pre">h)</span></code></p></td>
<td><p>The estimator we are given as our training objective, depends (<code class="docutils literal notranslate"><span class="pre">|</span></code>) on <code class="docutils literal notranslate"><span class="pre">h</span></code>.</p></td>
<td><p>Empirical loss/reward</p></td>
</tr>
</tbody>
</table>
<p>Below are the implementations in code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1.2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">Qhat</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1.2</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">grad_Qhat</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="n">theta_grad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">theta</span>
    <span class="n">theta_grad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span>
    <span class="n">h_grad</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">h_grad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta_grad</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="n">h_grad</span><span class="p">}</span>

<span class="n">theta_0</span> <span class="o">=</span> <span class="n">get_init_theta</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial parameter values: theta = &quot;</span><span class="p">,</span> <span class="n">theta_0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial parameter values: theta =  [0.9 0.9]
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-the-function-trainable">
<h2>Defining the Function Trainable<a class="headerlink" href="pbt_visualization.html#defining-the-function-trainable" title="Permalink to this headline">#</a></h2>
<p>We will define the training loop:</p>
<ol class="simple">
<li><p>Load the hyperparameter configuration</p></li>
<li><p>Initialize the model, <strong>resuming from a checkpoint if one exists (this is important for PBT, since the scheduler will pause and resume trials frequently when trials get exploited).</strong></p></li>
<li><p>Run the training loop and <strong>checkpoint.</strong></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_func</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="c1"># Load the hyperparam config passed in by the Tuner</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;h0&quot;</span><span class="p">)</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;h1&quot;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="n">lr</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lr&quot;</span><span class="p">)</span>
    <span class="n">train_step</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">checkpoint_interval</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;checkpoint_interval&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">logging_interval</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logging_interval&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># Initialize the model parameters</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">get_init_theta</span><span class="p">()</span>
    
    <span class="c1"># Load a checkpoint if it exists</span>
    <span class="c1"># This checkpoint could be a trial&#39;s own checkpoint to resume,</span>
    <span class="c1"># or another trial&#39;s checkpoint placed by PBT that we will exploit</span>
    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get_checkpoint</span><span class="p">():</span>
        <span class="n">checkpoint_dict</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_checkpoint</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="c1"># Load in model (theta)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">checkpoint_dict</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span>
        <span class="n">last_step</span> <span class="o">=</span> <span class="n">checkpoint_dict</span><span class="p">[</span><span class="s2">&quot;train_step&quot;</span><span class="p">]</span>
        <span class="n">train_step</span> <span class="o">=</span> <span class="n">last_step</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="c1"># Main training loop (trial stopping is configured later)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Perform gradient ascent steps</span>
        <span class="n">param_grads</span> <span class="o">=</span> <span class="n">grad_Qhat</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">theta_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">param_grads</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">])</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">lr</span> <span class="o">*</span> <span class="n">theta_grad</span>
        
        <span class="c1"># Checkpoint every `checkpoint_interval` steps</span>
        <span class="n">checkpoint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">should_checkpoint</span> <span class="o">=</span> <span class="n">train_step</span> <span class="o">%</span> <span class="n">checkpoint_interval</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">should_checkpoint</span><span class="p">:</span>
            <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">Checkpoint</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span>
                <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span>
                <span class="s2">&quot;train_step&quot;</span><span class="p">:</span> <span class="n">train_step</span><span class="p">,</span>
                <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="c1"># Define which custom metrics we want in our trial result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="n">Q</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
            <span class="s2">&quot;theta0&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;theta1&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;h0&quot;</span><span class="p">:</span> <span class="n">h0</span><span class="p">,</span> <span class="s2">&quot;h1&quot;</span><span class="p">:</span> <span class="n">h1</span><span class="p">,</span>
            <span class="s2">&quot;train_step&quot;</span><span class="p">:</span> <span class="n">train_step</span><span class="p">,</span>
        <span class="p">}</span>
        
        <span class="c1"># Report metric for this training iteration, and include the</span>
        <span class="c1"># trial checkpoint that contains the current parameters if we</span>
        <span class="c1"># saved it this train step</span>
        <span class="n">session</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">)</span>
        
        <span class="n">train_step</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since PBT will keep restoring from latest checkpoints, itâ€™s important to save and load <code class="docutils literal notranslate"><span class="pre">train_step</span></code> correctly in a function trainable. <strong>Make sure you increment the loaded <code class="docutils literal notranslate"><span class="pre">train_step</span></code> by one as shown above.</strong> This avoids repeating an iteration and causing the checkpoint and perturbation intervals to be out of sync.</p>
</div>
</section>
<section id="configure-pbt-and-tuner">
<h2>Configure PBT and Tuner<a class="headerlink" href="pbt_visualization.html#configure-pbt-and-tuner" title="Permalink to this headline">#</a></h2>
<p>We start by initializing ray (shutting it down if a session existed previously).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">ray</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">():</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-14 11:43:32,337	INFO worker.py:1517 -- Started a local Ray instance.
</pre></div>
</div>
<div class="output text_html"><div>
    <div style="margin-left: 50px;display: flex;flex-direction: row;align-items: center">
        <h3 style="color: var(--jp-ui-font-color0)">Ray</h3>
        <svg version="1.1" id="ray" width="3em" viewBox="0 0 144.5 144.6" style="margin-left: 3em;margin-right: 3em">
            <g id="layer-1">
                <path fill="#00a2e9" class="st0" d="M97.3,77.2c-3.8-1.1-6.2,0.9-8.3,5.1c-3.5,6.8-9.9,9.9-17.4,9.6S58,88.1,54.8,81.2c-1.4-3-3-4-6.3-4.1
                    c-5.6-0.1-9.9,0.1-13.1,6.4c-3.8,7.6-13.6,10.2-21.8,7.6C5.2,88.4-0.4,80.5,0,71.7c0.1-8.4,5.7-15.8,13.8-18.2
                    c8.4-2.6,17.5,0.7,22.3,8c1.3,1.9,1.3,5.2,3.6,5.6c3.9,0.6,8,0.2,12,0.2c1.8,0,1.9-1.6,2.4-2.8c3.5-7.8,9.7-11.8,18-11.9
                    c8.2-0.1,14.4,3.9,17.8,11.4c1.3,2.8,2.9,3.6,5.7,3.3c1-0.1,2,0.1,3,0c2.8-0.5,6.4,1.7,8.1-2.7s-2.3-5.5-4.1-7.5
                    c-5.1-5.7-10.9-10.8-16.1-16.3C84,38,81.9,37.1,78,38.3C66.7,42,56.2,35.7,53,24.1C50.3,14,57.3,2.8,67.7,0.5
                    C78.4-2,89,4.7,91.5,15.3c0.1,0.3,0.1,0.5,0.2,0.8c0.7,3.4,0.7,6.9-0.8,9.8c-1.7,3.2-0.8,5,1.5,7.2c6.7,6.5,13.3,13,19.8,19.7
                    c1.8,1.8,3,2.1,5.5,1.2c9.1-3.4,17.9-0.6,23.4,7c4.8,6.9,4.6,16.1-0.4,22.9c-5.4,7.2-14.2,9.9-23.1,6.5c-2.3-0.9-3.5-0.6-5.1,1.1
                    c-6.7,6.9-13.6,13.7-20.5,20.4c-1.8,1.8-2.5,3.2-1.4,5.9c3.5,8.7,0.3,18.6-7.7,23.6c-7.9,5-18.2,3.8-24.8-2.9
                    c-6.4-6.4-7.4-16.2-2.5-24.3c4.9-7.8,14.5-11,23.1-7.8c3,1.1,4.7,0.5,6.9-1.7C91.7,98.4,98,92.3,104.2,86c1.6-1.6,4.1-2.7,2.6-6.2
                    c-1.4-3.3-3.8-2.5-6.2-2.6C99.8,77.2,98.9,77.2,97.3,77.2z M72.1,29.7c5.5,0.1,9.9-4.3,10-9.8c0-0.1,0-0.2,0-0.3
                    C81.8,14,77,9.8,71.5,10.2c-5,0.3-9,4.2-9.3,9.2c-0.2,5.5,4,10.1,9.5,10.3C71.8,29.7,72,29.7,72.1,29.7z M72.3,62.3
                    c-5.4-0.1-9.9,4.2-10.1,9.7c0,0.2,0,0.3,0,0.5c0.2,5.4,4.5,9.7,9.9,10c5.1,0.1,9.9-4.7,10.1-9.8c0.2-5.5-4-10-9.5-10.3
                    C72.6,62.3,72.4,62.3,72.3,62.3z M115,72.5c0.1,5.4,4.5,9.7,9.8,9.9c5.6-0.2,10-4.8,10-10.4c-0.2-5.4-4.6-9.7-10-9.7
                    c-5.3-0.1-9.8,4.2-9.9,9.5C115,72.1,115,72.3,115,72.5z M19.5,62.3c-5.4,0.1-9.8,4.4-10,9.8c-0.1,5.1,5.2,10.4,10.2,10.3
                    c5.6-0.2,10-4.9,9.8-10.5c-0.1-5.4-4.5-9.7-9.9-9.6C19.6,62.3,19.5,62.3,19.5,62.3z M71.8,134.6c5.9,0.2,10.3-3.9,10.4-9.6
                    c0.5-5.5-3.6-10.4-9.1-10.8c-5.5-0.5-10.4,3.6-10.8,9.1c0,0.5,0,0.9,0,1.4c-0.2,5.3,4,9.8,9.3,10
                    C71.6,134.6,71.7,134.6,71.8,134.6z"/>
            </g>
        </svg>
        <table>
            <tr>
                <td style="text-align: left"><b>Python version:</b></td>
                <td style="text-align: left"><b>3.8.13</b></td>
            </tr>
            <tr>
                <td style="text-align: left"><b>Ray version:</b></td>
                <td style="text-align: left"><b> 3.0.0.dev0</b></td>
            </tr>

        </table>
    </div>
</div>
</div></div>
</div>
<section id="create-the-pbt-scheduler">
<h3>Create the PBT scheduler<a class="headerlink" href="pbt_visualization.html#create-the-pbt-scheduler" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">perturbation_interval</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">pbt_scheduler</span> <span class="o">=</span> <span class="n">PopulationBasedTraining</span><span class="p">(</span>
    <span class="n">time_attr</span><span class="o">=</span><span class="s2">&quot;training_iteration&quot;</span><span class="p">,</span>
    <span class="n">perturbation_interval</span><span class="o">=</span><span class="n">perturbation_interval</span><span class="p">,</span>

    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="n">quantile_fraction</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>

    <span class="n">resample_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">hyperparam_mutations</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">qloguniform</span><span class="p">(</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mf">5e-4</span><span class="p">),</span>
        <span class="s2">&quot;h0&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
        <span class="s2">&quot;h1&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="n">synch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A few notes on the PBT config:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time_attr=&quot;training_iteration&quot;</span></code> in combination with <code class="docutils literal notranslate"><span class="pre">perturbation_interval=4</span></code> will decide whether a trial should continue or exploit a different trial every 4 training iterations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metric=&quot;Q&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">mode=&quot;max&quot;</span></code> specify how trial performance is ranked. In this case, the high performing trials are the top 50% of trials (set by <code class="docutils literal notranslate"><span class="pre">quantile_fraction=0.5</span></code>) that report the highest <code class="docutils literal notranslate"><span class="pre">Q</span></code> metrics. Note that we could have set the metric/mode in <code class="docutils literal notranslate"><span class="pre">TuneConfig</span></code> instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hyperparam_mutations</span></code> specifies that the learning rate <code class="docutils literal notranslate"><span class="pre">lr</span></code> and additional hyperparameters <code class="docutils literal notranslate"><span class="pre">h0</span></code>, <code class="docutils literal notranslate"><span class="pre">h1</span></code> should be perturbed by PBT and defines the resample distribution for each hyperparameter (where <code class="docutils literal notranslate"><span class="pre">resample_probability=0.5</span></code> means that resampling and mutation both happen with 50% probability).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">synch=True</span></code> means that PBT will run synchronously, which slows down the algorithm by introducing waits, but it produces more understandable visualizations for the purposes of this tutorial.</p>
<ul>
<li><p>In synchronous PBT, we wait until <strong>all trials</strong> reach the next <code class="docutils literal notranslate"><span class="pre">perturbation_interval</span></code> to decide which trials should continue and which trials should pause and start from the checkpoint of another trials. In the case of 2 trials, this means that every <code class="docutils literal notranslate"><span class="pre">perturbation_interval</span></code> will result in the worse performing trial exploiting the better performing trial.</p></li>
<li><p>This is not always the case in asynchronous PBT, since trials report results and decide whether to continue or exploit <strong>one by one</strong>. This means that a trial could decide that it is a top-performer and decide to continue, since other trials havenâ€™t had the chance to report their better results yet. Therefore, we do not always see trials exploiting on every <code class="docutils literal notranslate"><span class="pre">perturbation_interval</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="create-the-tuner">
<h3>Create the Tuner<a class="headerlink" href="pbt_visualization.html#create-the-tuner" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">Tuner</span><span class="p">(</span>
    <span class="n">train_func</span><span class="p">,</span>
    <span class="n">param_space</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;h0&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">grid_search</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
        <span class="s2">&quot;h1&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">sample_from</span><span class="p">(</span><span class="k">lambda</span> <span class="n">spec</span><span class="p">:</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">spec</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;h0&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;num_training_iterations&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="c1"># Match `checkpoint_interval` with `perturbation_interval`</span>
        <span class="s2">&quot;checkpoint_interval&quot;</span><span class="p">:</span> <span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">tune_config</span><span class="o">=</span><span class="n">TuneConfig</span><span class="p">(</span>
        <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="c1"># Set the PBT scheduler in this config</span>
        <span class="n">scheduler</span><span class="o">=</span><span class="n">pbt_scheduler</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">RunConfig</span><span class="p">(</span>
        <span class="n">stop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;training_iteration&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
        <span class="n">failure_config</span><span class="o">=</span><span class="n">FailureConfig</span><span class="p">(</span><span class="n">max_failures</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We recommend matching <code class="docutils literal notranslate"><span class="pre">checkpoint_interval</span></code> with <code class="docutils literal notranslate"><span class="pre">perturbation_interval</span></code> from the PBT config.
This ensures that the PBT algorithm actually exploits the trials in the most recent iteration.</p>
<p>If your <code class="docutils literal notranslate"><span class="pre">perturbation_interval</span></code> is large and want to checkpoint more frequently, set <code class="docutils literal notranslate"><span class="pre">perturbation_interval</span></code> to be a multiple of <code class="docutils literal notranslate"><span class="pre">checkpoint_interval</span></code>.</p>
</div>
<p>A few other notes on the Tuner config:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">param_space</span></code> specifies the <em>initial</em> <code class="docutils literal notranslate"><span class="pre">config</span></code> input to our training function. A <code class="docutils literal notranslate"><span class="pre">grid_search</span></code> over two values will launch two trials with a certain set of hyperparameters, and PBT will continue modifying them as training progresses.</p></li>
<li><p>The initial hyperparam settings for <code class="docutils literal notranslate"><span class="pre">h0</span></code> and <code class="docutils literal notranslate"><span class="pre">h1</span></code> are configured so that two trials will spawn, one with <code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">=</span> <span class="pre">[1,</span> <span class="pre">0]</span></code> and the other with <code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">=</span> <span class="pre">[0,</span> <span class="pre">1]</span></code>. This matches the paper experiment and will be used to compare against a <code class="docutils literal notranslate"><span class="pre">grid_search</span></code> baseline that removes the PBT scheduler.</p></li>
</ul>
</section>
</section>
<section id="run-the-experiment">
<h2>Run the experiment<a class="headerlink" href="pbt_visualization.html#run-the-experiment" title="Permalink to this headline">#</a></h2>
<p>We launch the trials by calling <code class="docutils literal notranslate"><span class="pre">Tuner.fit</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pbt_results</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-results">
<h2>Visualize results<a class="headerlink" href="pbt_visualization.html#visualize-results" title="Permalink to this headline">#</a></h2>
<p>Using some helper functions <a class="reference internal" href="pbt_visualization_utils.html"><span class="doc">from here</span></a>, we can create some visuals to help us understand the training progression of PBT.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;h = [1, 0]&quot;</span><span class="p">,</span> <span class="s2">&quot;h = [0, 1]&quot;</span><span class="p">]</span>

<span class="n">plot_parameter_history</span><span class="p">(</span>
    <span class="n">pbt_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">perturbation_interval</span><span class="o">=</span><span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">plot_Q_history</span><span class="p">(</span>
    <span class="n">pbt_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/pbt_visualization_20_0.png" src="../../../_images/pbt_visualization_20_0.png" />
</div>
</div>
<p>The plot on the right shows the true function value <code class="docutils literal notranslate"><span class="pre">Q(theta)</span></code> as training progresses for both trials. Both trials reach the maximum value of <code class="docutils literal notranslate"><span class="pre">1.2</span></code>.</p>
<p>Hereâ€™s how to understand the plot on the left:</p>
<ul class="simple">
<li><p>The plot on the left shows the parameter values <code class="docutils literal notranslate"><span class="pre">(theta0,</span> <span class="pre">theta1)</span></code> on every training iteration, for both trials. As the training iteration increases, the size of the point gets smaller.</p></li>
<li><p>We see the iteration shown as a label next to points at every <code class="docutils literal notranslate"><span class="pre">perturbation_interval</span></code> training iterations. Letâ€™s zoom into the transition from iteration 4 to 5 for both the trials.</p>
<ul>
<li><p>We see that a trial either <strong>continues</strong> (see how iteration 4 to 5 for the black trial just continues training) or <strong>exploits and perturbs the other trial and then performs a train step</strong> (see how iteration 4 to 5 for the red trial jumps to the parameter value of the black trial).</p></li>
<li><p>The gradient direction also changes at this step for the black trial due to the hyperparameters changing from the exploit and explore steps of PBT. Remember that the gradient of the estimator <code class="docutils literal notranslate"><span class="pre">Qhat</span></code> depends on the hyperparameters <code class="docutils literal notranslate"><span class="pre">(h0,</span> <span class="pre">h1)</span></code>.</p></li>
<li><p>The varying size of jumps between training iterations shows that the learning rate is also changing, since we included <code class="docutils literal notranslate"><span class="pre">lr</span></code> in the set of hyperparameters to mutate.</p></li>
</ul>
</li>
</ul>
<section id="animate-the-training-progress">
<h3>Animate the training progress<a class="headerlink" href="pbt_visualization.html#animate-the-training-progress" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">make_animation</span><span class="p">(</span>
    <span class="n">pbt_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">perturbation_interval</span><span class="o">=</span><span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;pbt.gif&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also animate the training progress to see whatâ€™s happening to the model parameters at each step.</p>
<p><img alt="PBT Visualization GIF" src="../../../_images/pbt.gif" /></p>
</section>
</section>
<section id="grid-search-comparison">
<h2>Grid Search Comparison<a class="headerlink" href="pbt_visualization.html#grid-search-comparison" title="Permalink to this headline">#</a></h2>
<p>The paper includes a comparison to a grid search of 2 trials, using the same initial hyperparameter configurations (<code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">=</span> <span class="pre">[1,</span> <span class="pre">0],</span> <span class="pre">h</span> <span class="pre">=</span> <span class="pre">[0,</span> <span class="pre">1]</span></code>) as the PBT experiment. The only difference in the code below is removing the PBT scheduler from the <code class="docutils literal notranslate"><span class="pre">TuneConfig</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">ray</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">():</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">Tuner</span><span class="p">(</span>
    <span class="n">train_func</span><span class="p">,</span>
    <span class="n">param_space</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">qloguniform</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">),</span>
        <span class="s2">&quot;h0&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">grid_search</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
        <span class="s2">&quot;h1&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">sample_from</span><span class="p">(</span><span class="k">lambda</span> <span class="n">spec</span><span class="p">:</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">spec</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;h0&quot;</span><span class="p">]),</span>
    <span class="p">},</span>
    <span class="n">tune_config</span><span class="o">=</span><span class="n">TuneConfig</span><span class="p">(</span>
        <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">RunConfig</span><span class="p">(</span>
        <span class="n">stop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;training_iteration&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
        <span class="n">failure_config</span><span class="o">=</span><span class="n">FailureConfig</span><span class="p">(</span><span class="n">max_failures</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">grid_results</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">if</span> <span class="n">grid_results</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</div>
</div>
<p>As we can see, neither trial makes it to the optimum, since the hyperparameter configs are stuck with their original values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;h = [1, 0]&quot;</span><span class="p">,</span> <span class="s2">&quot;h = [0, 1]&quot;</span><span class="p">]</span>

<span class="n">plot_parameter_history</span><span class="p">(</span>
    <span class="n">grid_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">perturbation_interval</span><span class="o">=</span><span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">plot_Q_history</span><span class="p">(</span>
    <span class="n">grid_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/pbt_visualization_28_0.png" src="../../../_images/pbt_visualization_28_0.png" />
</div>
</div>
<p>Compare the two plots we generated with Figure 2 from the <a class="reference external" href="https://arxiv.org/pdf/1711.09846.pdf">PBT paper</a> (in particular, we produced the top-left and bottom-right plots).</p>
<p><img alt="Figure 2" src="../../../_images/figure_from_paper.png" /></p>
</section>
<section id="increase-pbt-population-size">
<h2>Increase PBT population size<a class="headerlink" href="pbt_visualization.html#increase-pbt-population-size" title="Permalink to this headline">#</a></h2>
<p>One last experiment: what does it look like if we increase the PBT population size? Now, low-performing trials will sample one of the multiple high-performing trials to exploit, and it should result in some more interesting behavior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">ray</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">():</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">perturbation_interval</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">pbt_scheduler</span> <span class="o">=</span> <span class="n">PopulationBasedTraining</span><span class="p">(</span>
    <span class="n">time_attr</span><span class="o">=</span><span class="s2">&quot;training_iteration&quot;</span><span class="p">,</span>
    <span class="n">perturbation_interval</span><span class="o">=</span><span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="n">quantile_fraction</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">resample_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">hyperparam_mutations</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">qloguniform</span><span class="p">(</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mf">5e-4</span><span class="p">),</span>
        <span class="s2">&quot;h0&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
        <span class="s2">&quot;h1&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="n">synch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">tuner</span> <span class="o">=</span> <span class="n">Tuner</span><span class="p">(</span>
    <span class="n">train_func</span><span class="p">,</span>
    <span class="n">param_space</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">qloguniform</span><span class="p">(</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mf">5e-4</span><span class="p">),</span>
        <span class="s2">&quot;h0&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">grid_search</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]),</span> <span class="c1"># 4 trials</span>
        <span class="s2">&quot;h1&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">sample_from</span><span class="p">(</span><span class="k">lambda</span> <span class="n">spec</span><span class="p">:</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">spec</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;h0&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;num_training_iterations&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;checkpoint_interval&quot;</span><span class="p">:</span> <span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">tune_config</span><span class="o">=</span><span class="n">TuneConfig</span><span class="p">(</span>
        <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
        <span class="c1"># Set the PBT scheduler in this config</span>
        <span class="n">scheduler</span><span class="o">=</span><span class="n">pbt_scheduler</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">RunConfig</span><span class="p">(</span>
        <span class="n">stop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;training_iteration&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
        <span class="n">failure_config</span><span class="o">=</span><span class="n">FailureConfig</span><span class="p">(</span><span class="n">max_failures</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">pbt_4_results</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;h = [1, 0]&quot;</span><span class="p">,</span> <span class="s2">&quot;h = [0, 1]&quot;</span><span class="p">,</span> <span class="s2">&quot;h = [0.01, 0.99]&quot;</span><span class="p">,</span> <span class="s2">&quot;h = [0.99, 0.01]&quot;</span><span class="p">]</span>

<span class="n">plot_parameter_history</span><span class="p">(</span>
    <span class="n">pbt_4_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">perturbation_interval</span><span class="o">=</span><span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">plot_Q_history</span><span class="p">(</span>
    <span class="n">pbt_4_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/pbt_visualization_32_0.png" src="../../../_images/pbt_visualization_32_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">make_animation</span><span class="p">(</span>
    <span class="n">pbt_4_results</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">perturbation_interval</span><span class="o">=</span><span class="n">perturbation_interval</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;pbt4.gif&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="PBT 4 Trial Visualization" src="../../../_images/pbt4.gif" /></p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="pbt_visualization.html#summary" title="Permalink to this headline">#</a></h2>
<p>Hopefully, this guide has given you a better understanding of the PBT algorithm. Please file any issues you run into when running this notebook and ask any questions you might have in the Ray Slack</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../pbt_guide.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">A Guide to Population Based Training with Tune</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../tutorials/tune-distributed.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Running Distributed Experiments with Ray Tune</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>