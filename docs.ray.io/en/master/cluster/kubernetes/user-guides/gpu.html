
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Using GPUs &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/js/docsearch.js"></script>
    <script src="../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../_static/js/top-navigation.js"></script>
    <script src="../../../_static/js/tags.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/cluster/kubernetes/user-guides/gpu.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Experimental Features" href="experimental.html" />
    <link rel="prev" title="Log Persistence" href="logging.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "cluster/kubernetes/user-guides/gpu", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Deploying on Kubernetes
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started.html">
       Getting Started
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="../user-guides.html">
       User Guides
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4">
        <a class="reference internal" href="k8s-cluster-setup.html">
         Managed Kubernetes services
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="config.html">
         RayCluster Configuration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="configuring-autoscaling.html">
         KubeRay Autoscaling
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="logging.html">
         Log Persistence
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="gpu.html#">
         Using GPUs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="experimental.html">
         Experimental Features
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="static-ray-cluster-without-kuberay.html">
         (Advanced) Deploying a static Ray cluster without KubeRay
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../examples.html">
       Examples
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../references.html">
       API Reference
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../vms/index.html">
     Deploying on VMs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../metrics.html">
     Collecting and monitoring metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../configure-manage-dashboard.html">
     Configuring and Managing Ray Dashboard
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../running-applications/index.html">
     Applications Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../faq.html">
     FAQ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../package-overview.html">
     Ray Cluster Management API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fcluster/kubernetes/user-guides/gpu.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/cluster/kubernetes/user-guides/gpu.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/cluster/kubernetes/user-guides/gpu.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#ml-training-with-gpus-on-kubernetes">
   ML training with GPUs on Kubernetes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#dependencies-for-gpu-based-machine-learning">
   Dependencies for GPU-based machine learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#configuring-ray-pods-for-gpu-usage">
   Configuring Ray pods for GPU usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#gpus-and-ray">
   GPUs and Ray
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#gpu-workload-scheduling">
     GPU workload scheduling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#gpu-autoscaling">
     GPU autoscaling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#requesting-gpus">
     Requesting GPUs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#overriding-ray-gpu-capacity-advanced">
     Overriding Ray GPU capacity (advanced)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#gpu-pod-scheduling-advanced">
   GPU pod scheduling (advanced)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#gpu-taints-and-tolerations">
     GPU taints and tolerations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#node-selectors-and-node-labels">
     Node selectors and node labels
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="gpu.html#further-reference-and-discussion">
       Further reference and discussion
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using GPUs</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#ml-training-with-gpus-on-kubernetes">
   ML training with GPUs on Kubernetes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#dependencies-for-gpu-based-machine-learning">
   Dependencies for GPU-based machine learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#configuring-ray-pods-for-gpu-usage">
   Configuring Ray pods for GPU usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#gpus-and-ray">
   GPUs and Ray
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#gpu-workload-scheduling">
     GPU workload scheduling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#gpu-autoscaling">
     GPU autoscaling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#requesting-gpus">
     Requesting GPUs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#overriding-ray-gpu-capacity-advanced">
     Overriding Ray GPU capacity (advanced)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="gpu.html#gpu-pod-scheduling-advanced">
   GPU pod scheduling (advanced)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#gpu-taints-and-tolerations">
     GPU taints and tolerations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="gpu.html#node-selectors-and-node-labels">
     Node selectors and node labels
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="gpu.html#further-reference-and-discussion">
       Further reference and discussion
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="using-gpus">
<span id="kuberay-gpu"></span><h1>Using GPUs<a class="headerlink" href="gpu.html#using-gpus" title="Permalink to this headline">#</a></h1>
<p>This document provides tips on GPU usage with Ray on Kubernetes.</p>
<p>To use GPUs on Kubernetes, you will need to configure both your Kubernetes setup and add additional values to your Ray cluster configuration.</p>
<p>To learn about GPU usage on different clouds, see instructions for <a class="reference external" href="https://cloud.google.com/kubernetes-engine/docs/how-to/gpus">GKE</a>, for <a class="reference external" href="https://docs.aws.amazon.com/eks/latest/userguide/eks-optimized-ami.html">EKS</a>, and for <a class="reference external" href="https://docs.microsoft.com/en-us/azure/aks/gpu-cluster">AKS</a>.</p>
<section id="ml-training-with-gpus-on-kubernetes">
<h2>ML training with GPUs on Kubernetes<a class="headerlink" href="gpu.html#ml-training-with-gpus-on-kubernetes" title="Permalink to this headline">#</a></h2>
<p>See <a class="reference internal" href="../examples/gpu-training-example.html#kuberay-gpu-training-example"><span class="std std-ref">GPU training example</span></a> for a complete example of training a PyTorch model on a GPU with Ray on Kubernetes.</p>
</section>
<section id="dependencies-for-gpu-based-machine-learning">
<h2>Dependencies for GPU-based machine learning<a class="headerlink" href="gpu.html#dependencies-for-gpu-based-machine-learning" title="Permalink to this headline">#</a></h2>
<p>The <a class="reference external" href="https://hub.docker.com/r/rayproject/">Ray Docker Hub</a> hosts CUDA-based container images packaged
with Ray and certain machine learning libraries.
For example, the image <code class="docutils literal notranslate"><span class="pre">rayproject/ray-ml:2.0.0-gpu</span></code> is ideal for running GPU-based ML workloads with Ray 2.0.0.
The Ray ML images are packaged with dependencies (such as TensorFlow and PyTorch) needed to use the <a class="reference internal" href="../../../ray-air/getting-started.html#air"><span class="std std-ref">Ray AI Runtime</span></a>
and the Ray Libraries covered in these docs.
To add custom dependencies, we recommend one, or both, of the following methods:</p>
<ul class="simple">
<li><p>Building a docker image using one of the official <a class="reference internal" href="../../../ray-more-libs/installation.html#docker-images"><span class="std std-ref">Ray docker images</span></a> as base.</p></li>
<li><p>Using <a class="reference internal" href="../../../ray-core/handling-dependencies.html#runtime-environments"><span class="std std-ref">Ray Runtime environments</span></a>.</p></li>
</ul>
</section>
<section id="configuring-ray-pods-for-gpu-usage">
<h2>Configuring Ray pods for GPU usage<a class="headerlink" href="gpu.html#configuring-ray-pods-for-gpu-usage" title="Permalink to this headline">#</a></h2>
<p>Using Nvidia GPUs requires specifying <code class="xref py py-obj docutils literal notranslate"><span class="pre">nvidia.com/gpu</span></code> resource <code class="xref py py-obj docutils literal notranslate"><span class="pre">limits</span></code> in the container fields of your <code class="xref py py-obj docutils literal notranslate"><span class="pre">RayCluster</span></code>’s
<code class="xref py py-obj docutils literal notranslate"><span class="pre">headGroupSpec</span></code> and/or <code class="xref py py-obj docutils literal notranslate"><span class="pre">workerGroupSpecs</span></code>.
(Kubernetes <a class="reference external" href="https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/#using-device-plugins">automatically sets</a>
the GPU request equal to the limit. However, you might want to specify requests for purposes of documentation.)</p>
<p>Here is a config snippet for a RayCluster workerGroup of up
to 5 GPU workers.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">groupName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpu-group</span><span class="w"></span>
<span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>
<span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>
<span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"></span>
<span class="nn">...</span><span class="w"></span>
<span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ray-node</span><span class="w"></span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayproject/ray-ml:2.0.0-gpu</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">         </span><span class="nt">nvidia.com/gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Optional, included just for documentation.</span><span class="w"></span>
<span class="w">         </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">         </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Gi</span><span class="w"></span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"></span>
<span class="w">         </span><span class="nt">nvidia.com/gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Required to use GPU.</span><span class="w"></span>
<span class="w">         </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">         </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Gi</span><span class="w"></span>
<span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
</pre></div>
</div>
<p>Each of the Ray pods in the group can be scheduled on an AWS <code class="xref py py-obj docutils literal notranslate"><span class="pre">p2.xlarge</span></code> instance (1 GPU, 4vCPU, 61Gi RAM).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>GPU instances are expensive – consider setting up autoscaling for your GPU Ray workers,
as demonstrated with the <code class="xref py py-obj docutils literal notranslate"><span class="pre">minReplicas:0</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">maxReplicas:5</span></code> settings above.
To enable autoscaling, remember also to set <code class="xref py py-obj docutils literal notranslate"><span class="pre">enableInTreeAutoscaling:True</span></code> in your RayCluster’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">spec</span></code>
Finally, make sure your group or pool of GPU Kubernetes nodes are configured to autoscale.
Refer to your <a class="reference internal" href="k8s-cluster-setup.html#kuberay-k8s-setup"><span class="std std-ref">cloud provider’s documentation</span></a> for details on autoscaling node pools.</p>
</div>
</section>
<section id="gpus-and-ray">
<h2>GPUs and Ray<a class="headerlink" href="gpu.html#gpus-and-ray" title="Permalink to this headline">#</a></h2>
<p>This section discuss GPU usage for Ray applications running on Kubernetes.
For general guidance on GPU usage with Ray, see also <a class="reference internal" href="../../../ray-core/tasks/using-ray-with-gpus.html#gpu-support"><span class="std std-ref">GPU Support</span></a>.</p>
<p>The KubeRay operator advertises container GPU resource limits to
the Ray scheduler and the Ray autoscaler. In particular, the Ray container’s
<code class="xref py py-obj docutils literal notranslate"><span class="pre">ray</span> <span class="pre">start</span></code> entrypoint will be automatically configured with the appropriate <code class="xref py py-obj docutils literal notranslate"><span class="pre">--num-gpus</span></code> option.</p>
<section id="gpu-workload-scheduling">
<h3>GPU workload scheduling<a class="headerlink" href="gpu.html#gpu-workload-scheduling" title="Permalink to this headline">#</a></h3>
<p>After a Ray pod with access to GPU is deployed, it will
be able to execute tasks and actors annotated with gpu requests.
For example, the decorator <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;ray.remote(num_gpus=1)</span></code> annotates a task or actor
requiring 1 GPU.</p>
</section>
<section id="gpu-autoscaling">
<h3>GPU autoscaling<a class="headerlink" href="gpu.html#gpu-autoscaling" title="Permalink to this headline">#</a></h3>
<p>The Ray autoscaler is aware of each Ray worker group’s GPU capacity.
Say we have a RayCluster configured as in the config snippet above:</p>
<ul class="simple">
<li><p>There is a worker group of Ray pods with 1 unit of GPU capacity each.</p></li>
<li><p>The Ray cluster does not currently have any workers from that group.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">maxReplicas</span></code> for the group is at least 2.</p></li>
</ul>
<p>Then the following Ray program will trigger upscaling of 2 GPU workers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>

<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GPUActor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I live in a pod with GPU access.&quot;</span><span class="p">)</span>

<span class="c1"># Request actor placement.</span>
<span class="n">gpu_actors</span> <span class="o">=</span> <span class="p">[</span><span class="n">GPUActor</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<span class="c1"># The following command will block until two Ray pods with GPU access are scaled</span>
<span class="c1"># up and the actors are placed.</span>
<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">actor</span><span class="o">.</span><span class="n">say_hello</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span> <span class="k">for</span> <span class="n">actor</span> <span class="ow">in</span> <span class="n">gpu_actors</span><span class="p">])</span>
</pre></div>
</div>
<p>After the program exits, the actors will be garbage collected.
The GPU worker pods will be scaled down after the idle timeout (60 seconds by default).
If the GPU worker pods were running on an autoscaling pool of Kubernetes nodes, the Kubernetes
nodes will be scaled down as well.</p>
</section>
<section id="requesting-gpus">
<h3>Requesting GPUs<a class="headerlink" href="gpu.html#requesting-gpus" title="Permalink to this headline">#</a></h3>
<p>You can also make a <a class="reference internal" href="../../running-applications/autoscaling/reference.html#ref-autoscaler-sdk-request-resources"><span class="std std-ref">direct request to the autoscaler</span></a> to scale up GPU resources.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>

<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">ray</span><span class="o">.</span><span class="n">autoscaler</span><span class="o">.</span><span class="n">sdk</span><span class="o">.</span><span class="n">request_resources</span><span class="p">(</span><span class="n">bundles</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>After the nodes are scaled up, they will persist until the request is explicitly overridden.
The following program will remove the resource request.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>

<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">ray</span><span class="o">.</span><span class="n">autoscaler</span><span class="o">.</span><span class="n">sdk</span><span class="o">.</span><span class="n">request_resources</span><span class="p">(</span><span class="n">bundles</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
<p>The GPU workers can then scale down.</p>
</section>
<section id="overriding-ray-gpu-capacity-advanced">
<span id="kuberay-gpu-override"></span><h3>Overriding Ray GPU capacity (advanced)<a class="headerlink" href="gpu.html#overriding-ray-gpu-capacity-advanced" title="Permalink to this headline">#</a></h3>
<p>For specialized use-cases, it is possible to override the Ray pod GPU capacities advertised to Ray.
To do so, set a value for the <code class="xref py py-obj docutils literal notranslate"><span class="pre">num-gpus</span></code> key of the head or worker group’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">rayStartParams</span></code>.
For example,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">rayStartParams</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Note that all rayStartParam values must be supplied as strings.</span><span class="w"></span>
<span class="w">    </span><span class="nt">num-gpus</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>The Ray scheduler and autoscaler will then account 2 units of GPU capacity for each
Ray pod in the group, even if the container limits do not indicate the presence of GPU.</p>
</section>
</section>
<section id="gpu-pod-scheduling-advanced">
<h2>GPU pod scheduling (advanced)<a class="headerlink" href="gpu.html#gpu-pod-scheduling-advanced" title="Permalink to this headline">#</a></h2>
<section id="gpu-taints-and-tolerations">
<h3>GPU taints and tolerations<a class="headerlink" href="gpu.html#gpu-taints-and-tolerations" title="Permalink to this headline">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Managed Kubernetes services typically take care of GPU-related taints and tolerations
for you. If you are using a managed Kubernetes service, you might not need to worry
about this section.</p>
</div>
<p>The <a class="reference external" href="https://github.com/NVIDIA/k8s-device-plugin">Nvidia gpu plugin</a> for Kubernetes applies <a class="reference external" href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">taints</a> to GPU nodes; these taints prevent non-GPU pods from being scheduled on GPU nodes.
Managed Kubernetes services like GKE, EKS, and AKS automatically apply matching <a class="reference external" href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">tolerations</a>
to pods requesting GPU resources. Tolerations are applied by means of Kubernetes’s <a class="reference external" href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#extendedresourcetoleration">ExtendedResourceToleration</a> <a class="reference external" href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/">admission controller</a>.
If this admission controller is not enabled for your Kubernetes cluster, you may need to manually add a GPU toleration each of to your GPU pod configurations. For example,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="nt">generateName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-cluster-ray-worker</span><span class="w"></span>
<span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w"> </span><span class="nt">tolerations</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span><span class="w"></span>
<span class="w">   </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nvidia.com/gpu</span><span class="w"></span>
<span class="w">   </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span><span class="w"></span>
<span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w"> </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ray-node</span><span class="w"></span>
<span class="w">   </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayproject/ray:nightly-gpu</span><span class="w"></span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="node-selectors-and-node-labels">
<h3>Node selectors and node labels<a class="headerlink" href="gpu.html#node-selectors-and-node-labels" title="Permalink to this headline">#</a></h3>
<p>To ensure Ray pods are bound to Kubernetes nodes satisfying specific
conditions (such as the presence of GPU hardware), you may wish to use
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">nodeSelector</span></code> field of your <code class="xref py py-obj docutils literal notranslate"><span class="pre">workerGroup</span></code>’s pod template <code class="xref py py-obj docutils literal notranslate"><span class="pre">spec</span></code>.
See the <a class="reference external" href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/">Kubernetes docs</a> for more about Pod-to-Node assignment.</p>
<section id="further-reference-and-discussion">
<h4>Further reference and discussion<a class="headerlink" href="gpu.html#further-reference-and-discussion" title="Permalink to this headline">#</a></h4>
<p>Read about Kubernetes device plugins <a class="reference external" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/">here</a>,
about Kubernetes GPU plugins <a class="reference external" href="https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus">here</a>,
and about Nvidia’s GPU plugin for Kubernetes <a class="reference external" href="https://github.com/NVIDIA/k8s-device-plugin">here</a>.</p>
</section>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="logging.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Log Persistence</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="experimental.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Experimental Features</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>