
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>KubeRay Autoscaling &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/js/docsearch.js"></script>
    <script src="../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../_static/js/top-navigation.js"></script>
    <script src="../../../_static/js/tags.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/cluster/kubernetes/user-guides/configuring-autoscaling.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Log Persistence" href="logging.html" />
    <link rel="prev" title="RayCluster Configuration" href="config.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "cluster/kubernetes/user-guides/configuring-autoscaling", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".md", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Deploying on Kubernetes
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started.html">
       Getting Started
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="../user-guides.html">
       User Guides
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4">
        <a class="reference internal" href="k8s-cluster-setup.html">
         Managed Kubernetes services
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="config.html">
         RayCluster Configuration
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="configuring-autoscaling.html#">
         KubeRay Autoscaling
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="logging.html">
         Log Persistence
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="gpu.html">
         Using GPUs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="experimental.html">
         Experimental Features
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="static-ray-cluster-without-kuberay.html">
         (Advanced) Deploying a static Ray cluster without KubeRay
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../examples.html">
       Examples
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../references.html">
       API Reference
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../vms/index.html">
     Deploying on VMs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../metrics.html">
     Collecting and monitoring metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../configure-manage-dashboard.html">
     Configuring and Managing Ray Dashboard
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../running-applications/index.html">
     Applications Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../faq.html">
     FAQ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../package-overview.html">
     Ray Cluster Management API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fcluster/kubernetes/user-guides/configuring-autoscaling.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/cluster/kubernetes/user-guides/configuring-autoscaling.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/cluster/kubernetes/user-guides/configuring-autoscaling.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#quickstart">
   Quickstart
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#kuberay-config-parameters">
   KubeRay Config Parameters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#upscaling-and-downscaling-speed">
     Upscaling and downscaling speed
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#configuring-the-autoscaler-sidecar-container">
     Configuring the autoscaler sidecar container
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#understanding-the-ray-autoscaler-in-the-context-of-kubernetes">
   Understanding the Ray Autoscaler in the Context of Kubernetes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#ray-autoscaler-vs-horizontal-pod-autoscaler">
     Ray Autoscaler vs. Horizontal Pod Autoscaler
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="configuring-autoscaling.html#load-metrics-are-based-on-application-semantics">
       Load metrics are based on application semantics
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="configuring-autoscaling.html#fine-grained-control-of-scale-down">
       Fine-grained control of scale-down
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="configuring-autoscaling.html#architecture-one-ray-autoscaler-per-ray-cluster">
       Architecture: One Ray Autoscaler per Ray Cluster.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#ray-autoscaler-with-kubernetes-cluster-autoscaler">
     Ray Autoscaler with Kubernetes Cluster Autoscaler
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#vertical-pod-autoscaler">
     Vertical Pod Autoscaler
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>KubeRay Autoscaling</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#quickstart">
   Quickstart
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#kuberay-config-parameters">
   KubeRay Config Parameters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#upscaling-and-downscaling-speed">
     Upscaling and downscaling speed
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#configuring-the-autoscaler-sidecar-container">
     Configuring the autoscaler sidecar container
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="configuring-autoscaling.html#understanding-the-ray-autoscaler-in-the-context-of-kubernetes">
   Understanding the Ray Autoscaler in the Context of Kubernetes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#ray-autoscaler-vs-horizontal-pod-autoscaler">
     Ray Autoscaler vs. Horizontal Pod Autoscaler
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="configuring-autoscaling.html#load-metrics-are-based-on-application-semantics">
       Load metrics are based on application semantics
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="configuring-autoscaling.html#fine-grained-control-of-scale-down">
       Fine-grained control of scale-down
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="configuring-autoscaling.html#architecture-one-ray-autoscaler-per-ray-cluster">
       Architecture: One Ray Autoscaler per Ray Cluster.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#ray-autoscaler-with-kubernetes-cluster-autoscaler">
     Ray Autoscaler with Kubernetes Cluster Autoscaler
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="configuring-autoscaling.html#vertical-pod-autoscaler">
     Vertical Pod Autoscaler
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="kuberay-autoscaling">
<span id="id1"></span><h1>KubeRay Autoscaling<a class="headerlink" href="configuring-autoscaling.html#kuberay-autoscaling" title="Permalink to this headline">#</a></h1>
<p>This guide explains how to configure the Ray autoscaler on Kubernetes.
The Ray autoscaler is a Ray cluster process that automatically scales a cluster up and down based on resource demand.
The autoscaler does this by adjusting the number of nodes (Ray pods) in the cluster based on the resources required by tasks, actors or placement groups.</p>
<p>Note that the autoscaler only considers logical resource requests for scaling (i.e., those specified in <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote</span></code> and displayed in <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code>), not physical machine utilization. If a user tries to launch an actor, task, or placement group but there are insufficient resources, the request will be queued. The autoscaler adds nodes to satisfy resource demands in this queue.
The autoscaler also removes nodes after they become idle for some time.
A node is considered idle if it has no active tasks, actors, or objects.</p>
<!-- TODO(ekl): probably should change the default kuberay examples to not use autoscaling -->
<div class="admonition-when-to-use-autoscaling admonition">
<p class="admonition-title">When to use Autoscaling?</p>
<p>Autoscaling can reduce workload costs, but adds node launch overheads and can be tricky to configure.
We recommend starting with non-autoscaling clusters if you’re new to Ray.</p>
</div>
<section id="overview">
<h2>Overview<a class="headerlink" href="configuring-autoscaling.html#overview" title="Permalink to this headline">#</a></h2>
<p>The following diagram illustrates the integration of the Ray Autoscaler
with the KubeRay operator.</p>
<img alt="../../../_images/AutoscalerOperator.svg" class="align-center" src="../../../_images/AutoscalerOperator.svg" /><p>Worker pod upscaling occurs through the following sequence of events:</p>
<ol class="simple">
<li><p>The user submits a Ray workload.</p></li>
<li><p>Workload resource requirements are aggregated by the Ray head container
and communicated to the Ray autoscaler sidecar.</p></li>
<li><p>The autoscaler determines that a Ray worker pod must be added to satisfy the workload’s resource requirement.</p></li>
<li><p>The autoscaler requests an additional worker pod by incrementing the RayCluster CR’s <code class="docutils literal notranslate"><span class="pre">replicas</span></code> field.</p></li>
<li><p>The KubeRay operator creates a Ray worker pod to match the new <code class="docutils literal notranslate"><span class="pre">replicas</span></code> specification.</p></li>
<li><p>The Ray scheduler places the user’s workload on the new worker pod.</p></li>
</ol>
<p>See also the operator architecture diagram in the <a class="reference external" href="https://ray-project.github.io/kuberay/guidance/autoscaler/">KubeRay documentation</a>.</p>
</section>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="configuring-autoscaling.html#quickstart" title="Permalink to this headline">#</a></h2>
<p>First, follow the <a class="reference internal" href="../getting-started.html#kuberay-quickstart"><span class="std std-ref">KubeRay quickstart guide</span></a> to:</p>
<ul class="simple">
<li><p>Install <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> and <code class="docutils literal notranslate"><span class="pre">Helm</span></code></p></li>
<li><p>Prepare a Kubernetes cluster</p></li>
<li><p>Deploy a KubeRay operator</p></li>
</ul>
<p>Next, create an autoscaling RayCluster custom resource.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an autoscaling RayCluster custom resource.</span>
kubectl apply -f https://raw.githubusercontent.com/ray-project/kuberay/release-0.5/ray-operator/config/samples/ray-cluster.autoscaler.yaml
</pre></div>
</div>
<p>Now, we can run a Ray program on the head pod that uses <a class="reference internal" href="../../running-applications/autoscaling/reference.html#ref-autoscaler-sdk"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">request_resources</span></code></span></a> to scale the cluster to a total of 3 CPUs. The head and worker pods in our <a class="reference external" href="https://github.com/ray-project/kuberay/blob/master/ray-operator/config/samples/ray-cluster.autoscaler.yaml">example cluster config</a> each have a capacity of 1 CPU, and we specified a minimum of 1 worker pod. Thus, the request should trigger upscaling of one additional worker pod.</p>
<p>Note that in real-life scenarios, you will want to use larger Ray pods. In fact, it is advantageous to size each Ray pod to take up an entire Kubernetes node. See the <a class="reference internal" href="config.html#kuberay-config"><span class="std std-ref">configuration guide</span></a> for more details.</p>
<p>To run the Ray program, we will first get the name of the Ray head pod:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trigger Ray Pod upscaling</span>
<span class="nb">export</span> <span class="nv">HEAD_POD</span><span class="o">=</span><span class="k">$(</span>kubectl get pods --selector<span class="o">=</span>ray.io/node-type<span class="o">=</span>head -o custom-columns<span class="o">=</span>POD:metadata.name --no-headers<span class="k">)</span>
kubectl <span class="nb">exec</span> <span class="nv">$HEAD_POD</span> -it -c ray-head -- python -c <span class="s2">&quot;import ray; ray.init(); ray.autoscaler.sdk.request_resources(num_cpus=4)&quot;</span>
</pre></div>
</div>
<p>The last command should trigger the upscaling of the Ray pod by requesting 4 CPUs. Initially, there is one head Pod and one worker Pod, each with 1 CPU. Next, the autoscaler will create two new worker Pods to utilize the remaining 2 CPUs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl get pod --selector<span class="o">=</span>ray.io/cluster<span class="o">=</span>raycluster-autoscaler
<span class="c1"># NAME                                             READY   STATUS    RESTARTS   AGE</span>
<span class="c1"># raycluster-autoscaler-head-pnb77                 2/2     Running   0          XXs</span>
<span class="c1"># raycluster-autoscaler-worker-small-group-ng2p5   1/1     Running   0          XXs</span>
<span class="c1"># raycluster-autoscaler-worker-small-group-s7pv6   1/1     Running   0          XXs</span>
<span class="c1"># raycluster-autoscaler-worker-small-group-tb6d9   1/1     Running   0          XXs</span>
</pre></div>
</div>
<p>To get a summary of your cluster’s status, run <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code> on your cluster’s Ray head node.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl <span class="nb">exec</span> <span class="nv">$HEAD_POD</span> -it -c ray-head -- ray status
<span class="c1"># ======== Autoscaler status: 2023-04-07 xxxxxxxxxx ========</span>
<span class="c1"># ....</span>
</pre></div>
</div>
<p>Alternatively, to examine the full autoscaling logs, fetch the stdout of the Ray head pod’s autoscaler sidecar:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This command gets the last 20 lines of autoscaler logs.</span>
kubectl logs <span class="nv">$HEAD_POD</span> -c autoscaler <span class="p">|</span> tail -n <span class="m">20</span>
<span class="c1"># ======== Autoscaler status: 2023-04-07 xxxxxxxxxx ========</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</section>
<section id="kuberay-config-parameters">
<span id="kuberay-autoscaling-config"></span><h2>KubeRay Config Parameters<a class="headerlink" href="configuring-autoscaling.html#kuberay-config-parameters" title="Permalink to this headline">#</a></h2>
<p>There are two steps to enabling Ray autoscaling in the KubeRay <code class="docutils literal notranslate"><span class="pre">RayCluster</span></code> custom resource (CR) config:</p>
<ol class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">enableInTreeAutoscaling:true</span></code>. The KubeRay operator will then automatically configure an autoscaling sidecar container
for the Ray head pod. The autoscaler container collects resource metrics from the Ray cluster
and automatically adjusts the <code class="docutils literal notranslate"><span class="pre">replicas</span></code> field of each <code class="docutils literal notranslate"><span class="pre">workerGroupSpec</span></code> as needed to fulfill
the requirements of your Ray application.</p></li>
<li><p>Set the fields <code class="docutils literal notranslate"><span class="pre">minReplicas</span></code> and <code class="docutils literal notranslate"><span class="pre">maxReplicas</span></code> to constrain the number of <code class="docutils literal notranslate"><span class="pre">replicas</span></code> of an autoscaling
<code class="docutils literal notranslate"><span class="pre">workerGroup</span></code>. When deploying an autoscaling cluster, one typically sets <code class="docutils literal notranslate"><span class="pre">replicas</span></code> and <code class="docutils literal notranslate"><span class="pre">minReplicas</span></code>
to the same value.
The Ray autoscaler will then take over and modify the <code class="docutils literal notranslate"><span class="pre">replicas</span></code> field as pods are added to or removed from the cluster.</p></li>
</ol>
<p>For an example, check out the <a class="reference external" href="https://github.com/ray-project/kuberay/blob/master/ray-operator/config/samples/ray-cluster.autoscaler.yaml">config file</a> that we used in the above quickstart guide.</p>
<section id="upscaling-and-downscaling-speed">
<h3>Upscaling and downscaling speed<a class="headerlink" href="configuring-autoscaling.html#upscaling-and-downscaling-speed" title="Permalink to this headline">#</a></h3>
<p>If needed, you can also control the rate at which nodes should be added to or removed from the cluster. For applications with many short-lived tasks, you may wish to adjust the upscaling and downscaling speed to be more conservative.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">RayCluster</span></code> CR’s <code class="docutils literal notranslate"><span class="pre">autoscalerOptions</span></code> field to do so. The <code class="docutils literal notranslate"><span class="pre">autoscalerOptions</span></code> field
carries the following subfields:</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">upscalingMode</span></code></strong>: This controls the rate of Ray pod upscaling. The valid values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Conservative</span></code>: Upscaling is rate-limited; the number of pending worker pods is at most the number
of worker pods connected to the Ray cluster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Default</span></code>: Upscaling is not rate-limited.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Aggressive</span></code>: An alias for Default; upscaling is not rate-limited.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">idleTimeoutSeconds</span></code></strong> (default 60s): This is the number of seconds to wait before scaling down an idle worker pod. Worker nodes are considered idle when they hold no active tasks, actors, or referenced objects (either in-memory or spilled to disk).</p>
</section>
<section id="configuring-the-autoscaler-sidecar-container">
<h3>Configuring the autoscaler sidecar container<a class="headerlink" href="configuring-autoscaling.html#configuring-the-autoscaler-sidecar-container" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">autoscalerOptions</span></code> field also provides options for configuring the autoscaler container. Usually, it is not necessary to specify these options.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">resources</span></code></strong>: The <code class="docutils literal notranslate"><span class="pre">resources</span></code> subfield of <code class="docutils literal notranslate"><span class="pre">autoscalerOptions</span></code> sets optional resource overrides
for the autoscaler sidecar container. These overrides
should be specified in the standard <a class="reference external" href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources">container resource
spec format</a>.
The default values are indicated below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resources</span><span class="p">:</span>
  <span class="n">limits</span><span class="p">:</span>
    <span class="n">cpu</span><span class="p">:</span> <span class="s2">&quot;500m&quot;</span>
    <span class="n">memory</span><span class="p">:</span> <span class="s2">&quot;512Mi&quot;</span>
  <span class="n">requests</span><span class="p">:</span>
    <span class="n">cpu</span><span class="p">:</span> <span class="s2">&quot;500m&quot;</span>
    <span class="n">memory</span><span class="p">:</span> <span class="s2">&quot;512Mi&quot;</span>
</pre></div>
</div>
<p>The following <code class="docutils literal notranslate"><span class="pre">autoscalerOptions</span></code> suboptions are also available for testing and development of the autoscaler itself.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">image</span></code></strong>: This field overrides the autoscaler container image.
If your <code class="docutils literal notranslate"><span class="pre">RayCluster</span></code>’s <code class="docutils literal notranslate"><span class="pre">spec.RayVersion</span></code> is at least <code class="docutils literal notranslate"><span class="pre">2.0.0</span></code>, the autoscaler will default to using
<strong>the same image</strong> as the Ray container. (Ray autoscaler code is bundled with the rest of Ray.)
For older Ray versions, the autoscaler will default to the image <code class="docutils literal notranslate"><span class="pre">rayproject/ray:2.0.0</span></code>.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">imagePullPolicy</span></code></strong>: This field overrides the autoscaler container’s
image pull policy. The default is <code class="docutils literal notranslate"><span class="pre">IfNotPresent</span></code>.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">env</span></code></strong> and <strong><code class="docutils literal notranslate"><span class="pre">envFrom</span></code></strong>: These fields specify autoscaler container
environment variables. These fields should be formatted following the
<a class="reference external" href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#environment-variables">Kubernetes API</a>
for container environment variables.</p>
</section>
</section>
<section id="understanding-the-ray-autoscaler-in-the-context-of-kubernetes">
<h2>Understanding the Ray Autoscaler in the Context of Kubernetes<a class="headerlink" href="configuring-autoscaling.html#understanding-the-ray-autoscaler-in-the-context-of-kubernetes" title="Permalink to this headline">#</a></h2>
<p>We describe the relationship between the Ray autoscaler and other autoscalers in the Kubernetes
ecosystem.</p>
<section id="ray-autoscaler-vs-horizontal-pod-autoscaler">
<h3>Ray Autoscaler vs. Horizontal Pod Autoscaler<a class="headerlink" href="configuring-autoscaling.html#ray-autoscaler-vs-horizontal-pod-autoscaler" title="Permalink to this headline">#</a></h3>
<p>The Ray autoscaler adjusts the number of Ray nodes in a Ray cluster.
On Kubernetes, each Ray node is run as a Kubernetes pod. Thus in the context of Kubernetes,
the Ray autoscaler scales Ray <strong>pod quantities</strong>. In this sense, the Ray autoscaler
plays a role similar to that of the Kubernetes
<a class="reference external" href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Pod Autoscaler</a> (HPA).
However, the following features distinguish the Ray Autoscaler from the HPA.</p>
<section id="load-metrics-are-based-on-application-semantics">
<h4>Load metrics are based on application semantics<a class="headerlink" href="configuring-autoscaling.html#load-metrics-are-based-on-application-semantics" title="Permalink to this headline">#</a></h4>
<p>The Horizontal Pod Autoscaler determines scale based on physical usage metrics like CPU
and memory. By contrast, the Ray autoscaler uses the logical resources expressed in
task and actor annotations. For instance, if each Ray container spec in your RayCluster CR indicates
a limit of 10 CPUs, and you submit twenty tasks annotated with <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote(num_cpus=5)</span></code>,
10 Ray pods will be created to satisfy the 100-CPU resource demand.
In this respect, the Ray autoscaler is similar to the
<a class="reference external" href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">Kubernetes Cluster Autoscaler</a>,
which makes scaling decisions based on the logical resources expressed in container
resource requests.</p>
</section>
<section id="fine-grained-control-of-scale-down">
<h4>Fine-grained control of scale-down<a class="headerlink" href="configuring-autoscaling.html#fine-grained-control-of-scale-down" title="Permalink to this headline">#</a></h4>
<p>To accommodate the statefulness of Ray applications, the Ray autoscaler has more
fine-grained control over scale-down than the Horizontal Pod Autoscaler. In addition to
determining desired scale, the Ray Autoscaler is able to select precisely which pods
to scale down. The KubeRay operator then deletes that pod.
By contrast, the Horizontal Pod Autoscaler can only decrease a replica count, without much
control over which pods are deleted. For a Ray application, downscaling a random
pod could be dangerous.</p>
</section>
<section id="architecture-one-ray-autoscaler-per-ray-cluster">
<h4>Architecture: One Ray Autoscaler per Ray Cluster.<a class="headerlink" href="configuring-autoscaling.html#architecture-one-ray-autoscaler-per-ray-cluster" title="Permalink to this headline">#</a></h4>
<p>Horizontal Pod Autoscaling is centrally controlled by a manager in the Kubernetes control plane;
the manager controls the scale of many Kubernetes objects.
By contrast, each Ray cluster is managed by its own Ray autoscaler process,
running as a sidecar container in the Ray head pod. This design choice is motivated
by the following considerations:</p>
<ul class="simple">
<li><p><strong>Scalability.</strong> Autoscaling each Ray cluster requires processing a significant volume of resource
data from that Ray cluster.</p></li>
<li><p><strong>Simplified versioning and compatibility.</strong> The autoscaler and Ray are both developed
as part of the Ray repository. The interface between the autoscaler and the Ray core is complex.
To support multiple Ray clusters running at different Ray versions, it is thus best to match
Ray and Autoscaler code versions. Running one autoscaler per Ray cluster and matching the code versions
ensures compatibility.</p></li>
</ul>
</section>
</section>
<section id="ray-autoscaler-with-kubernetes-cluster-autoscaler">
<h3>Ray Autoscaler with Kubernetes Cluster Autoscaler<a class="headerlink" href="configuring-autoscaling.html#ray-autoscaler-with-kubernetes-cluster-autoscaler" title="Permalink to this headline">#</a></h3>
<p>The Ray Autoscaler and the
<a class="reference external" href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">Kubernetes Cluster Autoscaler</a>
complement each other.
After the Ray autoscaler decides to create a Ray pod, the Kubernetes Cluster Autoscaler
can provision a Kubernetes node so that the pod can be placed.
Similarly, after the Ray autoscaler decides to delete an idle pod, the Kubernetes
Cluster Autoscaler can clean up the idle Kubernetes node that remains.
It is recommended to configure your RayCluster so that only one Ray pod fits per Kubernetes node.
If you follow this pattern, Ray Autoscaler pod scaling events will correspond roughly one-to-one with cluster autoscaler
node scaling events. (We say “roughly” because it is possible for a Ray pod be deleted and replaced
with a new Ray pod before the underlying Kubernetes node is scaled down.)</p>
</section>
<section id="vertical-pod-autoscaler">
<h3>Vertical Pod Autoscaler<a class="headerlink" href="configuring-autoscaling.html#vertical-pod-autoscaler" title="Permalink to this headline">#</a></h3>
<p>There is no relationship between the Ray Autoscaler and the Kubernetes
<a class="reference external" href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler">Vertical Pod Autoscaler</a> (VPA),
which is meant to size individual pods to the appropriate size based on current and past usage.
If you find that the load on your individual Ray pods is too high, there are a number
of manual techniques to decrease the load
One method is to schedule fewer tasks/actors per node by increasing the resource
requirements specified in the <code class="docutils literal notranslate"><span class="pre">ray.remote</span></code> annotation.
For example, changing <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote(num_cpus=2)</span></code> to <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote(num_cpus=4)</span></code>
will halve the quantity of that task or actor that can fit in a given Ray pod.</p>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="config.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">RayCluster Configuration</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="logging.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Log Persistence</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>