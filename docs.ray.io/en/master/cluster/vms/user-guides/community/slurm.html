
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Deploying on Slurm &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/js/versionwarning.js"></script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../../_static/js/docsearch.js"></script>
    <script src="../../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../../_static/js/top-navigation.js"></script>
    <script src="../../../../_static/js/tags.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/cluster/vms/user-guides/community/slurm.html" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Deploying on LSF" href="lsf.html" />
    <link rel="prev" title="Deploying on YARN" href="yarn.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "cluster/vms/user-guides/community/slurm", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../kubernetes/index.html">
     Deploying on Kubernetes
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../../index.html">
     Deploying on VMs
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../../getting-started.html">
       Getting Started
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="../index.html">
       User Guides
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4">
        <a class="reference internal" href="../launching-clusters/index.html">
         Launching Ray Clusters on AWS, GCP, Azure, On-Prem
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../large-cluster-best-practices.html">
         Best practices for deploying large clusters
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../configuring-autoscaling.html">
         Configuring Autoscaling
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../logging.html">
         Log Persistence
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="reference internal" href="index.html">
         Community Supported Cluster Managers
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../examples/index.html">
       Examples
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../references/index.html">
       API References
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../metrics.html">
     Collecting and monitoring metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../configure-manage-dashboard.html">
     Configuring and Managing Ray Dashboard
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../running-applications/index.html">
     Applications Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../faq.html">
     FAQ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../package-overview.html">
     Ray Cluster Management API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fcluster/vms/user-guides/community/slurm.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/cluster/vms/user-guides/community/slurm.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../../_sources/cluster/vms/user-guides/community/slurm.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="slurm.html#walkthrough-using-ray-with-slurm">
   Walkthrough using Ray with SLURM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#sbatch-directives">
     sbatch directives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#loading-your-environment">
     Loading your environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#obtain-the-head-ip-address">
     Obtain the head IP address
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#starting-the-ray-head-node">
     Starting the Ray head node
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#starting-the-ray-worker-nodes">
     Starting the Ray worker nodes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#submitting-your-script">
     Submitting your script
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#slurm-networking-caveats">
     SLURM networking caveats
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="slurm.html#python-interface-slurm-scripts">
   Python-interface SLURM scripts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#usage-example">
     Usage example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#implementation">
     Implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="slurm.html#examples-and-templates">
   Examples and templates
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Deploying on Slurm</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="slurm.html#walkthrough-using-ray-with-slurm">
   Walkthrough using Ray with SLURM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#sbatch-directives">
     sbatch directives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#loading-your-environment">
     Loading your environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#obtain-the-head-ip-address">
     Obtain the head IP address
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#starting-the-ray-head-node">
     Starting the Ray head node
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#starting-the-ray-worker-nodes">
     Starting the Ray worker nodes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#submitting-your-script">
     Submitting your script
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#slurm-networking-caveats">
     SLURM networking caveats
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="slurm.html#python-interface-slurm-scripts">
   Python-interface SLURM scripts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#usage-example">
     Usage example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="slurm.html#implementation">
     Implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="slurm.html#examples-and-templates">
   Examples and templates
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="deploying-on-slurm">
<span id="ray-slurm-deploy"></span><h1>Deploying on Slurm<a class="headerlink" href="slurm.html#deploying-on-slurm" title="Permalink to this headline">#</a></h1>
<p>Slurm usage with Ray can be a little bit unintuitive.</p>
<ul class="simple">
<li><p>SLURM requires multiple copies of the same program are submitted multiple times to the same cluster to do cluster programming. This is particularly well-suited for MPI-based workloads.</p></li>
<li><p>Ray, on the other hand, expects a head-worker architecture with a single point of entry. That is, you’ll need to start a Ray head node, multiple Ray worker nodes, and run your Ray script on the head node.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SLURM support is still a work in progress. SLURM users should be aware
of current limitations regarding networking.
See <a class="reference internal" href="slurm.html#slurm-network-ray"><span class="std std-ref">here</span></a> for more explanations.</p>
<p>SLURM support is community-maintained. Maintainer GitHub handle: tupui.</p>
</div>
<p>This document aims to clarify how to run Ray on SLURM.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="slurm.html#walkthrough-using-ray-with-slurm" id="id1">Walkthrough using Ray with SLURM</a></p>
<ul>
<li><p><a class="reference internal" href="slurm.html#sbatch-directives" id="id2">sbatch directives</a></p></li>
<li><p><a class="reference internal" href="slurm.html#loading-your-environment" id="id3">Loading your environment</a></p></li>
<li><p><a class="reference internal" href="slurm.html#obtain-the-head-ip-address" id="id4">Obtain the head IP address</a></p></li>
<li><p><a class="reference internal" href="slurm.html#starting-the-ray-head-node" id="id5">Starting the Ray head node</a></p></li>
<li><p><a class="reference internal" href="slurm.html#starting-the-ray-worker-nodes" id="id6">Starting the Ray worker nodes</a></p></li>
<li><p><a class="reference internal" href="slurm.html#submitting-your-script" id="id7">Submitting your script</a></p></li>
<li><p><a class="reference internal" href="slurm.html#slurm-networking-caveats" id="id8">SLURM networking caveats</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="slurm.html#python-interface-slurm-scripts" id="id9">Python-interface SLURM scripts</a></p>
<ul>
<li><p><a class="reference internal" href="slurm.html#usage-example" id="id10">Usage example</a></p></li>
<li><p><a class="reference internal" href="slurm.html#implementation" id="id11">Implementation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="slurm.html#examples-and-templates" id="id12">Examples and templates</a></p></li>
</ul>
</div>
<section id="walkthrough-using-ray-with-slurm">
<h2><a class="toc-backref" href="slurm.html#id1">Walkthrough using Ray with SLURM</a><a class="headerlink" href="slurm.html#walkthrough-using-ray-with-slurm" title="Permalink to this headline">#</a></h2>
<p>Many SLURM deployments require you to interact with slurm via <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>, which executes a batch script on SLURM.</p>
<p>To run a Ray job with <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>, you will want to start a Ray cluster in the sbatch job with multiple <code class="docutils literal notranslate"><span class="pre">srun</span></code> commands (tasks), and then execute your python script that uses Ray. Each task will run on a separate node and start/connect to a Ray runtime.</p>
<p>The below walkthrough will do the following:</p>
<ol class="arabic simple">
<li><p>Set the proper headers for the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> script.</p></li>
<li><p>Load the proper environment/modules.</p></li>
<li><p>Fetch a list of available computing nodes and their IP addresses.</p></li>
<li><p>Launch a head ray process in one of the node (called the head node).</p></li>
<li><p>Launch Ray processes in (n-1) worker nodes and connects them to the head node by providing the head node address.</p></li>
<li><p>After the underlying ray cluster is ready, submit the user specified task.</p></li>
</ol>
<p>See <a class="reference internal" href="slurm-basic.html#slurm-basic"><span class="std std-ref">slurm-basic.sh</span></a> for an end-to-end example.</p>
<section id="sbatch-directives">
<span id="ray-slurm-headers"></span><h3><a class="toc-backref" href="slurm.html#id2">sbatch directives</a><a class="headerlink" href="slurm.html#sbatch-directives" title="Permalink to this headline">#</a></h3>
<p>In your sbatch script, you’ll want to add <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">directives to provide context</a> for your job to SLURM.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --job-name=my-workload</span>
</pre></div>
</div>
<p>You’ll need to tell SLURM to allocate nodes specifically for Ray. Ray will then find and manage all resources on each node.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">### Modify this according to your Ray workload.</span>
<span class="c1">#SBATCH --nodes=4</span>
<span class="c1">#SBATCH --exclusive</span>
</pre></div>
</div>
<p>Important: To ensure that each Ray worker runtime will run on a separate node, set <code class="docutils literal notranslate"><span class="pre">tasks-per-node</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --tasks-per-node=1</span>
</pre></div>
</div>
<p>Since we’ve set <code class="xref py py-obj docutils literal notranslate"><span class="pre">tasks-per-node</span> <span class="pre">=</span> <span class="pre">1</span></code>, this will be used to guarantee that each Ray worker runtime will obtain the
proper resources. In this example, we ask for at least 5 CPUs and 5 GB of memory per node.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">### Modify this according to your Ray workload.</span>
<span class="c1">#SBATCH --cpus-per-task=5</span>
<span class="c1">#SBATCH --mem-per-cpu=1GB</span>
<span class="c1">### Similarly, you can also specify the number of GPUs per node.</span>
<span class="c1">### Modify this according to your Ray workload. Sometimes this</span>
<span class="c1">### should be &#39;gres&#39; instead.</span>
<span class="c1">#SBATCH --gpus-per-task=1</span>
</pre></div>
</div>
<p>You can also add other optional flags to your sbatch directives.</p>
</section>
<section id="loading-your-environment">
<h3><a class="toc-backref" href="slurm.html#id3">Loading your environment</a><a class="headerlink" href="slurm.html#loading-your-environment" title="Permalink to this headline">#</a></h3>
<p>First, you’ll often want to Load modules or your own conda environment at the beginning of the script.</p>
<p>Note that this is an optional step, but it is often required for enabling the right set of dependencies.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: module load pytorch/v1.4.0-gpu</span>
<span class="c1"># Example: conda activate my-env</span>

conda activate my-env
</pre></div>
</div>
</section>
<section id="obtain-the-head-ip-address">
<h3><a class="toc-backref" href="slurm.html#id4">Obtain the head IP address</a><a class="headerlink" href="slurm.html#obtain-the-head-ip-address" title="Permalink to this headline">#</a></h3>
<p>Next, we’ll want to obtain a hostname and a node IP address for the head node. This way, when we start worker nodes, we’ll be able to properly connect to the right head node.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting the node names</span>
<span class="nv">nodes</span><span class="o">=</span><span class="k">$(</span>scontrol show hostnames <span class="s2">&quot;</span><span class="nv">$SLURM_JOB_NODELIST</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nv">nodes_array</span><span class="o">=(</span><span class="nv">$nodes</span><span class="o">)</span>

<span class="nv">head_node</span><span class="o">=</span><span class="si">${</span><span class="nv">nodes_array</span><span class="p">[0]</span><span class="si">}</span>
<span class="nv">head_node_ip</span><span class="o">=</span><span class="k">$(</span>srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks<span class="o">=</span><span class="m">1</span> -w <span class="s2">&quot;</span><span class="nv">$head_node</span><span class="s2">&quot;</span> hostname --ip-address<span class="k">)</span>

<span class="c1"># if we detect a space character in the head node IP, we&#39;ll</span>
<span class="c1"># convert it to an ipv4 address. This step is optional.</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$head_node_ip</span><span class="s2">&quot;</span> <span class="o">==</span> *<span class="s2">&quot; &quot;</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39; &#39;</span> <span class="nb">read</span> -ra ADDR <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;</span><span class="nv">$head_node_ip</span><span class="s2">&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="si">${#</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span> -gt <span class="m">16</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nv">head_node_ip</span><span class="o">=</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[1]</span><span class="si">}</span>
<span class="k">else</span>
  <span class="nv">head_node_ip</span><span class="o">=</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span>
<span class="k">fi</span>
<span class="nb">echo</span> <span class="s2">&quot;IPV6 address detected. We split the IPV4 address as </span><span class="nv">$head_node_ip</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
</section>
<section id="starting-the-ray-head-node">
<h3><a class="toc-backref" href="slurm.html#id5">Starting the Ray head node</a><a class="headerlink" href="slurm.html#starting-the-ray-head-node" title="Permalink to this headline">#</a></h3>
<p>After detecting the head node hostname and head node IP, we’ll want to create
a Ray head node runtime. We’ll do this by using <code class="docutils literal notranslate"><span class="pre">srun</span></code> as a background task
as a single task/node (recall that <code class="docutils literal notranslate"><span class="pre">tasks-per-node=1</span></code>).</p>
<p>Below, you’ll see that we explicitly specify the number of CPUs (<code class="docutils literal notranslate"><span class="pre">num-cpus</span></code>)
and number of GPUs (<code class="docutils literal notranslate"><span class="pre">num-gpus</span></code>) to Ray, as this will prevent Ray from using
more resources than allocated. We also need to explicitly
indicate the <code class="docutils literal notranslate"><span class="pre">node-ip-address</span></code> for the Ray head runtime:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">port</span><span class="o">=</span><span class="m">6379</span>
<span class="nv">ip_head</span><span class="o">=</span><span class="nv">$head_node_ip</span>:<span class="nv">$port</span>
<span class="nb">export</span> ip_head
<span class="nb">echo</span> <span class="s2">&quot;IP Head: </span><span class="nv">$ip_head</span><span class="s2">&quot;</span>

<span class="nb">echo</span> <span class="s2">&quot;Starting HEAD at </span><span class="nv">$head_node</span><span class="s2">&quot;</span>
srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks<span class="o">=</span><span class="m">1</span> -w <span class="s2">&quot;</span><span class="nv">$head_node</span><span class="s2">&quot;</span> <span class="se">\</span>
    ray start --head --node-ip-address<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$head_node_ip</span><span class="s2">&quot;</span> --port<span class="o">=</span><span class="nv">$port</span> <span class="se">\</span>
    --num-cpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --num-gpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_GPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --block <span class="p">&amp;</span>
</pre></div>
</div>
<p>By backgrounding the above srun task, we can proceed to start the Ray worker runtimes.</p>
</section>
<section id="starting-the-ray-worker-nodes">
<h3><a class="toc-backref" href="slurm.html#id6">Starting the Ray worker nodes</a><a class="headerlink" href="slurm.html#starting-the-ray-worker-nodes" title="Permalink to this headline">#</a></h3>
<p>Below, we do the same thing, but for each worker. Make sure the Ray head and Ray worker processes are not started on the same node.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># optional, though may be useful in certain versions of Ray &lt; 1.0.</span>
sleep <span class="m">10</span>

<span class="c1"># number of nodes other than the head node</span>
<span class="nv">worker_num</span><span class="o">=</span><span class="k">$((</span>SLURM_JOB_NUM_NODES <span class="o">-</span> <span class="m">1</span><span class="k">))</span>

<span class="k">for</span> <span class="o">((</span><span class="nv">i</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span> i &lt;<span class="o">=</span> worker_num<span class="p">;</span> i++<span class="o">))</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">node_i</span><span class="o">=</span><span class="si">${</span><span class="nv">nodes_array</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span>
    <span class="nb">echo</span> <span class="s2">&quot;Starting WORKER </span><span class="nv">$i</span><span class="s2"> at </span><span class="nv">$node_i</span><span class="s2">&quot;</span>
    srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks<span class="o">=</span><span class="m">1</span> -w <span class="s2">&quot;</span><span class="nv">$node_i</span><span class="s2">&quot;</span> <span class="se">\</span>
        ray start --address <span class="s2">&quot;</span><span class="nv">$ip_head</span><span class="s2">&quot;</span> <span class="se">\</span>
        --num-cpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --num-gpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_GPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --block <span class="p">&amp;</span>
    sleep <span class="m">5</span>
<span class="k">done</span>
</pre></div>
</div>
</section>
<section id="submitting-your-script">
<h3><a class="toc-backref" href="slurm.html#id7">Submitting your script</a><a class="headerlink" href="slurm.html#submitting-your-script" title="Permalink to this headline">#</a></h3>
<p>Finally, you can invoke your Python script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ray/doc/source/cluster/doc_code/simple-trainer.py</span>
python -u simple-trainer.py <span class="s2">&quot;</span><span class="nv">$SLURM_CPUS_PER_TASK</span><span class="s2">&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The -u argument tells python to print to stdout unbuffered, which is important with how slurm deals with rerouting output. If this argument is not included, you may get strange printing behavior such as printed statements not being logged by slurm until the program has terminated.</p>
</div>
</section>
<section id="slurm-networking-caveats">
<span id="slurm-network-ray"></span><h3><a class="toc-backref" href="slurm.html#id8">SLURM networking caveats</a><a class="headerlink" href="slurm.html#slurm-networking-caveats" title="Permalink to this headline">#</a></h3>
<p>There are two important networking aspects to keep in mind when working with
SLURM and Ray:</p>
<ol class="arabic simple">
<li><p>Ports binding.</p></li>
<li><p>IP binding.</p></li>
</ol>
<p>One common use of a SLURM cluster is to have multiple users running concurrent
jobs on the same infrastructure. This can easily conflict with Ray due to the
way the head node communicates with its workers.</p>
<p>Considering 2 users, if they both schedule a SLURM job using Ray
at the same time, they are both creating a head node. In the backend, Ray will
assign some internal ports to a few services. The issue is that as soon as the
first head node is created, it will bind some ports and prevent them to be
used by another head node. To prevent any conflicts, users have to manually
specify non overlapping ranges of ports. The following ports are to be
adjusted. For an explanation on ports, see <a class="reference internal" href="../../../../ray-core/configure.html#ray-ports"><span class="std std-ref">here</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># used for all ports</span>
<span class="o">--</span><span class="n">node</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">port</span>
<span class="o">--</span><span class="nb">object</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">port</span>
<span class="o">--</span><span class="nb">min</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">port</span>
<span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">port</span>
<span class="c1"># used for the head node</span>
<span class="o">--</span><span class="n">port</span>
<span class="o">--</span><span class="n">ray</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">port</span>
<span class="o">--</span><span class="n">redis</span><span class="o">-</span><span class="n">shard</span><span class="o">-</span><span class="n">ports</span>
</pre></div>
</div>
<p>For instance, again with 2 users, they would have to adapt the instructions
seen above to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># user 1</span>
<span class="c1"># same as above</span>
...
srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks<span class="o">=</span><span class="m">1</span> -w <span class="s2">&quot;</span><span class="nv">$head_node</span><span class="s2">&quot;</span> <span class="se">\</span>
    ray start --head --node-ip-address<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$head_node_ip</span><span class="s2">&quot;</span> <span class="se">\</span>
        --port<span class="o">=</span><span class="m">6379</span> <span class="se">\</span>
        --node-manager-port<span class="o">=</span><span class="m">6700</span> <span class="se">\</span>
        --object-manager-port<span class="o">=</span><span class="m">6701</span> <span class="se">\</span>
        --ray-client-server-port<span class="o">=</span><span class="m">10001</span> <span class="se">\</span>
        --redis-shard-ports<span class="o">=</span><span class="m">6702</span> <span class="se">\</span>
        --min-worker-port<span class="o">=</span><span class="m">10002</span> <span class="se">\</span>
        --max-worker-port<span class="o">=</span><span class="m">19999</span> <span class="se">\</span>
        --num-cpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --num-gpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_GPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --block <span class="p">&amp;</span>

<span class="c1"># user 2</span>
<span class="c1"># same as above</span>
...
srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks<span class="o">=</span><span class="m">1</span> -w <span class="s2">&quot;</span><span class="nv">$head_node</span><span class="s2">&quot;</span> <span class="se">\</span>
    ray start --head --node-ip-address<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$head_node_ip</span><span class="s2">&quot;</span> <span class="se">\</span>
        --port<span class="o">=</span><span class="m">6380</span> <span class="se">\</span>
        --node-manager-port<span class="o">=</span><span class="m">6800</span> <span class="se">\</span>
        --object-manager-port<span class="o">=</span><span class="m">6801</span> <span class="se">\</span>
        --ray-client-server-port<span class="o">=</span><span class="m">20001</span> <span class="se">\</span>
        --redis-shard-ports<span class="o">=</span><span class="m">6802</span> <span class="se">\</span>
        --min-worker-port<span class="o">=</span><span class="m">20002</span> <span class="se">\</span>
        --max-worker-port<span class="o">=</span><span class="m">29999</span> <span class="se">\</span>
        --num-cpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --num-gpus <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SLURM_GPUS_PER_TASK</span><span class="si">}</span><span class="s2">&quot;</span> --block <span class="p">&amp;</span>
</pre></div>
</div>
<p>As for the IP binding, on some cluster architecture the network interfaces
do not allow to use external IPs between nodes. Instead, there are internal
network interfaces (<code class="xref py py-obj docutils literal notranslate"><span class="pre">eth0</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">eth1</span></code>, etc.). Currently, it’s difficult to
set an internal IP
(see the open <a class="reference external" href="https://github.com/ray-project/ray/issues/22732">issue</a>).</p>
</section>
</section>
<section id="python-interface-slurm-scripts">
<h2><a class="toc-backref" href="slurm.html#id9">Python-interface SLURM scripts</a><a class="headerlink" href="slurm.html#python-interface-slurm-scripts" title="Permalink to this headline">#</a></h2>
<p>[Contributed by &#64;pengzhenghao] Below, we provide a helper utility (<a class="reference internal" href="slurm-launch.html#slurm-launch"><span class="std std-ref">slurm-launch.py</span></a>) to auto-generate SLURM scripts and launch.
<code class="docutils literal notranslate"><span class="pre">slurm-launch.py</span></code> uses an underlying template (<a class="reference internal" href="slurm-template.html#slurm-template"><span class="std std-ref">slurm-template.sh</span></a>) and fills out placeholders given user input.</p>
<p>You can feel free to copy both files into your cluster for use. Feel free to also open any PRs for contributions to improve this script!</p>
<section id="usage-example">
<h3><a class="toc-backref" href="slurm.html#id10">Usage example</a><a class="headerlink" href="slurm.html#usage-example" title="Permalink to this headline">#</a></h3>
<p>If you want to utilize a multi-node cluster in slurm:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python slurm-launch.py --exp-name <span class="nb">test</span> --command <span class="s2">&quot;python your_file.py&quot;</span> --num-nodes <span class="m">3</span>
</pre></div>
</div>
<p>If you want to specify the computing node(s), just use the same node name(s) in the same format of the output of <code class="docutils literal notranslate"><span class="pre">sinfo</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python slurm-launch.py --exp-name <span class="nb">test</span> --command <span class="s2">&quot;python your_file.py&quot;</span> --num-nodes <span class="m">3</span> --node NODE_NAMES
</pre></div>
</div>
<p>There are other options you can use when calling <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">slurm-launch.py</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--exp-name</span></code>: The experiment name. Will generate <code class="docutils literal notranslate"><span class="pre">{exp-name}_{date}-{time}.sh</span></code> and  <code class="docutils literal notranslate"><span class="pre">{exp-name}_{date}-{time}.log</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--command</span></code>: The command you wish to run. For example: <code class="docutils literal notranslate"><span class="pre">rllib</span> <span class="pre">train</span> <span class="pre">XXX</span></code> or <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">XXX.py</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--num-gpus</span></code>: The number of GPUs you wish to use in each computing node. Default: 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--node</span></code> (<code class="docutils literal notranslate"><span class="pre">-w</span></code>): The specific nodes you wish to use, in the same form as the output of <code class="docutils literal notranslate"><span class="pre">sinfo</span></code>. Nodes are automatically assigned if not specified.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--num-nodes</span></code> (<code class="docutils literal notranslate"><span class="pre">-n</span></code>): The number of nodes you wish to use. Default: 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--partition</span></code> (<code class="docutils literal notranslate"><span class="pre">-p</span></code>): The partition you wish to use. Default: “”, will use user’s default partition.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--load-env</span></code>: The command to setup your environment. For example: <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">cuda/10.1</span></code>. Default: “”.</p></li>
</ul>
<p>Note that the <a class="reference internal" href="slurm-template.html#slurm-template"><span class="std std-ref">slurm-template.sh</span></a> is compatible with both IPV4 and IPV6 ip address of the computing nodes.</p>
</section>
<section id="implementation">
<h3><a class="toc-backref" href="slurm.html#id11">Implementation</a><a class="headerlink" href="slurm.html#implementation" title="Permalink to this headline">#</a></h3>
<p>Concretely, the (<a class="reference internal" href="slurm-launch.html#slurm-launch"><span class="std std-ref">slurm-launch.py</span></a>) does the following things:</p>
<ol class="arabic simple">
<li><p>It automatically writes your requirements, e.g. number of CPUs, GPUs per node, the number of nodes and so on, to a sbatch script name <code class="docutils literal notranslate"><span class="pre">{exp-name}_{date}-{time}.sh</span></code>. Your command (<code class="docutils literal notranslate"><span class="pre">--command</span></code>) to launch your own job is also written into the sbatch script.</p></li>
<li><p>Then it will submit the sbatch script to slurm manager via a new process.</p></li>
<li><p>Finally, the python process will terminate itself and leaves a log file named <code class="docutils literal notranslate"><span class="pre">{exp-name}_{date}-{time}.log</span></code> to record the progress of your submitted command. At the mean time, the ray cluster and your job is running in the slurm cluster.</p></li>
</ol>
</section>
</section>
<section id="examples-and-templates">
<h2><a class="toc-backref" href="slurm.html#id12">Examples and templates</a><a class="headerlink" href="slurm.html#examples-and-templates" title="Permalink to this headline">#</a></h2>
<p>Here are some community-contributed templates for using SLURM with Ray:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/NERSC/slurm-ray-cluster">Ray sbatch submission scripts</a> used at <a class="reference external" href="https://www.nersc.gov/">NERSC</a>, a US national lab.</p></li>
<li><p><a class="reference external" href="https://github.com/albanie/yaspi">YASPI</a> (yet another slurm python interface) by &#64;albanie. The goal of yaspi is to provide an interface to submitting slurm jobs, thereby obviating the joys of sbatch files. It does so through recipes - these are collections of templates and rules for generating sbatch scripts. Supports job submissions for Ray.</p></li>
<li><p><a class="reference external" href="https://github.com/pengzhenghao/use-ray-with-slurm">Convenient python interface</a> to launch ray cluster and submit task by &#64;pengzhenghao</p></li>
</ul>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="yarn.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Deploying on YARN</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="lsf.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deploying on LSF</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>