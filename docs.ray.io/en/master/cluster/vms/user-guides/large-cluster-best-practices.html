
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Best practices for deploying large clusters &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/js/docsearch.js"></script>
    <script src="../../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../_static/js/top-navigation.js"></script>
    <script src="../../../_static/js/tags.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/cluster/vms/user-guides/large-cluster-best-practices.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Configuring Autoscaling" href="configuring-autoscaling.html" />
    <link rel="prev" title="Launching an On-Premise Cluster" href="launching-clusters/on-premises.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "cluster/vms/user-guides/large-cluster-best-practices", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kubernetes/index.html">
     Deploying on Kubernetes
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Deploying on VMs
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started.html">
       Getting Started
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="index.html">
       User Guides
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4">
        <a class="reference internal" href="launching-clusters/index.html">
         Launching Ray Clusters on AWS, GCP, Azure, On-Prem
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="large-cluster-best-practices.html#">
         Best practices for deploying large clusters
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="configuring-autoscaling.html">
         Configuring Autoscaling
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="logging.html">
         Log Persistence
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="community/index.html">
         Community Supported Cluster Managers
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../examples/index.html">
       Examples
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../references/index.html">
       API References
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../metrics.html">
     Collecting and monitoring metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../configure-manage-dashboard.html">
     Configuring and Managing Ray Dashboard
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../running-applications/index.html">
     Applications Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../faq.html">
     FAQ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../package-overview.html">
     Ray Cluster Management API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fcluster/vms/user-guides/large-cluster-best-practices.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/cluster/vms/user-guides/large-cluster-best-practices.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/cluster/vms/user-guides/large-cluster-best-practices.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#networking-configuration">
   Networking configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#system-configuration">
   System configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#configuring-the-head-node">
   Configuring the head node
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#configuring-the-autoscaler">
   Configuring the autoscaler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#picking-nodes">
   Picking nodes
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Best practices for deploying large clusters</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#networking-configuration">
   Networking configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#system-configuration">
   System configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#configuring-the-head-node">
   Configuring the head node
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#configuring-the-autoscaler">
   Configuring the autoscaler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="large-cluster-best-practices.html#picking-nodes">
   Picking nodes
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="best-practices-for-deploying-large-clusters">
<span id="vms-large-cluster"></span><h1>Best practices for deploying large clusters<a class="headerlink" href="large-cluster-best-practices.html#best-practices-for-deploying-large-clusters" title="Permalink to this headline">#</a></h1>
<p>This section aims to document best practices for deploying Ray clusters at
large scale.</p>
<section id="networking-configuration">
<h2>Networking configuration<a class="headerlink" href="large-cluster-best-practices.html#networking-configuration" title="Permalink to this headline">#</a></h2>
<p>End users should only need to directly interact with the head node of the
cluster. In particular, there are 2 services which should be exposed to users:</p>
<ol class="arabic simple">
<li><p>The dashboard</p></li>
<li><p>The Ray client server</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While users only need 2 ports to connect to a cluster, the nodes within a
cluster require a much wider range of ports to communicate.</p>
<p>See <a class="reference internal" href="../../../ray-core/configure.html#ray-ports"><span class="std std-ref">Ray port configuration</span></a> for a comprehensive list.</p>
<p>Applications (such as <a class="reference internal" href="../../../serve/index.html#rayserve"><span class="std std-ref">Ray Serve</span></a>) may also require
additional ports to work properly.</p>
</div>
</section>
<section id="system-configuration">
<h2>System configuration<a class="headerlink" href="large-cluster-best-practices.html#system-configuration" title="Permalink to this headline">#</a></h2>
<p>There are a few system level configurations that should be set when using Ray
at a large scale.</p>
<ul class="simple">
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-n</span></code> is set to at least 65535. Ray opens many direct
connections between worker processes to avoid bottlenecks, so it can quickly
use a large number of file descriptors.</p></li>
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code> is sufficiently large. Most ML/RL applications rely
heavily on the plasma store. By default, Ray will try to use <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code> for
the object store, but if it is not large enough (i.e. <code class="docutils literal notranslate"><span class="pre">--object-store-memory</span></code>
&gt; size of <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code>), Ray will write the plasma store to disk instead, which
may cause significant performance problems.</p></li>
<li><p>Use NVMe SSDs (or other high performance storage) if possible. If
<a class="reference internal" href="../../../ray-core/objects/object-spilling.html#id1"><span class="std std-ref">object spilling</span></a> is enabled Ray will spill objects to
disk if necessary. This is most commonly needed for data processing
workloads.</p></li>
</ul>
</section>
<section id="configuring-the-head-node">
<span id="vms-large-cluster-configure-head-node"></span><h2>Configuring the head node<a class="headerlink" href="large-cluster-best-practices.html#configuring-the-head-node" title="Permalink to this headline">#</a></h2>
<p>In addition to the above changes, when deploying a large cluster, Ray’s
architecture means that the head node has extra stress due to
additional system processes running on it like GCS.</p>
<ul class="simple">
<li><p>A good starting hardware specification for the head node is 8 CPUs and 32 GB memory.
The actual hardware specification depends on the workload and the size of the cluster.
Metrics that are useful for deciding the hardware specification are
CPU usage, memory usage, and network bandwidth usage.</p></li>
<li><p>Make sure the head node has sufficient bandwidth. The most heavily stressed
resource on the head node is outbound bandwidth. For large clusters (see the
scalability envelope), we recommend using machines networking characteristics
at least as good as an r5dn.16xlarge on AWS EC2.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">resources:</span> <span class="pre">{&quot;CPU&quot;:</span> <span class="pre">0}</span></code> on the head node.
(For Ray clusters deployed using KubeRay,
set <code class="docutils literal notranslate"><span class="pre">rayStartParams:</span> <span class="pre">{&quot;num-cpus&quot;:</span> <span class="pre">&quot;0&quot;}</span></code>.
See the <a class="reference internal" href="../../kubernetes/user-guides/config.html#kuberay-num-cpus"><span class="std std-ref">configuration guide for KubeRay clusters</span></a>.)
Due to the heavy networking load (and the GCS and dashboard processes), we
recommend setting the quantity of logical CPU resources to 0 on the head node
to avoid scheduling additional tasks on it.</p></li>
</ul>
</section>
<section id="configuring-the-autoscaler">
<h2>Configuring the autoscaler<a class="headerlink" href="large-cluster-best-practices.html#configuring-the-autoscaler" title="Permalink to this headline">#</a></h2>
<p>For large, long running clusters, there are a few parameters that can be tuned.</p>
<ul class="simple">
<li><p>Ensure your quotas for node types are set correctly.</p></li>
<li><p>For long running clusters, set the <code class="docutils literal notranslate"><span class="pre">AUTOSCALER_MAX_NUM_FAILURES</span></code> environment
variable to a large number (or <code class="docutils literal notranslate"><span class="pre">inf</span></code>) to avoid unexpected autoscaler
crashes. The variable can be set by prepending <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">AUTOSCALER_MAX_NUM_FAILURES=inf;</span></code>
to the head node’s Ray start command.
(Note: you may want a separate mechanism to detect if the autoscaler
errors too often).</p></li>
<li><p>For large clusters, consider tuning <code class="docutils literal notranslate"><span class="pre">upscaling_speed</span></code> for faster
autoscaling.</p></li>
</ul>
</section>
<section id="picking-nodes">
<h2>Picking nodes<a class="headerlink" href="large-cluster-best-practices.html#picking-nodes" title="Permalink to this headline">#</a></h2>
<p>Here are some tips for how to set your <code class="docutils literal notranslate"><span class="pre">available_node_types</span></code> for a cluster,
using AWS instance types as a concrete example.</p>
<p>General recommendations with AWS instance types:</p>
<p><strong>When to use GPUs</strong></p>
<ul class="simple">
<li><p>If you’re using some RL/ML framework</p></li>
<li><p>You’re doing something with tensorflow/pytorch/jax (some framework that can
leverage GPUs well)</p></li>
</ul>
<p><strong>What type of GPU?</strong></p>
<ul class="simple">
<li><p>The latest gen GPU is almost always the best bang for your buck (p3 &gt; p2, g4
&gt; g3), for most well designed applications the performance outweighs the
price. (The instance price may be higher, but you use the instance for less
time.)</p></li>
<li><p>You may want to consider using older instances if you’re doing dev work and
won’t actually fully utilize the GPUs though.</p></li>
<li><p>If you’re doing training (ML or RL), you should use a P instance. If you’re
doing inference, you should use a G instance. The difference is
processing:VRAM ratio (training requires more memory).</p></li>
</ul>
<p><strong>What type of CPU?</strong></p>
<ul class="simple">
<li><p>Again stick to the latest generation, they’re typically cheaper and faster.</p></li>
<li><p>When in doubt use M instances, they have typically have the highest
availability.</p></li>
<li><p>If you know your application is memory intensive (memory utilization is full,
but cpu is not), go with an R instance</p></li>
<li><p>If you know your application is CPU intensive go with a C instance</p></li>
<li><p>If you have a big cluster, make the head node an instance with an n (r5dn or
c5n)</p></li>
</ul>
<p><strong>How many CPUs/GPUs?</strong></p>
<ul class="simple">
<li><p>Focus on your CPU:GPU ratio first and look at the utilization (Ray dashboard
should help with this). If your CPU utilization is low add GPUs, or vice
versa.</p></li>
<li><p>The exact ratio will be very dependent on your workload.</p></li>
<li><p>Once you find a good ratio, you should be able to scale up and and keep the
same ratio.</p></li>
<li><p>You can’t infinitely scale forever. Eventually, as you add more machines your
performance improvements will become sub-linear/not worth it. There may not
be a good one-size fits all strategy at this point.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re using RLlib, check out <a class="reference internal" href="../../../rllib/rllib-training.html#rllib-scaling-guide"><span class="std std-ref">the RLlib scaling guide</span></a> for RLlib specific recommendations.</p>
</div>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="launching-clusters/on-premises.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Launching an On-Premise Cluster</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="configuring-autoscaling.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Configuring Autoscaling</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>