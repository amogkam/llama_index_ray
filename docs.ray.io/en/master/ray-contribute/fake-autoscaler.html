
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Testing Autoscaling Locally &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/versionwarning.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../_static/js/docsearch.js"></script>
    <script src="../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../_static/js/termynal.js"></script>
    <script defer="defer" src="../_static/js/custom.js"></script>
    <script defer="defer" src="../_static/js/top-navigation.js"></script>
    <script src="../_static/js/tags.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/ray-contribute/fake-autoscaler.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tips for testing Ray programs" href="../ray-core/examples/testing-tips.html" />
    <link rel="prev" title="How to write code snippets" href="writing-code-snippets.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "ray-contribute/fake-autoscaler", "programming_language": "py", "project": "ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/examples.html">
   Example Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-observability/index.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="stability.html">
   Developer Guides
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="getting-involved.html">
     Getting Involved / Contributing
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="development.html">
       Building Ray from Source
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="docs.html">
       Contributing to the Ray Documentation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="writing-code-snippets.html">
       How to write code snippets
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="fake-autoscaler.html#">
       Testing Autoscaling Locally
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ray-core/examples/testing-tips.html">
       Tips for testing Ray programs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="debugging.html">
       Debugging for Ray Developers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="profiling.html">
       Profiling for Ray Developers
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ray-core/configure.html">
     Configuring Ray
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="whitepaper.html">
     Architecture Whitepapers
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fray-contribute/fake-autoscaler.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/ray-contribute/fake-autoscaler.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/ray-contribute/fake-autoscaler.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="fake-autoscaler.html#">
   Testing Autoscaling Locally
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-fake-cluster-1-ray-start">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       RAY_FAKE_CLUSTER=1
      </span>
      <span class="pre">
       ray
      </span>
      <span class="pre">
       start
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-cluster-utils-autoscalingcluster">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       ray.cluster_utils.AutoscalingCluster
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#features-and-limitations-of-fake-multinode">
     Features and Limitations of
     <code class="docutils literal notranslate">
      <span class="pre">
       fake_multinode
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="fake-autoscaler.html#testing-containerized-multi-nodes-locally-with-docker-compose">
   Testing containerized multi nodes locally with Docker compose
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-fake-cluster-1-ray-up">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       RAY_FAKE_CLUSTER=1
      </span>
      <span class="pre">
       ray
      </span>
      <span class="pre">
       up
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-autoscaler-private-fake-multi-node-test-utils-dockercluster">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#features-and-limitations-of-fake-multinode-docker">
     Features and Limitations of
     <code class="docutils literal notranslate">
      <span class="pre">
       fake_multinode_docker
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#shared-directories-within-the-docker-environment">
     Shared directories within the docker environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#setting-up-in-a-docker-in-docker-dind-environment">
     Setting up in a Docker-in-Docker (dind) environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#local-development">
     Local development
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Testing Autoscaling Locally</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="fake-autoscaler.html#">
   Testing Autoscaling Locally
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-fake-cluster-1-ray-start">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       RAY_FAKE_CLUSTER=1
      </span>
      <span class="pre">
       ray
      </span>
      <span class="pre">
       start
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-cluster-utils-autoscalingcluster">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       ray.cluster_utils.AutoscalingCluster
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#features-and-limitations-of-fake-multinode">
     Features and Limitations of
     <code class="docutils literal notranslate">
      <span class="pre">
       fake_multinode
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="fake-autoscaler.html#testing-containerized-multi-nodes-locally-with-docker-compose">
   Testing containerized multi nodes locally with Docker compose
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-fake-cluster-1-ray-up">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       RAY_FAKE_CLUSTER=1
      </span>
      <span class="pre">
       ray
      </span>
      <span class="pre">
       up
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#using-ray-autoscaler-private-fake-multi-node-test-utils-dockercluster">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#features-and-limitations-of-fake-multinode-docker">
     Features and Limitations of
     <code class="docutils literal notranslate">
      <span class="pre">
       fake_multinode_docker
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#shared-directories-within-the-docker-environment">
     Shared directories within the docker environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#setting-up-in-a-docker-in-docker-dind-environment">
     Setting up in a Docker-in-Docker (dind) environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="fake-autoscaler.html#local-development">
     Local development
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="testing-autoscaling-locally">
<span id="fake-multinode"></span><h1>Testing Autoscaling Locally<a class="headerlink" href="fake-autoscaler.html#testing-autoscaling-locally" title="Permalink to this headline">#</a></h1>
<p>Testing autoscaling behavior is important for autoscaler development and the debugging of applications that depend
on autoscaler behavior. You can run the autoscaler locally without needing to launch a real cluster with one of the
following methods:</p>
<section id="using-ray-fake-cluster-1-ray-start">
<h2>Using <code class="docutils literal notranslate"><span class="pre">RAY_FAKE_CLUSTER=1</span> <span class="pre">ray</span> <span class="pre">start</span></code><a class="headerlink" href="fake-autoscaler.html#using-ray-fake-cluster-1-ray-start" title="Permalink to this headline">#</a></h2>
<p>Instructions:</p>
<ol class="arabic simple">
<li><p>Navigate to the root directory of the Ray repo you have cloned locally.</p></li>
<li><p>Locate the <a class="reference external" href="https://github.com/ray-project/ray/blob/master/python/ray/autoscaler/_private/fake_multi_node/example.yaml">fake_multi_node/example.yaml</a> example file and fill in the number of CPUs and GPUs the local machine has for the head node type config. The YAML follows the same format as cluster autoscaler configurations, but some fields are not supported.</p></li>
<li><p>Configure worker types and other autoscaling configs as desired in the YAML file.</p></li>
<li><p>Start the fake cluster locally:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ray stop --force
$ <span class="nv">RAY_FAKE_CLUSTER</span><span class="o">=</span><span class="m">1</span> ray start <span class="se">\</span>
    --autoscaling-config<span class="o">=</span>./python/ray/autoscaler/_private/fake_multi_node/example.yaml <span class="se">\</span>
    --head --block
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Connect your application to the fake local cluster with <code class="docutils literal notranslate"><span class="pre">ray.init(&quot;auto&quot;)</span></code>.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code> to view the status of your cluster, or <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/tmp/ray/session_latest/logs/monitor.*</span></code> to view the autoscaler monitor log:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ray <span class="nv">status</span>
<span class="o">========</span> Autoscaler status: <span class="m">2021</span>-10-12 <span class="m">13</span>:10:21.035674 <span class="o">========</span>
Node status
---------------------------------------------------------------
Healthy:
 <span class="m">1</span> ray.head.default
 <span class="m">2</span> ray.worker.cpu
Pending:
 <span class="o">(</span>no pending nodes<span class="o">)</span>
Recent failures:
 <span class="o">(</span>no failures<span class="o">)</span>

Resources
---------------------------------------------------------------
Usage:
 <span class="m">0</span>.0/10.0 CPU
 <span class="m">0</span>.00/70.437 GiB memory
 <span class="m">0</span>.00/10.306 GiB object_store_memory

Demands:
 <span class="o">(</span>no resource demands<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="using-ray-cluster-utils-autoscalingcluster">
<h2>Using <code class="docutils literal notranslate"><span class="pre">ray.cluster_utils.AutoscalingCluster</span></code><a class="headerlink" href="fake-autoscaler.html#using-ray-cluster-utils-autoscalingcluster" title="Permalink to this headline">#</a></h2>
<p>To programmatically create a fake multi-node autoscaling cluster and connect to it, you can use <a class="reference external" href="https://github.com/ray-project/ray/blob/master/python/ray/cluster_utils.py">cluster_utils.AutoscalingCluster</a>. Here’s an example of a basic autoscaling test that launches tasks triggering autoscaling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">AutoscalingCluster</span><span class="p">(</span>
    <span class="n">head_resources</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
    <span class="n">worker_node_types</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;cpu_node&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s2">&quot;object_store_memory&quot;</span><span class="p">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;node_config&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;min_workers&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;max_workers&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;gpu_node&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;object_store_memory&quot;</span><span class="p">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;node_config&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;min_workers&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;max_workers&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

    <span class="c1"># Triggers the addition of a GPU node.</span>
    <span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gpu ok&quot;</span><span class="p">)</span>

    <span class="c1"># Triggers the addition of a CPU node.</span>
    <span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cpu ok&quot;</span><span class="p">)</span>

    <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">remote</span><span class="p">())</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">remote</span><span class="p">())</span>
    <span class="n">ray</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<p>Python documentation:</p>
<dl class="py class">
<dt class="sig sig-object py" id="ray.cluster_utils.AutoscalingCluster">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ray.cluster_utils.</span></span><span class="sig-name descname"><span class="pre">AutoscalingCluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">head_resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">worker_node_types</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">config_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/cluster_utils.html#AutoscalingCluster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.cluster_utils.AutoscalingCluster" title="Permalink to this definition">#</a></dt>
<dd><p>Create a local autoscaling cluster for testing.</p>
<p>See test_autoscaler_fake_multinode.py for an end-to-end example.</p>
<p><strong>DeveloperAPI:</strong> This API may change across minor Ray releases.</p>
<dl class="py method">
<dt class="sig sig-object py" id="ray.cluster_utils.AutoscalingCluster.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_system_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/cluster_utils.html#AutoscalingCluster.start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.cluster_utils.AutoscalingCluster.start" title="Permalink to this definition">#</a></dt>
<dd><p>Start the cluster.</p>
<p>After this call returns, you can connect to the cluster with
ray.init(“auto”).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.cluster_utils.AutoscalingCluster.shutdown">
<span class="sig-name descname"><span class="pre">shutdown</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/cluster_utils.html#AutoscalingCluster.shutdown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.cluster_utils.AutoscalingCluster.shutdown" title="Permalink to this definition">#</a></dt>
<dd><p>Terminate the cluster.</p>
</dd></dl>

</dd></dl>

</section>
<section id="features-and-limitations-of-fake-multinode">
<h2>Features and Limitations of <code class="docutils literal notranslate"><span class="pre">fake_multinode</span></code><a class="headerlink" href="fake-autoscaler.html#features-and-limitations-of-fake-multinode" title="Permalink to this headline">#</a></h2>
<p>Most of the features of the autoscaler are supported in fake multi-node mode. For example, if you update the contents of the YAML file, the autoscaler will pick up the new configuration and apply changes, as it does in a real cluster. Node selection, launch, and termination are governed by the same bin-packing and idle timeout algorithms as in a real cluster.</p>
<p>However, there are a few limitations:</p>
<ol class="arabic simple">
<li><p>All node raylets run uncontainerized on the local machine, and hence they share the same IP address. See the <a class="reference internal" href="fake-autoscaler.html#fake-multinode-docker"><span class="std std-ref">fake_multinode_docker</span></a> section for an alternative local multi node setup.</p></li>
<li><p>Configurations for auth, setup, initialization, Ray start, file sync, and anything cloud-specific are not supported.</p></li>
<li><p>It’s necessary to limit the number of nodes / node CPU / object store memory to avoid overloading your local machine.</p></li>
</ol>
</section>
</section>
<section id="testing-containerized-multi-nodes-locally-with-docker-compose">
<span id="fake-multinode-docker"></span><h1>Testing containerized multi nodes locally with Docker compose<a class="headerlink" href="fake-autoscaler.html#testing-containerized-multi-nodes-locally-with-docker-compose" title="Permalink to this headline">#</a></h1>
<p>To go one step further and locally test a multi node setup where each node uses its own container (and thus
has a separate filesystem, IP address, and Ray processes), you can use the <code class="docutils literal notranslate"><span class="pre">fake_multinode_docker</span></code> node provider.</p>
<p>The setup is very similar to the <a class="reference internal" href="fake-autoscaler.html#fake-multinode"><span class="std std-ref">fake_multinode</span></a> provider. However, you need to start a monitoring process
(<code class="docutils literal notranslate"><span class="pre">docker_monitor.py</span></code>) that takes care of running the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code> command.</p>
<p>Prerequisites:</p>
<ol class="arabic simple">
<li><p>Make sure you have <a class="reference external" href="https://docs.docker.com/get-docker/">docker</a> installed.</p></li>
<li><p>Make sure you have the <a class="reference external" href="https://docs.docker.com/compose/cli-command/#installing-compose-v2">docker compose V2 plugin</a> installed.</p></li>
</ol>
<section id="using-ray-fake-cluster-1-ray-up">
<h2>Using <code class="docutils literal notranslate"><span class="pre">RAY_FAKE_CLUSTER=1</span> <span class="pre">ray</span> <span class="pre">up</span></code><a class="headerlink" href="fake-autoscaler.html#using-ray-fake-cluster-1-ray-up" title="Permalink to this headline">#</a></h2>
<p>Instructions:</p>
<ol class="arabic simple">
<li><p>Navigate to the root directory of the Ray repo you have cloned locally.</p></li>
<li><p>Locate the <a class="reference external" href="https://github.com/ray-project/ray/blob/master/python/ray/autoscaler/_private/fake_multi_node/example_docker.yaml">fake_multi_node/example_docker.yaml</a> example file and fill in the number of CPUs and GPUs the local machine has for the head node type config. The YAML follows the same format as cluster autoscaler configurations, but some fields are not supported.</p></li>
<li><p>Configure worker types and other autoscaling configs as desired in the YAML file.</p></li>
<li><p>Make sure the <code class="docutils literal notranslate"><span class="pre">shared_volume_dir</span></code> is empty on the host system</p></li>
<li><p>Start the monitoring process:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ python ./python/ray/autoscaler/_private/fake_multi_node/docker_monitor.py <span class="se">\</span>
    ./python/ray/autoscaler/_private/fake_multi_node/example_docker.yaml
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Start the Ray cluster using <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">up</span></code>:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">RAY_FAKE_CLUSTER</span><span class="o">=</span><span class="m">1</span> ray up -y ./python/ray/autoscaler/_private/fake_multi_node/example_docker.yaml
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Connect your application to the fake local cluster with <code class="docutils literal notranslate"><span class="pre">ray.init(&quot;ray://localhost:10002&quot;)</span></code>.</p></li>
<li><p>Alternatively, get a shell on the head node:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ docker <span class="nb">exec</span> -it fake_docker_fffffffffffffffffffffffffffffffffffffffffffffffffff00000_1 bash
</pre></div>
</div>
</section>
<section id="using-ray-autoscaler-private-fake-multi-node-test-utils-dockercluster">
<h2>Using <code class="docutils literal notranslate"><span class="pre">ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster</span></code><a class="headerlink" href="fake-autoscaler.html#using-ray-autoscaler-private-fake-multi-node-test-utils-dockercluster" title="Permalink to this headline">#</a></h2>
<p>This utility is used to write tests that use multi node behavior. The <code class="docutils literal notranslate"><span class="pre">DockerCluster</span></code> class can
be used to setup a Docker-compose cluster in a temporary directory, start the monitoring process,
wait for the cluster to come up, connect to it, and update the configuration.</p>
<p>Please see the API documentation and example test cases on how to use this utility.</p>
<dl class="py class">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ray.autoscaler._private.fake_multi_node.test_utils.</span></span><span class="sig-name descname"><span class="pre">DockerCluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster" title="Permalink to this definition">#</a></dt>
<dd><p>Docker cluster wrapper.</p>
<p>Creates a directory for starting a fake multinode docker cluster.</p>
<p>Includes APIs to update the cluster config as needed in tests,
and to start and connect to the cluster.</p>
<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.connect">
<span class="sig-name descname"><span class="pre">connect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">120</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">init_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.connect"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.connect" title="Permalink to this definition">#</a></dt>
<dd><p>Connect to the docker-compose Ray cluster.</p>
<p>Assumes the cluster is at RAY_TESTHOST (defaults to
<code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>client</strong> – If True, uses Ray client to connect to the
cluster. If False, uses GCS to connect to the cluster.</p></li>
<li><p><strong>timeout</strong> – Connection timeout in seconds.</p></li>
<li><p><strong>**init_kwargs</strong> – kwargs to pass to <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.remote_execution_api">
<span class="sig-name descname"><span class="pre">remote_execution_api</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ray.autoscaler._private.fake_multi_node.test_utils.RemoteAPI</span></span></span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.remote_execution_api"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.remote_execution_api" title="Permalink to this definition">#</a></dt>
<dd><p>Create an object to control cluster state from within the cluster.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.wait_for_resources">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">wait_for_resources</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">60</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.wait_for_resources"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.wait_for_resources" title="Permalink to this definition">#</a></dt>
<dd><p>Wait until Ray cluster resources are available</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resources</strong> – Minimum resources needed before
this function returns.</p></li>
<li><p><strong>timeout</strong> – Timeout in seconds.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.update_config">
<span class="sig-name descname"><span class="pre">update_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.update_config"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.update_config" title="Permalink to this definition">#</a></dt>
<dd><p>Update autoscaling config.</p>
<p>Does a deep update of the base config with a new configuration.
This can change autoscaling behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config</strong> – Partial config to update current
config with.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.setup" title="Permalink to this definition">#</a></dt>
<dd><p>Setup docker compose cluster environment.</p>
<p>Creates the temporary directory, writes the initial config file,
and pulls the docker image, if required.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.teardown">
<span class="sig-name descname"><span class="pre">teardown</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keep_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.teardown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.teardown" title="Permalink to this definition">#</a></dt>
<dd><p>Tear down docker compose cluster environment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>keep_dir</strong> – If True, cluster directory
will not be removed after termination.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.start" title="Permalink to this definition">#</a></dt>
<dd><p>Start docker compose cluster.</p>
<p>Starts the monitor process and runs <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">up</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.stop">
<span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.stop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.stop" title="Permalink to this definition">#</a></dt>
<dd><p>Stop docker compose cluster.</p>
<p>Runs <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">down</span></code> and stops the monitor process.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.kill_node">
<span class="sig-name descname"><span class="pre">kill_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rand</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ray/autoscaler/_private/fake_multi_node/test_utils.html#DockerCluster.kill_node"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="fake-autoscaler.html#ray.autoscaler._private.fake_multi_node.test_utils.DockerCluster.kill_node" title="Permalink to this definition">#</a></dt>
<dd><p>Kill node.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">node_id</span></code> is given, kill that node.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">num</span></code> is given, construct node_id from this number, and kill
that node.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">rand</span></code> is given (as either <code class="docutils literal notranslate"><span class="pre">worker</span></code> or <code class="docutils literal notranslate"><span class="pre">any</span></code>), kill a random
node.</p>
</dd></dl>

</dd></dl>

</section>
<section id="features-and-limitations-of-fake-multinode-docker">
<h2>Features and Limitations of <code class="docutils literal notranslate"><span class="pre">fake_multinode_docker</span></code><a class="headerlink" href="fake-autoscaler.html#features-and-limitations-of-fake-multinode-docker" title="Permalink to this headline">#</a></h2>
<p>The fake multinode docker node provider provides fully fledged nodes in their own containers. However,
some limitations still remain:</p>
<ol class="arabic simple">
<li><p>Configurations for auth, setup, initialization, Ray start, file sync, and anything cloud-specific are not supported
(but might be in the future).</p></li>
<li><p>It’s necessary to limit the number of nodes / node CPU / object store memory to avoid overloading your local machine.</p></li>
<li><p>In docker-in-docker setups, a careful setup has to be followed to make the fake multinode docker provider work (see below).</p></li>
</ol>
</section>
<section id="shared-directories-within-the-docker-environment">
<h2>Shared directories within the docker environment<a class="headerlink" href="fake-autoscaler.html#shared-directories-within-the-docker-environment" title="Permalink to this headline">#</a></h2>
<p>The containers will mount two locations to host storage:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/cluster/node</span></code>: This location (in the container) will point to <code class="docutils literal notranslate"><span class="pre">cluster_dir/nodes/&lt;node_id&gt;</span></code> (on the host).
This location is individual per node, but it can be used so that the host can examine contents stored in this directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/cluster/shared</span></code>: This location (in the container) will point to <code class="docutils literal notranslate"><span class="pre">cluster_dir/shared</span></code> (on the host). This location
is shared across nodes and effectively acts as a shared filesystem (comparable to NFS).</p></li>
</ul>
</section>
<section id="setting-up-in-a-docker-in-docker-dind-environment">
<h2>Setting up in a Docker-in-Docker (dind) environment<a class="headerlink" href="fake-autoscaler.html#setting-up-in-a-docker-in-docker-dind-environment" title="Permalink to this headline">#</a></h2>
<p>When setting up in a Docker-in-Docker (dind) environment (e.g. the Ray OSS Buildkite environment), some
things have to be kept in mind. To make this clear, consider these concepts:</p>
<ul class="simple">
<li><p>The <strong>host</strong> is the not-containerized machine on which the code is executed (e.g. Buildkite runner)</p></li>
<li><p>The <strong>outer container</strong> is the container running directly on the <strong>host</strong>. In the Ray OSS Buildkite environment,
two containers are started - a <em>dind</em> network host and a container with the Ray source code and wheel in it.</p></li>
<li><p>The <strong>inner container</strong> is a container started by the fake multinode docker node provider.</p></li>
</ul>
<p>The control plane for the multinode docker node provider lives in the outer container. However, <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code>
commands are executed from the connected docker-in-docker network. In the Ray OSS Buildkite environment, this is
the <code class="docutils literal notranslate"><span class="pre">dind-daemon</span></code> container running on the host docker. If you e.g. mounted <code class="docutils literal notranslate"><span class="pre">/var/run/docker.sock</span></code> from the
host instead, it would be the host docker daemon. We will refer to both as the <strong>host daemon</strong> from now on.</p>
<p>The outer container modifies files that have to be mounted in the inner containers (and modified from there
as well). This means that the host daemon also has to have access to these files.</p>
<p>Similarly, the inner containers expose ports - but because the containers are actually started by the host daemon,
the ports are also only accessible on the host (or the dind container).</p>
<p>For the Ray OSS Buildkite environment, we thus set some environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RAY_TEMPDIR=&quot;/ray-mount&quot;</span></code>. This environment variable defines where the temporary directory for the
cluster files should be created. This directory has to be accessible by the host, the outer container,
and the inner container. In the inner container, we can control the directory name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAY_HOSTDIR=&quot;/ray&quot;</span></code>. In the case where the shared directory has a different name on the host, we can
rewrite the mount points dynamically. In this example, the outer container is started with <code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">/ray:/ray-mount</span></code>
or similar, so the directory on the host is <code class="docutils literal notranslate"><span class="pre">/ray</span></code> and in the outer container <code class="docutils literal notranslate"><span class="pre">/ray-mount</span></code> (see <code class="docutils literal notranslate"><span class="pre">RAY_TEMPDIR</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAY_TESTHOST=&quot;dind-daemon&quot;</span></code> As the containers are started by the host daemon, we can’t just connect to
<code class="docutils literal notranslate"><span class="pre">localhost</span></code>, as the ports are not exposed to the outer container. Thus, we can set the Ray host with this environment
variable.</p></li>
</ul>
<p>Lastly, docker-compose obviously requires a docker image. The default docker image is <code class="docutils literal notranslate"><span class="pre">rayproject/ray:nightly</span></code>.
The docker image requires <code class="docutils literal notranslate"><span class="pre">openssh-server</span></code> to be installed and enabled. In Buildkite we build a new image from
<code class="docutils literal notranslate"><span class="pre">rayproject/ray:nightly-py37-cpu</span></code> to avoid installing this on the fly for every node (which is the default way).
This base image is built in one of the previous build steps.</p>
<p>Thus, we set</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RAY_DOCKER_IMAGE=&quot;rayproject/ray:multinode-py37&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAY_HAS_SSH=1</span></code></p></li>
</ul>
<p>to use this docker image and inform our multinode infrastructure that SSH is already installed.</p>
</section>
<section id="local-development">
<h2>Local development<a class="headerlink" href="fake-autoscaler.html#local-development" title="Permalink to this headline">#</a></h2>
<p>If you’re doing local development on the fake multi node docker module, you can set</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FAKE_CLUSTER_DEV=&quot;auto&quot;</span></code></p></li>
</ul>
<p>this will mount the <code class="docutils literal notranslate"><span class="pre">ray/python/ray/autoscaler</span></code> directory to the started nodes. Please note that
this is will probably not work in your docker-in-docker setup.</p>
<p>If you want to to specify which top-level Ray directories to mount, you can use e.g.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FAKE_CLUSTER_DEV_MODULES=&quot;autoscaler,tune&quot;</span></code></p></li>
</ul>
<p>This will mount both <code class="docutils literal notranslate"><span class="pre">ray/python/ray/autoscaler</span></code> and <code class="docutils literal notranslate"><span class="pre">ray/python/ray/tune</span></code> within the node containers. The
list of modules should be comma separated and without spaces.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="writing-code-snippets.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">How to write code snippets</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../ray-core/examples/testing-tips.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tips for testing Ray programs</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>